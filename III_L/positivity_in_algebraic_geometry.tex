\documentclass[a4paper]{article}

\def\npart {III}
\def\nterm {Lent}
\def\nyear {2018}
\def\nlecturer {S.\ Svaldi}
\def\ncourse {Positivity in Algebraic Geometry}

\input{header}

\newcommand\A{\mathbb{A}}
\newcommand\val{\mathrm{val}}
\renewcommand\div{\mathrm{div}}
\newcommand\Cl{\mathrm{Cl}}
\newcommand\WDiv{\mathrm{WDiv}}
\newcommand\Div{\mathrm{Div}}
\newcommand\Pic{\mathrm{Pic}}
\newcommand\Num{\mathrm{Num}}
\newcommand\NS{\mathrm{NS}}
\begin{document}
\maketitle
{\small
\setlength{\parindent}{0em}
\setlength{\parskip}{1em}
This class aims at giving an introduction to the theory of divisors, linear systems and their positivity properties on projective algebraic varieties.

The first part of the class will be dedicated to introducing the basic notions and results regarding these objects and special attention will be devoted to discussing examples in the case of curves and surfaces.

In the second part, the course will cover classical results from the theory of divisors and linear systems and their applications to the study of the geometry of algebraic varieties.

If time allows and based on the interests of the participants, there are a number of more advanced topics that could possibly be covered: Reider's Theorem for surfaces, geometry of linear systems on higher dimensional varieties, multiplier ideal sheaves and invariance of plurigenera, higher dimensional birational geometry.

\subsubsection*{Pre-requisites}
The minimum requirement for those students wishing to enroll in this class is their knowledge of basic concepts from the Algebraic Geometry Part 3 course, i.e.\ roughly Chapters 2 and 3 of Hartshorne's Algebraic Geometry.

Familiarity with the basic concepts of the geometry of algebraic varieties of dimension 1 and 2 --- e.g.\ as covered in the preliminary sections of Chapters 4 and 5 of Hartshorne's Algebraic Geometry --- would be useful but will not be assumed --- besides what was already covered in the Michaelmas lectures.

Students should have also some familiarity with concepts covered in the Algebraic Topology Part 3 course such as cohomology, duality and characteristic classes.
}
\tableofcontents

\section{Introduction}
Fix a field $K$. The first problem we want to look at is the following:
\begin{problem}
  Classify all finitely-generated field extension $L/K$.
\end{problem}
A closely related problem is
\begin{problem}
  Classify all towers of field extensions $L/M/K$.
\end{problem}
In general, we don't want to consider finite extensions --- this falls within the scope of Galois theory instead.

In general, given a finite extension $L/K$, we can factorize it into a tower $L/M/K$, where $M/K$ is purely transcendental, i.e.\ $M \cong K(x_1, \ldots, x_n)$ is a field of rational functions over $K$.

A large class of examples comes from \term{function fields} of algebraic varieties, $K(X)$.
\begin{eg}
  Recall that if $X$ is affine, then $K(X)$ is the field of fractions of the ring of functions of $X$, i.e.\ $Q(K[X])$.
\end{eg}

\begin{question}
  Are these all the examples of finitely-generated field extensions $L/K$?
\end{question}


\begin{lemma}
  Let $\Char K = 0$. If $L/K$ is finitely-generated and not finite, then there exists an algebraic variety $X/K$ such that $K(X) \cong L$.
\end{lemma}
Note that the condition is satisfied in particular if $K$ is algebraically closed.

\begin{proof}
  We factor $L/M/K$, where $M/K$ is purely transcendental, say $M = K(x_1, \ldots, x_n) = K(\A^n)$. Since $\Char(K) = 0$, we can use the primitive element theorem to get that $L = M(\alpha)$ for some $\alpha \in L$. Then if $f$ is the minimal polynomial for $\alpha$, then
  \[
    L \cong Q(K[x_1, \ldots, x_n, x]/(f(x))).\qedhere
  \]
\end{proof}


now suppose $\varphi: x \to y$ is a dominant birational map, % make birational
i.e.\ $\overline{\varphi(X)} = Y$. Then this induces a map $\varphi^* : K(Y) \to K(X)$.

Indeed, an element of $K(Y)$ is just a rational function $Y \to \A^1_K$, and pre-composing with $\varphi$ gives the desired function. The dominance ensures the composition is well-defined.

Now if every embedding of field extensions arise this way, then we have reduced our problem to studying algebraic varieties over $K$ and their rational dominant maps. This is indeed the case.
\begin{thm}
  Let $K$ be a field with $\Char K = 0$. Then there is an equivalence of categories between
  \[
    \left\{ \parbox{4.8cm}{\centering algebraic varieties over $K$\\ rational dominant morphisms}\right\} \longleftrightarrow \left\{\parbox{5.3cm}{\centering infinite f.g.\ field extensions over $K$\\field embeddings}\right\}
  \]
\end{thm}

\begin{proof}
  We define a functor from the left category to the right by sending a variety $X$ to the field of rational functions on $X$, $K(X)$, and morphisms are as above. We have already seen that this is essentially surjective. To show it is fully faithful, suppose $X, Y$ are algebraic varieties over $K$, and $\psi: K(Y) \hookrightarrow K(X)$. We want to show that $\psi = \varphi^*$ for some rational dominant map $X \to Y$.

  We can assume that $X$ and $Y$ are affine, since every variety is birationally equivalent to any Zariski open subset. Then $K(X) = Q(K[X])$ and $K(Y) = Q(K[Y])$. So in particular, we have an embedding $K[Y] \hookrightarrow K(X)$. Since $K[Y]$ is finitely-generated, we can produce a factorization
  \[
    \begin{tikzcd}
      K[Y] \ar[r, hook] \ar[dr, hook] & K(X) \\
      & K[X]_{s_1, \ldots, s_n} \ar[u, hook]
    \end{tikzcd}
  \]
  for some $s_1, \ldots, s_n$. But then $K[X]_{s_1, \ldots, s_n} = K[U]$ for some open $U \subseteq X$. Then the map $K[Y] \to K[U]$ determines a map $U \to Y$, hence a rational map $X \to Y$. The injectivity of the map $K[Y] \to K[U]$ corresponds to the fact that the induced map $U \to Y$ is dominant. So we are done.
\end{proof}

\section{Divisors}
\subsection{Projective embeddings}
Our results here will be stated for rather general schemes, but ultimately, we are only interested in algebraic varieties.

We are interested in the following problem --- given a scheme $X$, can we embed it in projective space? The first observation that $\P^n$ comes with a very special line bundle $\mathcal{O}(1)$, and every embedding $X \hookrightarrow \P^n$ gives pulls back to a corresponding sheaf $\mathcal{L}$ on $X$.

The key property of $\mathcal{O}(1)$ is that it has \emph{global} sections $x_0, \ldots, x_n$. These global sections generate $\mathcal{O}(1)$ as an $\mathcal{O}_X$-module.

\begin{defi}[Generating section]\index{generating section}
  Let $X$ be a scheme, and $\mathcal{F}$ a sheaf of $\mathcal{O}_X$-modules. Let $s_0, \ldots, s_n \in H^0(X, \mathcal{F})$ be sections. We say the sections \emph{generate} $\mathcal{F}$ if the natural map
  \[
    \bigoplus_{i = 0}^{n + 1} \mathcal{O}_X \to \mathcal{F}
  \]
  induced by the $s_i$ is a surjective map of $\mathcal{O}_X$-modules.
\end{defi}

The generating sections are preserved under pullbacks. So if $X$ is embedded into $\P^n$, then it should have a corresponding line bundle generated by $n + 1$ global sections. Indeed, we have the following theorem:
\begin{thm}
  Let $A$ be any ring, and $X$ a scheme over $A$.
  \begin{enumerate}
    \item If $\varphi: X \to \P^n$ is a morphism over $A$, then $\varphi^* \mathcal{O}_{\P^n}(1)$ is an invertible sheaf on $X$, generated by the sections $\varphi^* x_0, \ldots, \varphi^* x_n \in H^0(X, \varphi^* \mathcal{O}_{\P^n}(1))$.
    \item If $\mathcal{L}$ is an invertible sheaf on $X$, and if $s_0, \ldots, s_n \in H^0(X, \mathcal{L})$ which generate $\mathcal{L}$, then there exists a unique morphism $\varphi: X \to \P^n$ such that $\varphi^* \mathcal{O}(1) \cong \mathcal{L}$ and $\varphi^* x_i = s_i$.
  \end{enumerate}
\end{thm}

This theorem highlights the importance of studying line bundles and their sections, and in some sense, understanding these is the whole focus of the course.

\begin{proof}\leavevmode
  \begin{enumerate}
    \item The pullback of an invertible sheaf is an invertible, and the same for sections. Since $x_0, \ldots, x_n$ generate $H^0(\mathcal{O}_{\P^n}(1))$, they generate, and this is again preserved under pullback.
    \item In short, we map $x \in X$ to $[s_0(x): \cdots : s_n(x)] \in \P^n$.

      In more detail, define $X_{s_i} = \{p \in X: s_i \in \mathfrak{m}_p \mathcal{L}_p\}$. This is a Zariski open set, and $s_i$ is invertible on $X_{s_i}$. Thus there is a dual section $s_i^\vee \in \mathcal{L}^{\vee}$ such that $s_i \otimes s_i^\vee \in \mathcal{L} \otimes \mathcal{L}^\vee \cong \mathcal{O}_X$ is equal to $1$. Define the map $X_{s_i} \to \A^n$ by the map
      \begin{align*}
        K[\A^n] &\to H^0(X_{s_i}, \mathcal{O}_{s_i})\\
        y_i &\mapsto s_j \otimes s_i^\vee.
      \end{align*}
      Since the $s_i$ generate, they cannot simultaneously vanish on a point. So $X = \bigcup X_{s_i}$. Identifying $\A^n$ as the chart of $\P^n$ where $x_i \not= 0$, this defines the desired map $X \to \P^n$.\qedhere
  \end{enumerate}
\end{proof}

The theorem tells us we get a map from $X$ to $\P^n$. However, it says nothing about how nice these maps are. In particular, it says nothing about whether or not we get an embedding.

\begin{defi}[Very ample sheaf]\index{very ample sheaf}\index{sheaf!very ample}
  Let $X$ be an algebraic variety over $K$, and $\mathcal{L}$ be an invertible sheaf. We say that $\mathcal{L}$ is very ample if there is a closed immersion $\varphi: X \to \P^n$ such that $\varphi^* \mathcal{O}_{\P^n}(1) \cong \mathcal{L}$.
\end{defi}
It would be convenient if we had a good way of identifying when $\mathcal{L}$ is very ample. In this section, we can only give a rather formal and not very useful criterion for when this is the case. As we progress further in the course, we shall obtain more concrete criteria in the cases of interest.

So how can we understand when a map $X \hookrightarrow \P^n$ is an embedding? If it were an embedding, then it in particular is injective. So given any two points in $X$, there is a hyperplane in $\P^n$ that passes through one but not the other. But being an embedding means something more. We want the differential of the map to be injective as well.

\begin{prop}
  Assume $K = \bar{K}$, and $X$ is a projective variety over $K$. Fix an invertible sheaf $\mathcal{L}$ on $X$, and sections $s_0, \ldots, s_n \in H^0(X, \mathcal{L})$ generating $\mathcal{L}$, and write $V = \bra s_0, \ldots, s_n\ket$ for the linear span. Then the associated map $\varphi: X \to \P^n$ is a closed embedding iff
  \begin{enumerate}
    \item For every distinct closed points $p \not= q \in X$, there exists $s_{p, q} \in V$ such that $s_{p, q} \in \mathfrak{m}_p \mathcal{L}_p$ but $s_{p, q} \not \in \mathfrak{m}_q \mathcal{L}_q$.
    \item For every $p \in X$, the set $\{s \in V \mid s \in \mathfrak{m}_p \mathcal{L}_p\}$ spans the vector space $\mathfrak{m}_p \mathcal{L}_p /\mathfrak{m}^2_p \mathcal{L}_p$.
  \end{enumerate}
\end{prop}

\begin{defi}[Separate points and tangent vectors]
  With the hypothesis of the proposition, we say that
  \begin{itemize}
    \item elements of $V$ \term{separate points} if $V$ satisfies (i).
    \item elements of $V$ \term{separate tangent vectors} if $V$ satisfies (ii).
  \end{itemize}
\end{defi}

\begin{proof}\leavevmode
  \begin{itemize}
    \item[$(\Rightarrow)$] Suppose $\phi$ is a closed immersion. Then it is injective on points. So suppose $p \not= q$ are (closed) points. Then there is some hyperplane $H_{p, q}$ in $\P^n$ passing through $p$ but not $q$, and $H_{p, q}$ is represented by a global section of $\mathcal{O}(1)$. Then $s_{p, q} = \varphi^* H_{p, q} \in V \subseteq H^0(X, \mathcal{L})$ is such that $s_{p, q} \in \mathfrak{m}_p \mathcal{L}_p$ and $s_{p, q} \not \in \mathfrak{m}_q \mathcal{L}_q$. So (i) is satisfied.

      To see (ii), observe that by definition, the map of sheaves $\mathcal{O}_{\P^n} \to \varphi_* \mathcal{O}_X$ is surjective. So if $p \in X$ is a closed point, then in particular $\mathfrak{m}_{p, \P^n} \to \mathfrak{m}_{p, X}$ is surjective. This implies that the quotient
       \[
        \frac{\mathfrak{m}_{p, \P^n}}{\mathfrak{m}_{p, \P^n}^2} \twoheadrightarrow \frac{\mathfrak{m}_{p, X}}{\mathfrak{m}_{p, X}^2}.
      \]
      is also surjective. But on $\P^n$, $x_0, \ldots, x_n$ certainly spans $\mathfrak{m}_{p, \P^n}$. So their image $s_0, \ldots, s_n$ in $\mathfrak{m}_{p, X}$ also span $\mathfrak{m}_{p, X}/\mathfrak{m}_{p, X}^2$.

    \item[$(\Leftarrow)$] We first show that $\varphi$ is injective on closed points. For any $p \not= q \in X$, write the given $s_{p, q}$ as
      \[
        s_{p, q} = \sum \lambda_i s_i = \sum \lambda_i \varphi^* x_i = \varphi^* \sum \lambda_i x_i
      \]
      for some $\lambda_i \in K$. So we can take $H_{p, q}$ to be given by the vanishing set of $\sum \lambda_i x_i$, and so it is injective on closed point. It follows that it is also injective on schematic points.

      To show that $\varphi$ is in fact a closed immersion, we need to show that $\mathcal{O}_{\P^n} \to \varphi_* \mathcal{O}_X$ is surjective. As before, it is enough to prove that it holds at the level of stalks over closed points. To show this, we apply the following lemma:
      \begin{lemma}
        Let $f: A \to B$ be a local morphism of local rings such that
        \begin{itemize}
          \item $A/\mathfrak{m}_A \to B/\mathfrak{m}_B$ is an isomorphism;
          \item $\mathfrak{m}_A \to \mathfrak{m}_B/\mathfrak{m}_B^2$ is surjective; and
          \item $B$ is a finitely-generated $A$-module.
        \end{itemize}
        Then $f$ is surjective.\fakeqed
      \end{lemma}
      To check the first condition, note that we have
      \[
        \frac{\mathcal{O}_{p, \P^n}}{\mathfrak{m}_{p, \P^n}} \cong \frac{\mathcal{O}_{p, X}}{\mathfrak{m}_{p, X}} \cong K.
      \]
      Now since $\mathfrak{m}_{p, \P^n}$ is generated by $x_0, \ldots, x_n$, the second condition is the same as saying
      \[
        \mathfrak{m}_{p, \P^n} \to \frac{\mathfrak{m}_{p, X}}{\mathfrak{m}_{p, X}^2}
      \]
      is surjective. The last part is immediate.\qedhere
  \end{itemize}
\end{proof}
Unsurprisingly, this is not a very pleasant hypothesis to check, since it requires us to really understand the structure of $V$. In general, given an invertible sheaf $\mathcal{L}$, it is unlikely that we can concretely understand the space of sections. Thus, what we want to do in this course is to simplify this criterion.

One convenient place to start is the following theorem of Serre:
\begin{thm}[Serre]
  Let $X$ be a projective scheme over a Noetherian ring $A$, $\mathcal{L}$ be a very ample invertible sheaf, and $\mathcal{F}$ a coherent $\mathcal{O}_X$-module. Then there exists a positive integer $n_0 = n_0(\mathcal{F}, \mathcal{L})$ such that for all $n \geq n_0$, the twist $\mathcal{F} \otimes \mathcal{L}^n$ is generated by global sections.\fakeqed
\end{thm}

So we can try to weaken the condition of very ampleness to only require the condition of this theorem to hold.
\begin{defi}[Ample sheaf]\index{ample sheaf}
  Let $X$ be a Noetherian scheme over $A$, and $\mathcal{L}$ an invertible sheaf over $X$. We say $\mathcal{L}$ is ample iff for any coherent $\mathcal{O}_X$-module $\mathcal{F}$, there is an $n_0$ such that for all $n \geq n_0$, the sheaf $\mathcal{F} \otimes \mathcal{L}^n$ is generated by global sections.
\end{defi}

While this seems like a rather weak condition, it is actually not too bad. First of all, by taking $\mathcal{F}$ to be $\mathcal{O}_X$, we can find some $\mathcal{L}^n$ that is generated by global sections. So at least it gives some map to $\P^n$. In fact, another theorem of Serre tells us this gives us an embedding.

\begin{thm}[Serre]
  Let $X$ be a scheme of finite type over a Noetherian ring $A$, and $\mathcal{L}$ an invertible sheaf on $X$. Then $\mathcal{L}$ is ample iff there exists $m > 0$ such that $\mathcal{L}^m$ is very ample.
\end{thm}

\begin{proof}\leavevmode
  \begin{itemize}
    \item[($\Leftarrow$)] Let $\mathcal{L}^n$ be very ample, and $\mathcal{F}$ a coherent sheaf. By Serre's theorem, there exists $n_0$ such that for all $j \geq j_0$, the sheafs
      \[
        \mathcal{F} \otimes \mathcal{L}^{mj}, (\mathcal{F} \otimes \mathcal{L}) \otimes \mathcal{L}^{mj}, \ldots, (\mathcal{F} \otimes \mathcal{L}^{m - 1}) \otimes \mathcal{L}^{mj}
      \]
      are all globally generated. So $\mathcal{F} \otimes \mathcal{L}^n$ is globally generated for $n \geq mj_0$.
    \item[($\Rightarrow$)] Suppose $\mathcal{L}$ is ample. Then $\mathcal{L}^m$ is globally generated for $m$ sufficiently large. We claim that there exists $t_1, \ldots, t_n \in H^0(X, \mathcal{L}^N)$ such that $\mathcal{L}|_{X_{t_i}}$ are all trivial (i.e.\ isomorphic to $\mathcal{O}_{X_{t_i}}$), and $X = \bigcup X_{t_i}$.

      By compactness, it suffices to show that for each $p \in X$, there is some $t \in H^0(X, \mathcal{L}^n)$ (for some $n$) such that $p \in X_{t_i}$ and $\mathcal{L}$ is trivial on $X_{t_i}$. First of all, since $\mathcal{L}$ is locally free by definition, we can find an open affine $U$ containing $p$ such that $\mathcal{L}|_U$ is trivial.

      Thus, it suffices to produce a section $t$ that vanishes on $Y = X - U$ but not at $p$. Then $p \in X_t \subseteq U$ and hence $\mathcal{L}$ is trivial on $X_t$. Vanishing on $Y$ is the same as belonging to the ideal sheaf $\mathcal{I}_Y$. Since $\mathcal{I}_Y$ is coherent, ampleness implies there is some large $n$ such that $\mathcal{I}_Y \otimes \mathcal{L}^n$ is generated by global sections. In particular, since $\mathcal{I}_Y \otimes \mathcal{L}^n$ doesn't vanish at $p$, we can find some $t \in \Gamma(X, \mathcal{I}_Y \otimes \mathcal{L}^N)$ such that $t \not \in \mathfrak{m}_p (\mathcal{I}_Y \otimes \mathcal{L}^n)_p$. Since $\mathcal{I}_Y$ is a subsheaf of $\mathcal{O}_X$, we can view $t$ as a section of $\mathcal{L}^n$, and this $t$ works.

      Fix a point $x \in X$, and take an affine open $U$ containing $x$ such that $\mathcal{L}|_U$ is trivial, i.e.\ $\mathcal{L}|_U \cong \mathcal{O}_U$. Define $Z = X \setminus U$.

      We know there exists $\ell$ such that $I_Z \otimes \mathcal{L}^{\ell}$ is globally generated. So in particular, there exists $s \in H^0(X, I_Z \otimes \mathcal{L}^\ell)$ such that $s_x \not \in \mathfrak{m}_X \mathcal{L}_{x, X}$. So we can define $X_S$ to be the affine Zariski open such that $X_s = \{p \in X : s_p \not \in \mathfrak{m}_p \mathcal{L}_p\}$.

      Now given the $X_{t_i}$, for each fixed $i$, we let $\{b_{ij}\}$ generate $\mathcal{O}_{X_{t_i}}$ as an $A$-algebra. Then for large $n$, $c_{ij} = t_i^n b_{ij}$ extends to a global section $c_{ij} \in \Gamma(X, \mathcal{L}^n)$ (by clearing denominators). We can pick an $n$ large enough to work for all $b_{ij}$. Then we use $\{t_i^n, c_{ij}\}$ as our generating sections to construct a morphism to $\P^N$, and let $\{x_i, x_{ij}\}$ be the corresponding coordinates. Observe that $\bigcup X_{t_i} = X$ implies the $t_i^n$ already generate $\mathcal{L}^n$. Now each $x_{t_i}$ gets mapped to $U_i \subseteq \P^N$, the vanishing set of $x_i$. The map $\mathcal{O}_{U_i} \to \varphi_* \mathcal{O}_{X_{t_i}}$ corresponds to the map
      \[
        A[y_i, y_{ij}] \to B_i,
      \]
      where $y_{ij}$ is mapped to $c_{ij}/t_i^n = b_{ij}$. So by assumption, this is surjective, and so we have a closed embedding.\qedhere
  \end{itemize}
\end{proof}

From this, we also see that
\begin{prop}
  Let $\mathcal{L}$ be a sheaf over $X$ (which is itself a projective variety over $K$). Then the following are equivalent:
  \begin{enumerate}
    \item $\mathcal{L}$ is ample.
    \item $\mathcal{L}^m$ is ample for all $m > 0$.
    \item $\mathcal{L}^m$ is ample for some $m > 0$.
  \end{enumerate}
\end{prop}

We will also frequently make use of the following theorem:
\begin{thm}[Serre]
  Let $X$ be a projective scheme over a Noetherian ring $A$, and $\mathcal{L}$ is very ample on $X$. Let $\mathcal{F}$ be a coherent sheaf. Then
  \begin{enumerate}
    \item For all $i \geq 0$ and $n \in \N$, $H^i(\mathcal{F} \otimes \mathcal{L}^n)$ is a finitely-generated $A$-module.
    \item There exists $n_0 \in \N$ such that for all $n \geq n_0$, $H^i(\mathcal{F} \otimes \mathcal{L}^n) = 0$ for all $i > 0$.\fakeqed
  \end{enumerate}
\end{thm}
The proof is exactly the same as the case of $\mathcal{O}(1)$ on $\P^n$.

As before, this theorem still holds for ample sheaves, and in fact characterizes them.
\begin{thm}
  Let $X$ be a proper scheme over a Noetherian ring $A$, and $\mathcal{L}$ an invertible sheaf. Then the following are equivalent:
  \begin{enumerate}
    \item $\mathcal{L}$ is ample.
    \item For all coherent $\mathcal{F}$ on $X$, there exists $n_0 \in \N$ such that for all $n \geq n_0$, we have $H^i(\mathcal{F} \otimes \mathcal{L}^n) = 0$.
  \end{enumerate}
\end{thm}

\begin{proof}
  Proving (i) $\Rightarrow$ (ii) is the same as the first part of the theorem last time.

  To prove (ii) $\Rightarrow$ (i), fix a point $x \in X$, and consider the sequence
  \[
    0 \to \mathfrak{m}_x \mathcal{F} \to \mathcal{F} \to \mathcal{F}_x \to 0.
  \]
  We twist by $\mathcal{L}^n$, where $n$ is sufficiently big, and take cohomology. Then we have a long exact sequence
  \[
    0 \to H^0(\mathfrak{m}_x \mathcal{F}(n)) \to H^0(\mathcal{F}(n)) \to H^0(\mathcal{F}_x(n)) \to H^1(\mathfrak{m}_x \mathcal{F}(n)) = 0.
  \]
  In particular, the map $H^0(\mathcal{F}(n)) \to H^0(\mathcal{F}_x(n))$ is surjective. This mean at $x$, $\mathcal{F}(n)$ is globally generated. Then by compactness, there is a single $n$ large enough such that $\mathcal{F}(n)$ is globally generated everywhere.
\end{proof}

\subsection{Weil divisors}
We now talk about something seemingly unrelated, namely Weil divisors, but we shall soon see that there is a close connection between them.

Let $X$ be a Noetherian scheme. If $X$ is regular in codimension $1$ (e.g.\ if $X$ is normal), which one should think of as saying the singular locus of $X$ having codimension $ \geq 2$. Then if $Y \subseteq X$ is a codimension $1$ integral subscheme, then the local ring $\mathcal{O}_{X, Y}$ is a DVR. So there is a valuation
\[
  \val_Y: \mathcal{O}_{X, Y} \to \Z,
\]
which is the order of vanishing/poles along $Y$.

\begin{defi}[Weil divisor]\index{Weil divisor}
  A \emph{Weil divisor} is a formal sum
  \[
    \sum a_i Y_i,
  \]
  where the $a_i \in \Z$ and $Y_i$ are codimension $1$ integral subschemes. We write $\WDiv(X)$ for the group of Weil divisors of $X$.

  For $K$ a field, a \term{Weil $K$-divisor} is the same where we allow $a_i \in K$.
\end{defi}

\begin{defi}[Effective divisor]\index{effective divisor}
  We say a Weil divisor is \emph{effective} if $a_i \geq 0$ for all $i$. We write $D \geq 0$.
\end{defi}

\begin{defi}[Support]\index{support}
  The \emph{support} of $D = \sum a_i Y_i$ is
  \[
    \supp(D) = \bigcup Y_i.
  \]
\end{defi}
Another important kind of divisors is principal divisors.

\begin{defi}[Principal divisor]\index{principal divisor}\index{$\mathrm{div}(f)$}
  If $f \in K(X)$, then we define the \emph{principal divisor}
  \[
    \div(f) = \sum_{Y} \val_Y(f) \cdot Y.
  \]
\end{defi}
One can show that $\val_Y(f)$ is non-zero for only finitely many $Y$'s, so this is a genuine divisor. To see this, there is always a Zariski open $U$ such that $f|_U$ is invertible, So $\val_Y(f) \not= 0$ implies $Y \subseteq X \setminus U$. Since $X$ is Noetherian, $X \setminus U$ can only contain finitely many codimension $1$ subscheme.
Observe that $\div(fg) = \div(f) + \div(g)$. So the principal divisors form a subgroup of the Weil divisors.

\begin{defi}[Class group]\index{class group}
  The \emph{class group} of $X$, $\Cl(X)$, is the group of Weil divisors quotiented out by the principal divisors.

  We say Weil divisors $D, D'$ are \term{linearly equivalent} if $D - D'$ is principal, and we write $D \sim D'$.
\end{defi}

\begin{eg}
  Take $X = \A^1_K$, and $f = \frac{x^3}{x + 1} \in K(X)$. Then
  \[
    \div(f) = 3[0] - [-1].
  \]
\end{eg}

A useful result for the future is the following:
\begin{thm}[Hartog's lemma]\index{Hartog's lemma}
  Let $X$ be normal, and $f \in \mathcal{O}(X \setminus V)$ for some $V \geq 2$. Then $f \in \mathcal{O}_X$.
\end{thm}

\subsection{Cartier divisors}
Weil divisors do not behave too well on weirder schemes. A better alternative is Cartier divisors. Let $\mathcal{L}$ be a line bundle, and $ss$ a rational section of $\mathcal{L}$, i.e.\ $s$ is a section of $\mathcal{L}|_U$ for some open $U \subseteq X$. Given such an $s$, we can define
\[
  \div(s) = \sum_Y \val_Y(s) \cdot Y.
\]
To make sense of $\val_Y(s)$, for a fixed codimension $1$ subscheme $Y$, pick $W$ such that $W \cap W \not= \emptyset$, and $\mathcal{L}|_W$ is trivial. Then we can make sense of $\val_Y(s)$ using the trivialization. It is clear from Hartog's lemma that
\begin{prop}
  If $X$ is normal, then
  \[
    \div: \{\text{rational sections of }\mathcal{L}\} \to \WDiv(X).
  \]
  is well-defined, and two sections have the same image iff they differ by an element of $\mathcal{O}_X^*$.
\end{prop}

\begin{cor}
  If $X$ is normal and proper, then
  \[
    \div \{\text{rational sections of }\mathcal{L}\}/K^* \to \WDiv(X).
  \]
\end{cor}

\begin{proof}
  Properness implies $\mathcal{O}_X^* = K^*$.
\end{proof}

\begin{eg}
  Take $X = \P^1_K$, and $s = \frac{X^2}{X + Y} \in H^0(\mathcal{O}(1))$, where $X, Y$ are our homogeneous coordinates. Then
  \[
    \div(s) = 2[0:1] - [1:-1].
  \]
\end{eg}

Let $X$ be a normal Noetherian scheme. Fix a Weil divisor $X$. We define the sheaf $\mathcal{O}_X(D)$\index{$\mathcal{O}_X(D)$} by setting, for all $U \subseteq X$ open,
\[
  \mathcal{O}_U(D) = \{f \in K(X) : \div(f) + D |_U \geq 0\}.
\]
\begin{prop}
  $\mathcal{O}_X(D)$ is a rank $1$ quasicoherent $\mathcal{O}_X$-module. \fakeqed.
\end{prop}

\begin{defi}[Locally principal]\index{locally principal}
  Let $D$ be a Weil divisor on $X$. Fix $x \in X$. Then $D$ is locally principal at $x$ if there exists an open set $U \subseteq X$ containing $x$ such that $D|_U = \div(f)|_U$ for some $f \in K(X)$.
\end{defi}

\begin{prop}
  If $D$ is locally principal at every point $x$, then $\mathcal{O}_X(D)$ is an invertible sheaf.
\end{prop}
\begin{proof}
  If $U \subseteq X$ is such that $D|_U = \div(f)|_U$, then there is an isomorphism
  \begin{align*}
    \mathcal{O}_X|_U &\to \mathcal{O}_X(D) |_U\\
    g &\mapsto g/f.\qedhere
  \end{align*}
\end{proof}
\begin{defi}[Cartier divisor]\index{Cartier divisor}
  A \emph{Cartier divisor} is a locally principal Weil divisor.
\end{defi}

By checking locally, we see that
\begin{prop}
  If $D_1, D_2$ are Cartier divisors, then
  \begin{enumerate}
    \item $\mathcal{O}_X(D_1 + D_2) = \mathcal{O}_X(D_1) \otimes \mathcal{O}_X(D_2)$.
    \item $\mathcal{O}_X(-D) \cong \mathcal{O}_X(D)^{\vee}$.
    \item If $f \in K(X)$, then $\mathcal{O}_X(\div(f)) \cong \mathcal{O}_X$.\fakeqed
  \end{enumerate}
\end{prop}

\begin{prop}
  Let $X$ be a Noetherian, normal, integral scheme. Assume that $X$ is \term{factorial}, i.e.\ every local ring $\mathcal{O}_{X, x}$ is a UFD. Then any Weil divisor is Cartier.
\end{prop}
Note that if $X$ is smooth, then $X$ is always factorial, and this proposition applies.

\begin{proof}
  It is enough to prove the proposition when $D$ is irreducible and effective. So $D \subseteq X$ is a codimension $1$ irreducible subvariety. For $x \in D$
  \begin{itemize}
    \item If $x \not \in D$, then $1$ is a divisor equivalent to $D$ near $x$.
    \item If $x \in D$, then $I_{D, x} \subseteq \mathcal{O}_{X, x}$ is a height $1$ prime ideal. So $I_{D, x} = (f)$ for $f \in \mathfrak{m}_{X, x}$. Then $f$ is the local equation for $D$.\qedhere
  \end{itemize}
\end{proof}

Recall the Class group $\Cl(X)$ was the group of Weil divisors modulo principal equivalence.
\begin{defi}[Picard group]\index{Picard group}
  We define the \emph{Picard group} of $X$ to be the group of Cartier divisors modulo principal equivalence.
\end{defi}
Then if $X$ is factorial, then $\Cl(X) = \Pic(X)$.

Recall that if $\mathcal{L}$ is an invertible sheaf, and $s$ is a rational section of $\mathcal{L}$, then we can define $\div(s)$.

\begin{prop}
  Let $X$ be normal and $\mathcal{L}$ an invertible sheaf, $s$ a rational section of $\mathcal{L}$. Then $\mathcal{O}_X(\div(s))$ is invertible, and
  \[
    \mathcal{O}_X(\div(s)) \to \mathcal{L}
  \]
  is an isomorphism. This gives a map
  \[
    \Pic(X) \to \Cl(X).
  \]
\end{prop}

\begin{proof}
  Given $f \in H^0(U, \mathcal{O}_X(\div(s)))$, map it to $f \cdot s \in H^0(U, \mathcal{L})$. This gives the desired isomorphism.

  If we have to sections $s' \not= s$, then $f= s'/s \in K(X)$. So $\div(s) = \div (s') + \div(f)$, and $\div(f)$ is principal. So this gives a well-defined map $\Pic(X) \to \Cl(X)$.
\end{proof}
So we can think of $\Pic(X)$ as the group of invertible sheaves modulo isomorphism, namely $H^1(X, \mathcal{O}_X^*)$.

If $X$ is factorial (and Noetherian and integral), then we have a map $\Cl(X) \to \Pic(X)$, and this is an isomorphism.

\subsubsection*{Computations}
\begin{prop}
  Let $X$ be an integral scheme, regular in codimension $1$. If $Z \subseteq X$ is an integral closed subscheme of codimension $1$, then we have an exact sequence
  \[
    \Z \to \Cl(X) \to \Cl(X \setminus Z) \to 0,
  \]
  where $n \in \Z$ is mapped to $[nZ]$.
\end{prop}

\begin{proof}
  The map $\Cl(X) \to \Cl(X \setminus Z)$ is given by restriction. If $S$ is a Weil divisor on $X \setminus Z$, then $\bar{S} \subseteq X$ maps to $S$ under the restriction map. So this map is surjective.

  Also, that $[nZ]|_{X \setminus Z}$ is trivial. So the composition of the first two maps vanishes. To check exactness, suppose $D$ is a Weil divisor on $X$, principal on $X \setminus Z$. Then $D|_{X \setminus Z} = \dim(f)|_{X \setminus Z}$ for some $f \in K(X)$. Then $D - \div(f)$ is just supported along $Z$. So it must be of the form $nZ$.
\end{proof}

If we remove something of codimension at least two, then something even simpler happens.
\begin{prop}
  If $Z \subseteq X$ has codimension $@$, then $\Cl(X) \to \Cl(X \setminus Z)$ is an isomorphism.
\end{prop}
The proof is the same as above, except no divisor can be supported on $Z$.

\begin{eg}
  $\Cl(\A^2 \setminus \{0\}) = \Cl(\A^2)$
\end{eg}
To compute $\Cl(\A^2)$, we need the following proposition:
\begin{prop}
  If $A$ is a Noetherian ring, regular in codimension $1$, then $A$ is a UFD iff $A$ is normal and $\Cl(\Spec A) = 0$
\end{prop}

\begin{proof}
  If $A$ is a UFD, then it is normal, and every prime ideal of height $1$ is principally generated. So if $D \in \Spec A$ is Weil and irreducible, then $D = V(f)$ for some $f$, and hence $(f) = I_D$.

  Conversely, if $A$ is normal and $\Cl(\Spec A) = 0$, then every Weil divisor is principal. So if $I$ is a height $1$ prime ideal, then $V(I) = D$ for some Weil divisor $D$. Then $D$ is principal. So $I = (f)$ for some $f$. So $A$ is a Krull algebra with principally generated height $1$ prime ideals. So it is a UFD.
\end{proof}

\begin{eg}
  $\Cl(\A^2) = 0$.
\end{eg}

\begin{eg}
  Consider $\P^n$. We have an exact sequence
  \[
    \Z \to \Cl(\P^n) = \Cl(\P^n \setminus \P^{n - 1}) = \Cl(\A^n) \to 0.
  \]
  So $\Z \to \Cl(\P^n)$ is surjective. So $\Cl(\P^n)$ is generated by a hyperplane. Moreover, since any principal divisor has degree $0$, it follows that $nH \not= 0$ for all $n > 0$. This $H$ corresponds to $\mathcal{O}(1)$.
\end{eg}

\begin{eg}
  Let $X = V(xy - z^2) \subseteq \A^3$. Let $Z = V(x, z)$. We claim that $\Cl(X) \cong \Z/2\Z$, and is generated by $[Z]$.

  We compute
  \[
    K[X \setminus Z] = \frac{K[x, x^{-1}, y, z]}{(xy - z)} \cong \frac{K[x, x^{-1}, t, z]}{(t - z)} = K[x, x^{-1}, z],
  \]
  where $t = xy$, and this is a UFD. So $\Cl(X \setminus Z) = 0$.

  We now want to compute the kernel of the map $\Z \to \Cl(X)$. We have
  \[
    \mathcal{O}_{X, Z} = \left(\frac{K[x, y, z]}{xy - z^2}\right)_{(x, z)} = \left(\frac{k[x, y, y^{-1}, z]}{x - z^2}\right)_{(x, y)} = k[y, y^{-1}, z]_{(z)}.
  \]
  Unsurprisingly, this is a DVR, and crucially, the uniformizer is $z$. So we know that $\div(x) = 2Z$. So we know that $2\Z \subseteq \ker(\Z \to \Cl(X))$. There is only one thing to check, which is that $(x, y)$ is not principal. To see this, consider
  \[
    T_{(0)}X = \A^3,\quad T_{(0)} (Z \subseteq X) = \A^1.
  \]
  But if $Z$ were principal, then $I_{Z, 0} = (f)$ for some $f \in \mathcal{O}_{X, 0}$. But then $T_0(Z) \subseteq T_0 X$ will be $V([df])$. But then $V([df])$ should have dimension at least $2$, which is a contradiction.
\end{eg}

\begin{prop}
  Let $X$ be Noetherian and regular in codimension one. Then
  \[
    \Cl(X) = \Cl(X \times \A^1).
  \]
\end{prop}
\begin{proof}
  We have a projection map
  \begin{align*}
    \pr_1^*: \Cl(X) &\to \Cl(X \times \A^1)\\
    [D_i] &\mapsto [D_i \times \A^1]
  \end{align*}
  It is an exercise to show that is injective. `

  To show surjectivity, suppose $D \subseteq X \times \A^1$ is a prime divisor, and $\pr_1(D) = X$. We may assume that $X$ is affine, using the naturality of the previous exact sequence and the $4$-lemma. Let $\mathcal{I}_D$ be the ideal of $D$ in $K[X \times \A^1] = K[X][t] \subseteq K(X) [t]$, and $\mathcal{I}_D^0$ the ideal generated by $\mathcal{I}_D$ in $K(X)[t]$. Since $\pr_1(D) = X$, we know $\mathcal{I}_D^0 \not= 1$. But since $K(X)[t]$ is a polynomial ring, we know $\mathcal{I}_D^0 = (f)$. Since $f \in K(X)[t] = K[X]_{(x_1, \ldots, x_n)} [t]$. % complete
\end{proof}

\begin{ex}
  We have $\Cl(X \times \P^n) = \Z \oplus \Cl(X)$.
\end{ex}

\begin{prop}
  Let $X$ be a smooth projective variety over an algebraically closed field. Let $D_0$ be a divisor on $X$.
  \begin{enumerate}
    \item For all $s \in H^0(X, \mathcal{O}_X(D))$, $\div(S)$ is an effective divisor linearly equivalent to $D$.
    \item If $D \sim D_0$ and $D \geq 0$, then there is $s \in H^0(\mathcal{O}_X(D_0))$ such that $\div(s) = D$
    \item If $s, s' \in H^0(\mathcal{O}_X(D_0))$ and $\div(s) = \div(s')$, then $s' = \lambda s$ for some $\lambda \in K^*$.
  \end{enumerate}
\end{prop}
\begin{proof}\leavevmode
  \begin{enumerate}
    \item Done last time.
    \item If $D \sim D_0$, then $D - D_0 = \div(f)$ for some $f \in K(X)$. Then $(f) + D_0 \geq 0$. So $f$ induces a section $s \in H^0(\mathcal{O}_X(D_0))$. Then $\div(s) = D$.
    \item We have $\frac{s'}{s} \in K(X)^*$. So $\div\left(\frac{s'}{s}\right)$. So $\frac{s'}{s} \in H^0(\mathcal{O}^*) = K^*$.\qedhere
  \end{enumerate}
\end{proof}

\begin{defi}[Complete linear system]\index{complete linear system}
  A \emph{complete linear system} is the set of all effective divisors linearly equivalent to a given divisor $D_0$, written $|D_0|$\index{$\lvert D\rvert$}.
\end{defi}
Then $|D_0|$ is the projectivization of the vector space $H^*(X, \mathcal{O}(D_0))$.


Sometimes we don't want absolutely everything.
\begin{defi}[Linear system]\index{linear system}
  A linear system $\delta \subseteq |D_0|$ is just a linear subspace of the projective space structure on $|D_0|$.
\end{defi}

If $\mathcal{L}$ is an invertible sheaf and $|V|$ A linear system of $\mathcal{L}$ on $X$, then the $\mathcal{O}_X$-action of $\mathcal{L}$ induces a map
\[
  V \otimes \mathcal{O}_X \to \mathcal{L}.
\]
Tensoring with $\mathcal{L}^{-1}$, this gives a map
\[
  V \otimes \mathcal{L}^{-1} \to \mathcal{O}_X.
\]
The image is an $\mathcal{O}_X$-subbmodule, hence an ideal sheaf. This ideal $b_{|V|}$ is called the \term{base ideal} of $|V|$ on $X$. We say $|V|$ is free if $b_{|v|} = \mathcal{O}_X$. This is the case iff $V$ gives a well-defined morphism to $\P^n$. In general, we get a rational morphism $X \dashrightarrow \P(V)$.

\begin{defi}[(Very) ample divisor]\index{very ample}\index{ample}
  We say a Cartier divisor $D$ is \emph{(very) ample} when $\mathcal{O}_X(D)$ is.
\end{defi}
By Serre's theorem, if $\mathcal{A}$ is ample and $X$ is projective, and $\mathcal{L}$ is any line bundle, then
\[
  h^0(X, \mathcal{L} \otimes \mathcal{A}^n) = \sum (-1)^i h^i(X, \mathcal{L} \otimes \mathcal{A}^n) = \chi(X, \mathcal{L} \otimes \mathcal{A}^n)
\]
for $n$ sufficiently large. At least in the case of curves, we have a nice way to understand this:

\begin{thm}[Riemann--Roch theorem]\index{Riemann--Roch theorem}
  If $C$ is a smooth projective curve, then
  \[
    \chi(\mathcal{L}) = \deg(\mathcal{L}) + 1 - g(C).
  \]
\end{thm}

Now let $D$ and $H$ be Cartier divisors, with $H$ very ample. Then by (another) Serre's theorem, we know $D + nH$ is globally generated when $n$ is sufficiently large, hence (by adding one more copy of $H$) it is very ample for $n$ sufficiently large.

\begin{prop}
  Let $D$ be a Cartier divisor on a projective normal scheme .Then $D \sim H_1 - H_2$ for some very ample divisors $H_i$. We can in fact take $H_i$ to be effective, and if $X$ is smooth, then we can take $H_i$ to be smooth and intersecting transversely.
\end{prop}

This is a consequence of Bertini's theorem.
\begin{thm}[Bertini]\index{Bertini's theorem}
  Let $X$ be a smooth projective variety over an algebraically closed field $K$, and $D$ a very ample divisor. Then there exists a Zariski open set $U \subseteq |D|$ such that for all $H \in U$, $H$ is smooth on $X$ and if $H_1 \not= H_2$, then $H_1$ and $H_2$ intersect transversely.
\end{thm}

\section{Surfaces}
Let $X$ be a smooth projective surface over an algebraically closed curve, and $C, D \subseteq X$ smooth curves intersecting transversely. We then have a short exact sequence
\[
  0 \to \mathcal{O}_X(-C + D) \to \mathcal{O}_X(D) \to \mathcal{O}_X (D)|_{C} = \mathcal{O}_C(D \cap C) \to 0.
\]
So we have a long exact sequence
\[
  0 \to H^0(\mathcal{O}_X(-C + D)) \to H^0(\mathcal{O}_X(D)) \to H^0(C, \mathcal{O}_C(D \cap D)) \to \cdots.
\]
Moreover, the section $1_{D} \in H^0(\mathcal{O}_X(D))$ restricts to the canonical section $1_{C \cap D} \in H^0(\mathcal{O}_C(D \cap C))$. Now observe that
\[
  |C \cap D| = \deg_C(\mathcal{O}_C(D)) = h^0(\mathcal{O}_{C \cap D}) = \chi(\mathcal{O}_{C \cap D}).
\]
since $D|_C \geq 0$, and $\mathcal{O}_{C \cap D}$ is a skyscraper sheaf supported at $C \cap D = \{p_1, \ldots, p_k\}$, counting with multiplicity (which is always $1$ by transversality).

Now consider the sequences
\[
  \begin{tikzcd}[row sep=tiny]
    0 \ar[r] & \mathcal{O}_X(-C) \ar[r] & \mathcal{O}_X \ar[r] & \mathcal{O}_C \ar[r] & 0\\
    0 \ar[r] & \mathcal{O}_X(-C - D) \ar[r] & \mathcal{O}_X(-D) \ar[r] & \mathcal{O}_C(-D|_C) \ar[r] & 0\\
    0 \ar[r] & \mathcal{O}_C(-D|_C) \ar[r] & \mathcal{O}_C \ar[r] & \mathcal{O}_{C \cap D} \ar[r] & 0
  \end{tikzcd}
\]
This allows us to write
\begin{align*}
  \chi(\mathcal{O}_{C \cap D}) &= -\chi(C, \mathcal{O}_C(-D|_C)) + \chi(C, \mathcal{O}_C)\\
  &= + \chi(\mathcal{O}_X(-C - D)) - \chi(\mathcal{O}_X(-D)) + \chi(C, \mathcal{O}_C)\\
  &= + \chi(\mathcal{O}_X(-C - D)) - \chi(\mathcal{O}_X(-D)) - \chi(\mathcal{O}_X(-C)) + \chi(\mathcal{O}_X).
\end{align*}

Now take divisors $D_1, D_2$ on $X$. Then we can consider\index{$D_1 \cdot D_2$}
\[
  D_1 \cdot D_2 = \chi(\mathcal{O}_X) - \chi(\mathcal{O}_X(-D_1 - D_2)) - \chi(\mathcal{O}_X(-D_1)) - \chi(\mathcal{O}_X(-D_2)).
\]
This gives us a function $\Div(X) \times \Div(X) \to \Z$. This is called the \term{intersection product}. We observe that
\begin{itemize}
  \item Since this is defined in terms of the Euler characteristic, which depends only on the sheaves, the product $D_1 \cdot D_2$ depends only on the classes of $D_1, D_2$ in $\Pic(X)$.
  \item $D_1 \cdot D_2 = D_2 \cdot D_1$.
  \item $D_1 \cdot D_2 = |D_1 \cap D_2|$ if $D_1$ and $D_2$ intersected tranasversely.
  \item %Observing that
%    \[
%      (D_1 + D_2, C) = \deg_C (\mathcal{O}_C(D_1 + D_2))
%    \]
%    for a curvre $C$, we observe that
    The intersection product is bilinear. % prove % this is unique
\end{itemize}

Let $\mathcal{B}_X \subseteq \Pic(X)$ be the cone of very ample line bundles on $X$ modulo isomorphism. By Bertini's theorem, given any two $D_1, D_2 \in \Pic(X)$, we can pick two curves $C_i \in |D_i|$ that intersect transversely. Then we have
\[
  (D_1 \cdot D_2) = |C_1 \cap C_2|.
\]
Note that every divisor is the difference of two very ample divisors So the span of $\mathcal{B}_x$ is $\Pic(X)$. So given any two divisors $E_i, E_j$, we can write
\begin{align*}
  E_i &= D_{i, 1} - D_{i, 2}\\
  E_j &= D_{j, 1} - D_{j, 2}
\end{align*}
with $D_{j, k}$ very ample. We can then compute
\[
  (E_i \cdot E_j) = (D_{i, 1} \cdot D_{j, 2}) + (D_{i, 2} \cdot D_{j, 2}) - (D_{i, 1} \cdot D_{j, 2}) + (D_{i, 2}\cdot D_{j, 1}).
\]
\begin{eg}
  Take $X = \P^2$. We saw that $\Pic(\P^2) \cong \Z$, generated by a hyperplane $\ell$. So all we need to understand is what $\ell^2$ is. But two transverse lines intersect at a point. So $\ell^2 = 1$. Thus, the intersection product on $\Pic(\P^2)$ is just ordinary multiplication. In particular, if $D_1, D_2$ are curves that intersect transversely, we find that
  \[
    D_1 \cdot D_2 = \deg(D_1) \deg(D_2).
  \]
  This is Bezout's theorem!
\end{eg}
\begin{ex}
  Let $C_1, C_2 \subseteq X$ be curves without common components. Then
  \[
    C_1 \cdot C_2 = \sum_{p \in C_1 \cap C_2} \ell(\mathcal{O}_{C_1 \cap C_2}),
  \]
  where for $p \in C_1 \cap C_2$, if $C_1 = V(x)$ and $C_2 = V(y)$, then
  \[
    \ell(\mathcal{O}_{C_1 \cap C_2}) = \dim_k(\mathcal{O}_{X, x}/(x, y))
  \]
  counts multiplicity.
\end{ex}

\begin{eg}
  Take $X = \P^1 \times \P^1$. Then
  \[
    \Pic(X) = \Z^2 = \Z[p_1^* \mathcal{O}(1)] \oplus \Z[p_2^ \mathcal{O}(1)].
  \]
  Let $A = p_1^* \mathcal{O}(1), B = p_2^* \mathcal{O}(1)$. Then we see that
  \[
    A^2 = B^2 = A \cdot B = 1
  \]
  by high school geometry.
\end{eg}

\begin{defi}[$\Num_0$]\index{$\Num_0$}
  Let
  \[
    \Num_0 = \{D \in \Div(X) : D \cdot E = 0\text{ for all }E \in \Div(X)\} \subseteq \Div(X).
  \]
\end{defi}
\begin{defi}[N\'eron--Severi group]\index{N\'eron--Severi group}
  We define the \term{N\'eron--Severi group}
  \[
    \NS(X) = \Div(X)/\Num_0(X).
  \]
\end{defi}

We can now state Riemann--Roch for surfaces.
\begin{thm}[Riemann--Roch for surfaces]\index{Riemann--Roch for surfaces}
  Let $D \in \Div(X)$. Then
  \[
    \chi(X, \mathcal{O}_X(D)) = \frac{D \cdot (D - K_X)}{2} + \chi(\mathcal{O}_X),
  \]
  where \term{$K_X$} is the \term{canonical divisor}.
\end{thm}

\begin{proof}
  We can assume $D = H_1 - H_2$ for very ample line bundles $H_1, H_2$, which are smoothly irreducible curves that intersect transversely. We have
  \[
    \begin{tikzcd}
      0 \ar[r] & \mathcal{O}_X(H_1 - H_2) \ar[r] & \mathcal{O}_X(H_1) \ar[r] & \mathcal{O}_{H_2}(H_1|_{H_2}) \ar[r] & 0\\
      0 \ar[r] & \mathcal{O}_X \ar[r] & \mathcal{O}_X(H_1) \ar[r] & \mathcal{O}_{H_1}(H_1) \ar[r] & 0
    \end{tikzcd}
  \]
  where $\mathcal{O}_{H_1}(H_1)$ means the restriction of the \emph{line bundle} $\mathcal{O}_X(H_1)$ to $H_1$. We then find that
  \begin{align*}
    \chi(H_1 - H_2) &= \chi(\mathcal{O}_X(H_1)) - \chi(H_2, \mathcal{O}_{H_2}(H_1|_{H_2}))\\
    &= \chi(\mathcal{O}_X) + \chi(H_1, \mathcal{O}_{H_1}(H_1)) - \chi(H_2, \mathcal{O}_{H_2}(H_1|_{H_2}))
  \end{align*}
  The first term appears in our Riemann--Roch theorem, and we can use Riemann--Roch for curves to understand the remaining. We have
  \[
    \chi(H_i, \mathcal{O}_{H_i}(H_1)) = \deg(\mathcal{O}_{H_i}(H_1)) + 1 - g(H_i) = (H_i \cdot H_1) + 1 - g(H_i).
  \]
  So we would be good if we can write $g(H_i)$ in terms of intersection numbers. But we have
  \[
    2g(H_i) - 2 = \deg K_{H_i}.
  \]
  To compute $\deg K_{H_i}$, we use the adjunction formula:
  \begin{thm}[Adjunction formula]\index{adjunction formula}
    Let $X$ is a smooth surface, and $C \subseteq X$ a smooth curve, then
    \[
      \mathcal{O}_X(K_X) \otimes \mathcal{O}_X(C)|_C \cong \mathcal{O}_C(K_C).
    \]
  \end{thm}
  We will prove this later. This allows us to conclude
  \[
    \deg(K_{H_i}) = H_i \cdot (K_X + H_i).
  \]
  So we have
  \[
    \chi(\mathcal{O}_X(D)) = \chi(\mathcal{O}_X) + H_1^2 - \frac{(K_X + H_1) \cdot H_1}{2} - H_1 \cdot H_2 + \frac{K_X + H_2 \cdot H_2}{2}.\qedhere
  \]
\end{proof}

\begin{proof}[Proof of adjunction formula]
  We claim that we have a short exact sequence on $C$
  \[
    \begin{tikzcd}
      0 \ar[r] & \mathcal{O}_X(-C)/\mathcal{O}_X(-2C) \ar[r] & \mathcal{O}_X^1|_C \to \Omega_C^1 \to 0.
    \end{tikzcd}
  \]
  Once we have this, we note that we have the short exact sequence
  \[
    \begin{tikzcd}
      0 \ar[r] & \mathcal{O}_X(-2C) \ar[r] & \mathcal{O}_X(-C) \ar[r] & \mathcal{O}_X(-C)/\mathcal{O}_X(-2C) \ar[r] & 0.
    \end{tikzcd}
  \]
  But then $\mathcal{O}_X(-C) = \mathcal{I}_C$. So we know that $\mathcal{O}_X(-C)/\mathcal{O}_X(-2C) \cong \mathcal{O}_C(-C)$. So
  \[
    \mathcal{O}_X(K_X) = \det(\Omega_X^1)
  \]
  So restricting to $C$, we have
  \[
    \mathcal{O}_X(K_X)|_C = \det(\Omega^1_X|_C) = \det(\mathcal{O}_C(-C)) \otimes \det(\Omega^1_C).
  \]
  To prove the claim, let $f$ be a local equation for $C$ on $U$ affine open. Then
  \[
    \mathcal{O}_U(-C)|_C = \mathcal{O}_U \cdot f.
  \]
  So we have the map
  \[
    g \cdot f \mapsto \d (g \cdot f) \in \Omega^1_X|_C,
  \]
  and
  \[
    \d (gf) = (\d g)f + g\;\d f = g\;\d f,
  \]
  since $f$ vanishes on $C$. Since $C$ is smooth, $\d f$ generates $\Omega^1_X|_p$ for all $p \in C$. We then check that this doesn't depend on $f$.
\end{proof}

\printindex
\end{document}
