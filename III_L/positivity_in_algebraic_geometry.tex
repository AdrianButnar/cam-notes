\documentclass[a4paper]{article}

\def\npart {III}
\def\nterm {Lent}
\def\nyear {2018}
\def\nlecturer {S.\ Svaldi}
\def\ncourse {Positivity in Algebraic Geometry}

\input{header}

\newcommand\A{\mathbb{A}}
\newcommand\val{\mathrm{val}}
\renewcommand\div{\mathrm{div}}
\newcommand\Cl{\mathrm{Cl}}
\newcommand\WDiv{\mathrm{WDiv}}
\newcommand\Div{\mathrm{Div}}
\newcommand\CaDiv{\mathrm{CaDiv}}
\newcommand\Pic{\mathrm{Pic}}
\newcommand\Num{\mathrm{Num}}
\newcommand\Amp{\mathrm{Amp}}
\newcommand\Nef{\mathrm{Nef}}
\newcommand\NS{\mathrm{NS}}
\newcommand\Bl{\mathrm{Bl}}
\DeclareMathOperator\red{red}

\begin{document}
\maketitle
{\small
\setlength{\parindent}{0em}
\setlength{\parskip}{1em}
This class aims at giving an introduction to the theory of divisors, linear systems and their positivity properties on projective algebraic varieties.

The first part of the class will be dedicated to introducing the basic notions and results regarding these objects and special attention will be devoted to discussing examples in the case of curves and surfaces.

In the second part, the course will cover classical results from the theory of divisors and linear systems and their applications to the study of the geometry of algebraic varieties.

If time allows and based on the interests of the participants, there are a number of more advanced topics that could possibly be covered: Reider's Theorem for surfaces, geometry of linear systems on higher dimensional varieties, multiplier ideal sheaves and invariance of plurigenera, higher dimensional birational geometry.

\subsubsection*{Pre-requisites}
The minimum requirement for those students wishing to enroll in this class is their knowledge of basic concepts from the Algebraic Geometry Part 3 course, i.e.\ roughly Chapters 2 and 3 of Hartshorne's Algebraic Geometry.

Familiarity with the basic concepts of the geometry of algebraic varieties of dimension 1 and 2 --- e.g.\ as covered in the preliminary sections of Chapters 4 and 5 of Hartshorne's Algebraic Geometry --- would be useful but will not be assumed --- besides what was already covered in the Michaelmas lectures.

Students should have also some familiarity with concepts covered in the Algebraic Topology Part 3 course such as cohomology, duality and characteristic classes.
}
\tableofcontents

\section{Introduction}
Fix a field $K$. The first problem we want to look at is the following:
\begin{problem}
  Classify all finitely-generated field extension $L/K$.
\end{problem}
A closely related problem is
\begin{problem}
  Classify all towers of field extensions $L/M/K$.
\end{problem}
In general, we don't want to consider finite extensions --- this falls within the scope of Galois theory instead.

In general, given a finite extension $L/K$, we can factorize it into a tower $L/M/K$, where $M/K$ is purely transcendental, i.e.\ $M \cong K(x_1, \ldots, x_n)$ is a field of rational functions over $K$.

A large class of examples comes from \term{function fields} of algebraic varieties, $K(X)$.
\begin{eg}
  Recall that if $X$ is affine, then $K(X)$ is the field of fractions of the ring of functions of $X$, i.e.\ $Q(K[X])$.
\end{eg}

\begin{question}
  Are these all the examples of finitely-generated field extensions $L/K$?
\end{question}


\begin{lemma}
  Let $\Char K = 0$. If $L/K$ is finitely-generated and not finite, then there exists an algebraic variety $X/K$ such that $K(X) \cong L$.
\end{lemma}
Note that the condition is satisfied in particular if $K$ is algebraically closed.

\begin{proof}
  We factor $L/M/K$, where $M/K$ is purely transcendental, say $M = K(x_1, \ldots, x_n) = K(\A^n)$. Since $\Char(K) = 0$, we can use the primitive element theorem to get that $L = M(\alpha)$ for some $\alpha \in L$. Then if $f$ is the minimal polynomial for $\alpha$, then
  \[
    L \cong Q(K[x_1, \ldots, x_n, x]/(f(x))).\qedhere
  \]
\end{proof}


now suppose $\varphi: x \to y$ is a dominant birational map, % make birational
i.e.\ $\overline{\varphi(X)} = Y$. Then this induces a map $\varphi^* : K(Y) \to K(X)$.

Indeed, an element of $K(Y)$ is just a rational function $Y \to \A^1_K$, and pre-composing with $\varphi$ gives the desired function. The dominance ensures the composition is well-defined.

Now if every embedding of field extensions arise this way, then we have reduced our problem to studying algebraic varieties over $K$ and their rational dominant maps. This is indeed the case.
\begin{thm}
  Let $K$ be a field with $\Char K = 0$. Then there is an equivalence of categories between
  \[
    \left\{ \parbox{4.8cm}{\centering algebraic varieties over $K$\\ rational dominant morphisms}\right\} \longleftrightarrow \left\{\parbox{5.3cm}{\centering infinite f.g.\ field extensions over $K$\\field embeddings}\right\}
  \]
\end{thm}

\begin{proof}
  We define a functor from the left category to the right by sending a variety $X$ to the field of rational functions on $X$, $K(X)$, and morphisms are as above. We have already seen that this is essentially surjective. To show it is fully faithful, suppose $X, Y$ are algebraic varieties over $K$, and $\psi: K(Y) \hookrightarrow K(X)$. We want to show that $\psi = \varphi^*$ for some rational dominant map $X \to Y$.

  We can assume that $X$ and $Y$ are affine, since every variety is birationally equivalent to any Zariski open subset. Then $K(X) = Q(K[X])$ and $K(Y) = Q(K[Y])$. So in particular, we have an embedding $K[Y] \hookrightarrow K(X)$. Since $K[Y]$ is finitely-generated, we can produce a factorization
  \[
    \begin{tikzcd}
      K[Y] \ar[r, hook] \ar[dr, hook] & K(X) \\
      & K[X]_{s_1, \ldots, s_n} \ar[u, hook]
    \end{tikzcd}
  \]
  for some $s_1, \ldots, s_n$. But then $K[X]_{s_1, \ldots, s_n} = K[U]$ for some open $U \subseteq X$. Then the map $K[Y] \to K[U]$ determines a map $U \to Y$, hence a rational map $X \to Y$. The injectivity of the map $K[Y] \to K[U]$ corresponds to the fact that the induced map $U \to Y$ is dominant. So we are done.
\end{proof}

\section{Divisors}
\subsection{Projective embeddings}
Our results here will be stated for rather general schemes, but ultimately, we are only interested in algebraic varieties.

We are interested in the following problem --- given a scheme $X$, can we embed it in projective space? The first observation that $\P^n$ comes with a very special line bundle $\mathcal{O}(1)$, and every embedding $X \hookrightarrow \P^n$ gives pulls back to a corresponding sheaf $\mathcal{L}$ on $X$.

The key property of $\mathcal{O}(1)$ is that it has \emph{global} sections $x_0, \ldots, x_n$. These global sections generate $\mathcal{O}(1)$ as an $\mathcal{O}_X$-module.

\begin{defi}[Generating section]\index{generating section}
  Let $X$ be a scheme, and $\mathcal{F}$ a sheaf of $\mathcal{O}_X$-modules. Let $s_0, \ldots, s_n \in H^0(X, \mathcal{F})$ be sections. We say the sections \emph{generate} $\mathcal{F}$ if the natural map
  \[
    \bigoplus_{i = 0}^{n + 1} \mathcal{O}_X \to \mathcal{F}
  \]
  induced by the $s_i$ is a surjective map of $\mathcal{O}_X$-modules.
\end{defi}

The generating sections are preserved under pullbacks. So if $X$ is embedded into $\P^n$, then it should have a corresponding line bundle generated by $n + 1$ global sections. Indeed, we have the following theorem:
\begin{thm}
  Let $A$ be any ring, and $X$ a scheme over $A$.
  \begin{enumerate}
    \item If $\varphi: X \to \P^n$ is a morphism over $A$, then $\varphi^* \mathcal{O}_{\P^n}(1)$ is an invertible sheaf on $X$, generated by the sections $\varphi^* x_0, \ldots, \varphi^* x_n \in H^0(X, \varphi^* \mathcal{O}_{\P^n}(1))$.
    \item If $\mathcal{L}$ is an invertible sheaf on $X$, and if $s_0, \ldots, s_n \in H^0(X, \mathcal{L})$ which generate $\mathcal{L}$, then there exists a unique morphism $\varphi: X \to \P^n$ such that $\varphi^* \mathcal{O}(1) \cong \mathcal{L}$ and $\varphi^* x_i = s_i$.
  \end{enumerate}
\end{thm}

This theorem highlights the importance of studying line bundles and their sections, and in some sense, understanding these is the whole focus of the course.

\begin{proof}\leavevmode
  \begin{enumerate}
    \item The pullback of an invertible sheaf is an invertible, and the same for sections. Since $x_0, \ldots, x_n$ generate $H^0(\mathcal{O}_{\P^n}(1))$, they generate, and this is again preserved under pullback.
    \item In short, we map $x \in X$ to $[s_0(x): \cdots : s_n(x)] \in \P^n$.

      In more detail, define $X_{s_i} = \{p \in X: s_i \in \mathfrak{m}_p \mathcal{L}_p\}$. This is a Zariski open set, and $s_i$ is invertible on $X_{s_i}$. Thus there is a dual section $s_i^\vee \in \mathcal{L}^{\vee}$ such that $s_i \otimes s_i^\vee \in \mathcal{L} \otimes \mathcal{L}^\vee \cong \mathcal{O}_X$ is equal to $1$. Define the map $X_{s_i} \to \A^n$ by the map
      \begin{align*}
        K[\A^n] &\to H^0(X_{s_i}, \mathcal{O}_{s_i})\\
        y_i &\mapsto s_j \otimes s_i^\vee.
      \end{align*}
      Since the $s_i$ generate, they cannot simultaneously vanish on a point. So $X = \bigcup X_{s_i}$. Identifying $\A^n$ as the chart of $\P^n$ where $x_i \not= 0$, this defines the desired map $X \to \P^n$.\qedhere
  \end{enumerate}
\end{proof}

The theorem tells us we get a map from $X$ to $\P^n$. However, it says nothing about how nice these maps are. In particular, it says nothing about whether or not we get an embedding.

\begin{defi}[Very ample sheaf]\index{very ample sheaf}\index{sheaf!very ample}
  Let $X$ be an algebraic variety over $K$, and $\mathcal{L}$ be an invertible sheaf. We say that $\mathcal{L}$ is very ample if there is a closed immersion $\varphi: X \to \P^n$ such that $\varphi^* \mathcal{O}_{\P^n}(1) \cong \mathcal{L}$.
\end{defi}
It would be convenient if we had a good way of identifying when $\mathcal{L}$ is very ample. In this section, we can only give a rather formal and not very useful criterion for when this is the case. As we progress further in the course, we shall obtain more concrete criteria in the cases of interest.

So how can we understand when a map $X \hookrightarrow \P^n$ is an embedding? If it were an embedding, then it in particular is injective. So given any two points in $X$, there is a hyperplane in $\P^n$ that passes through one but not the other. But being an embedding means something more. We want the differential of the map to be injective as well.

\begin{prop}
  Assume $K = \bar{K}$, and $X$ is a projective variety over $K$. Fix an invertible sheaf $\mathcal{L}$ on $X$, and sections $s_0, \ldots, s_n \in H^0(X, \mathcal{L})$ generating $\mathcal{L}$, and write $V = \bra s_0, \ldots, s_n\ket$ for the linear span. Then the associated map $\varphi: X \to \P^n$ is a closed embedding iff
  \begin{enumerate}
    \item For every distinct closed points $p \not= q \in X$, there exists $s_{p, q} \in V$ such that $s_{p, q} \in \mathfrak{m}_p \mathcal{L}_p$ but $s_{p, q} \not \in \mathfrak{m}_q \mathcal{L}_q$.
    \item For every $p \in X$, the set $\{s \in V \mid s \in \mathfrak{m}_p \mathcal{L}_p\}$ spans the vector space $\mathfrak{m}_p \mathcal{L}_p /\mathfrak{m}^2_p \mathcal{L}_p$.
  \end{enumerate}
\end{prop}

\begin{defi}[Separate points and tangent vectors]
  With the hypothesis of the proposition, we say that
  \begin{itemize}
    \item elements of $V$ \term{separate points} if $V$ satisfies (i).
    \item elements of $V$ \term{separate tangent vectors} if $V$ satisfies (ii).
  \end{itemize}
\end{defi}

\begin{proof}\leavevmode
  \begin{itemize}
    \item[$(\Rightarrow)$] Suppose $\phi$ is a closed immersion. Then it is injective on points. So suppose $p \not= q$ are (closed) points. Then there is some hyperplane $H_{p, q}$ in $\P^n$ passing through $p$ but not $q$, and $H_{p, q}$ is represented by a global section of $\mathcal{O}(1)$. Then $s_{p, q} = \varphi^* H_{p, q} \in V \subseteq H^0(X, \mathcal{L})$ is such that $s_{p, q} \in \mathfrak{m}_p \mathcal{L}_p$ and $s_{p, q} \not \in \mathfrak{m}_q \mathcal{L}_q$. So (i) is satisfied.

      To see (ii), observe that by definition, the map of sheaves $\mathcal{O}_{\P^n} \to \varphi_* \mathcal{O}_X$ is surjective. So if $p \in X$ is a closed point, then in particular $\mathfrak{m}_{p, \P^n} \to \mathfrak{m}_{p, X}$ is surjective. This implies that the quotient
       \[
        \frac{\mathfrak{m}_{p, \P^n}}{\mathfrak{m}_{p, \P^n}^2} \twoheadrightarrow \frac{\mathfrak{m}_{p, X}}{\mathfrak{m}_{p, X}^2}.
      \]
      is also surjective. But on $\P^n$, $x_0, \ldots, x_n$ certainly spans $\mathfrak{m}_{p, \P^n}$. So their image $s_0, \ldots, s_n$ in $\mathfrak{m}_{p, X}$ also span $\mathfrak{m}_{p, X}/\mathfrak{m}_{p, X}^2$.

    \item[$(\Leftarrow)$] We first show that $\varphi$ is injective on closed points. For any $p \not= q \in X$, write the given $s_{p, q}$ as
      \[
        s_{p, q} = \sum \lambda_i s_i = \sum \lambda_i \varphi^* x_i = \varphi^* \sum \lambda_i x_i
      \]
      for some $\lambda_i \in K$. So we can take $H_{p, q}$ to be given by the vanishing set of $\sum \lambda_i x_i$, and so it is injective on closed point. It follows that it is also injective on schematic points.

      To show that $\varphi$ is in fact a closed immersion, we need to show that $\mathcal{O}_{\P^n} \to \varphi_* \mathcal{O}_X$ is surjective. As before, it is enough to prove that it holds at the level of stalks over closed points. To show this, we apply the following lemma:
      \begin{lemma}
        Let $f: A \to B$ be a local morphism of local rings such that
        \begin{itemize}
          \item $A/\mathfrak{m}_A \to B/\mathfrak{m}_B$ is an isomorphism;
          \item $\mathfrak{m}_A \to \mathfrak{m}_B/\mathfrak{m}_B^2$ is surjective; and
          \item $B$ is a finitely-generated $A$-module.
        \end{itemize}
        Then $f$ is surjective.\fakeqed
      \end{lemma}
      To check the first condition, note that we have
      \[
        \frac{\mathcal{O}_{p, \P^n}}{\mathfrak{m}_{p, \P^n}} \cong \frac{\mathcal{O}_{p, X}}{\mathfrak{m}_{p, X}} \cong K.
      \]
      Now since $\mathfrak{m}_{p, \P^n}$ is generated by $x_0, \ldots, x_n$, the second condition is the same as saying
      \[
        \mathfrak{m}_{p, \P^n} \to \frac{\mathfrak{m}_{p, X}}{\mathfrak{m}_{p, X}^2}
      \]
      is surjective. The last part is immediate.\qedhere
  \end{itemize}
\end{proof}
Unsurprisingly, this is not a very pleasant hypothesis to check, since it requires us to really understand the structure of $V$. In general, given an invertible sheaf $\mathcal{L}$, it is unlikely that we can concretely understand the space of sections. Thus, what we want to do in this course is to simplify this criterion.

One convenient place to start is the following theorem of Serre:
\begin{thm}[Serre]
  Let $X$ be a projective scheme over a Noetherian ring $A$, $\mathcal{L}$ be a very ample invertible sheaf, and $\mathcal{F}$ a coherent $\mathcal{O}_X$-module. Then there exists a positive integer $n_0 = n_0(\mathcal{F}, \mathcal{L})$ such that for all $n \geq n_0$, the twist $\mathcal{F} \otimes \mathcal{L}^n$ is generated by global sections.\fakeqed
\end{thm}

So we can try to weaken the condition of very ampleness to only require the condition of this theorem to hold.
\begin{defi}[Ample sheaf]\index{ample sheaf}
  Let $X$ be a Noetherian scheme over $A$, and $\mathcal{L}$ an invertible sheaf over $X$. We say $\mathcal{L}$ is ample iff for any coherent $\mathcal{O}_X$-module $\mathcal{F}$, there is an $n_0$ such that for all $n \geq n_0$, the sheaf $\mathcal{F} \otimes \mathcal{L}^n$ is generated by global sections.
\end{defi}

While this seems like a rather weak condition, it is actually not too bad. First of all, by taking $\mathcal{F}$ to be $\mathcal{O}_X$, we can find some $\mathcal{L}^n$ that is generated by global sections. So at least it gives some map to $\P^n$. In fact, another theorem of Serre tells us this gives us an embedding.

\begin{thm}[Serre]
  Let $X$ be a scheme of finite type over a Noetherian ring $A$, and $\mathcal{L}$ an invertible sheaf on $X$. Then $\mathcal{L}$ is ample iff there exists $m > 0$ such that $\mathcal{L}^m$ is very ample.
\end{thm}

\begin{proof}\leavevmode
  \begin{itemize}
    \item[($\Leftarrow$)] Let $\mathcal{L}^n$ be very ample, and $\mathcal{F}$ a coherent sheaf. By Serre's theorem, there exists $n_0$ such that for all $j \geq j_0$, the sheafs
      \[
        \mathcal{F} \otimes \mathcal{L}^{mj}, (\mathcal{F} \otimes \mathcal{L}) \otimes \mathcal{L}^{mj}, \ldots, (\mathcal{F} \otimes \mathcal{L}^{m - 1}) \otimes \mathcal{L}^{mj}
      \]
      are all globally generated. So $\mathcal{F} \otimes \mathcal{L}^n$ is globally generated for $n \geq mj_0$.
    \item[($\Rightarrow$)] Suppose $\mathcal{L}$ is ample. Then $\mathcal{L}^m$ is globally generated for $m$ sufficiently large. We claim that there exists $t_1, \ldots, t_n \in H^0(X, \mathcal{L}^N)$ such that $\mathcal{L}|_{X_{t_i}}$ are all trivial (i.e.\ isomorphic to $\mathcal{O}_{X_{t_i}}$), and $X = \bigcup X_{t_i}$.

      By compactness, it suffices to show that for each $p \in X$, there is some $t \in H^0(X, \mathcal{L}^n)$ (for some $n$) such that $p \in X_{t_i}$ and $\mathcal{L}$ is trivial on $X_{t_i}$. First of all, since $\mathcal{L}$ is locally free by definition, we can find an open affine $U$ containing $p$ such that $\mathcal{L}|_U$ is trivial.

      Thus, it suffices to produce a section $t$ that vanishes on $Y = X - U$ but not at $p$. Then $p \in X_t \subseteq U$ and hence $\mathcal{L}$ is trivial on $X_t$. Vanishing on $Y$ is the same as belonging to the ideal sheaf $\mathcal{I}_Y$. Since $\mathcal{I}_Y$ is coherent, ampleness implies there is some large $n$ such that $\mathcal{I}_Y \otimes \mathcal{L}^n$ is generated by global sections. In particular, since $\mathcal{I}_Y \otimes \mathcal{L}^n$ doesn't vanish at $p$, we can find some $t \in \Gamma(X, \mathcal{I}_Y \otimes \mathcal{L}^N)$ such that $t \not \in \mathfrak{m}_p (\mathcal{I}_Y \otimes \mathcal{L}^n)_p$. Since $\mathcal{I}_Y$ is a subsheaf of $\mathcal{O}_X$, we can view $t$ as a section of $\mathcal{L}^n$, and this $t$ works.

      Fix a point $x \in X$, and take an affine open $U$ containing $x$ such that $\mathcal{L}|_U$ is trivial, i.e.\ $\mathcal{L}|_U \cong \mathcal{O}_U$. Define $Z = X \setminus U$.

      We know there exists $\ell$ such that $I_Z \otimes \mathcal{L}^{\ell}$ is globally generated. So in particular, there exists $s \in H^0(X, I_Z \otimes \mathcal{L}^\ell)$ such that $s_x \not \in \mathfrak{m}_X \mathcal{L}_{x, X}$. So we can define $X_S$ to be the affine Zariski open such that $X_s = \{p \in X : s_p \not \in \mathfrak{m}_p \mathcal{L}_p\}$.

      Now given the $X_{t_i}$, for each fixed $i$, we let $\{b_{ij}\}$ generate $\mathcal{O}_{X_{t_i}}$ as an $A$-algebra. Then for large $n$, $c_{ij} = t_i^n b_{ij}$ extends to a global section $c_{ij} \in \Gamma(X, \mathcal{L}^n)$ (by clearing denominators). We can pick an $n$ large enough to work for all $b_{ij}$. Then we use $\{t_i^n, c_{ij}\}$ as our generating sections to construct a morphism to $\P^N$, and let $\{x_i, x_{ij}\}$ be the corresponding coordinates. Observe that $\bigcup X_{t_i} = X$ implies the $t_i^n$ already generate $\mathcal{L}^n$. Now each $x_{t_i}$ gets mapped to $U_i \subseteq \P^N$, the vanishing set of $x_i$. The map $\mathcal{O}_{U_i} \to \varphi_* \mathcal{O}_{X_{t_i}}$ corresponds to the map
      \[
        A[y_i, y_{ij}] \to B_i,
      \]
      where $y_{ij}$ is mapped to $c_{ij}/t_i^n = b_{ij}$. So by assumption, this is surjective, and so we have a closed embedding.\qedhere
  \end{itemize}
\end{proof}

From this, we also see that
\begin{prop}
  Let $\mathcal{L}$ be a sheaf over $X$ (which is itself a projective variety over $K$). Then the following are equivalent:
  \begin{enumerate}
    \item $\mathcal{L}$ is ample.
    \item $\mathcal{L}^m$ is ample for all $m > 0$.
    \item $\mathcal{L}^m$ is ample for some $m > 0$.
  \end{enumerate}
\end{prop}

We will also frequently make use of the following theorem:
\begin{thm}[Serre]
  Let $X$ be a projective scheme over a Noetherian ring $A$, and $\mathcal{L}$ is very ample on $X$. Let $\mathcal{F}$ be a coherent sheaf. Then
  \begin{enumerate}
    \item For all $i \geq 0$ and $n \in \N$, $H^i(\mathcal{F} \otimes \mathcal{L}^n)$ is a finitely-generated $A$-module.
    \item There exists $n_0 \in \N$ such that for all $n \geq n_0$, $H^i(\mathcal{F} \otimes \mathcal{L}^n) = 0$ for all $i > 0$.\fakeqed
  \end{enumerate}
\end{thm}
The proof is exactly the same as the case of $\mathcal{O}(1)$ on $\P^n$.

As before, this theorem still holds for ample sheaves, and in fact characterizes them.
\begin{thm}
  Let $X$ be a proper scheme over a Noetherian ring $A$, and $\mathcal{L}$ an invertible sheaf. Then the following are equivalent:
  \begin{enumerate}
    \item $\mathcal{L}$ is ample.
    \item For all coherent $\mathcal{F}$ on $X$, there exists $n_0 \in \N$ such that for all $n \geq n_0$, we have $H^i(\mathcal{F} \otimes \mathcal{L}^n) = 0$.
  \end{enumerate}
\end{thm}

\begin{proof}
  Proving (i) $\Rightarrow$ (ii) is the same as the first part of the theorem last time.

  To prove (ii) $\Rightarrow$ (i), fix a point $x \in X$, and consider the sequence
  \[
    0 \to \mathfrak{m}_x \mathcal{F} \to \mathcal{F} \to \mathcal{F}_x \to 0.
  \]
  We twist by $\mathcal{L}^n$, where $n$ is sufficiently big, and take cohomology. Then we have a long exact sequence
  \[
    0 \to H^0(\mathfrak{m}_x \mathcal{F}(n)) \to H^0(\mathcal{F}(n)) \to H^0(\mathcal{F}_x(n)) \to H^1(\mathfrak{m}_x \mathcal{F}(n)) = 0.
  \]
  In particular, the map $H^0(\mathcal{F}(n)) \to H^0(\mathcal{F}_x(n))$ is surjective. This mean at $x$, $\mathcal{F}(n)$ is globally generated. Then by compactness, there is a single $n$ large enough such that $\mathcal{F}(n)$ is globally generated everywhere.
\end{proof}

\subsection{Weil divisors}
We now talk about something seemingly unrelated, namely Weil divisors, but we shall soon see that there is a close connection between them.

Let $X$ be a Noetherian scheme. If $X$ is regular in codimension $1$ (e.g.\ if $X$ is normal), which one should think of as saying the singular locus of $X$ having codimension $ \geq 2$. Then if $Y \subseteq X$ is a codimension $1$ integral subscheme, then the local ring $\mathcal{O}_{X, Y}$ is a DVR. So there is a valuation
\[
  \val_Y: \mathcal{O}_{X, Y} \to \Z,
\]
which is the order of vanishing/poles along $Y$.

\begin{defi}[Weil divisor]\index{Weil divisor}
  A \emph{Weil divisor} is a formal sum
  \[
    \sum a_i Y_i,
  \]
  where the $a_i \in \Z$ and $Y_i$ are codimension $1$ integral subschemes. We write $\WDiv(X)$ for the group of Weil divisors of $X$.

  For $K$ a field, a \term{Weil $K$-divisor} is the same where we allow $a_i \in K$.
\end{defi}

\begin{defi}[Effective divisor]\index{effective divisor}
  We say a Weil divisor is \emph{effective} if $a_i \geq 0$ for all $i$. We write $D \geq 0$.
\end{defi}

\begin{defi}[Support]\index{support}
  The \emph{support} of $D = \sum a_i Y_i$ is
  \[
    \supp(D) = \bigcup Y_i.
  \]
\end{defi}
Another important kind of divisors is principal divisors.

\begin{defi}[Principal divisor]\index{principal divisor}\index{$\mathrm{div}(f)$}
  If $f \in K(X)$, then we define the \emph{principal divisor}
  \[
    \div(f) = \sum_{Y} \val_Y(f) \cdot Y.
  \]
\end{defi}
One can show that $\val_Y(f)$ is non-zero for only finitely many $Y$'s, so this is a genuine divisor. To see this, there is always a Zariski open $U$ such that $f|_U$ is invertible, So $\val_Y(f) \not= 0$ implies $Y \subseteq X \setminus U$. Since $X$ is Noetherian, $X \setminus U$ can only contain finitely many codimension $1$ subscheme.
Observe that $\div(fg) = \div(f) + \div(g)$. So the principal divisors form a subgroup of the Weil divisors.

\begin{defi}[Class group]\index{class group}
  The \emph{class group} of $X$, $\Cl(X)$, is the group of Weil divisors quotiented out by the principal divisors.

  We say Weil divisors $D, D'$ are \term{linearly equivalent} if $D - D'$ is principal, and we write $D \sim D'$.
\end{defi}

\begin{eg}
  Take $X = \A^1_K$, and $f = \frac{x^3}{x + 1} \in K(X)$. Then
  \[
    \div(f) = 3[0] - [-1].
  \]
\end{eg}

A useful result for the future is the following:
\begin{thm}[Hartog's lemma]\index{Hartog's lemma}
  Let $X$ be normal, and $f \in \mathcal{O}(X \setminus V)$ for some $V \geq 2$. Then $f \in \mathcal{O}_X$.
\end{thm}

\subsection{Cartier divisors}
Weil divisors do not behave too well on weirder schemes. A better alternative is Cartier divisors. Let $\mathcal{L}$ be a line bundle, and $ss$ a rational section of $\mathcal{L}$, i.e.\ $s$ is a section of $\mathcal{L}|_U$ for some open $U \subseteq X$. Given such an $s$, we can define
\[
  \div(s) = \sum_Y \val_Y(s) \cdot Y.
\]
To make sense of $\val_Y(s)$, for a fixed codimension $1$ subscheme $Y$, pick $W$ such that $W \cap W \not= \emptyset$, and $\mathcal{L}|_W$ is trivial. Then we can make sense of $\val_Y(s)$ using the trivialization. It is clear from Hartog's lemma that
\begin{prop}
  If $X$ is normal, then
  \[
    \div: \{\text{rational sections of }\mathcal{L}\} \to \WDiv(X).
  \]
  is well-defined, and two sections have the same image iff they differ by an element of $\mathcal{O}_X^*$.
\end{prop}

\begin{cor}
  If $X$ is normal and proper, then
  \[
    \div \{\text{rational sections of }\mathcal{L}\}/K^* \to \WDiv(X).
  \]
\end{cor}

\begin{proof}
  Properness implies $\mathcal{O}_X^* = K^*$.
\end{proof}

\begin{eg}
  Take $X = \P^1_K$, and $s = \frac{X^2}{X + Y} \in H^0(\mathcal{O}(1))$, where $X, Y$ are our homogeneous coordinates. Then
  \[
    \div(s) = 2[0:1] - [1:-1].
  \]
\end{eg}

Let $X$ be a normal Noetherian scheme. Fix a Weil divisor $X$. We define the sheaf $\mathcal{O}_X(D)$\index{$\mathcal{O}_X(D)$} by setting, for all $U \subseteq X$ open,
\[
  \mathcal{O}_U(D) = \{f \in K(X) : \div(f) + D |_U \geq 0\}.
\]
\begin{prop}
  $\mathcal{O}_X(D)$ is a rank $1$ quasicoherent $\mathcal{O}_X$-module. \fakeqed.
\end{prop}

\begin{defi}[Locally principal]\index{locally principal}
  Let $D$ be a Weil divisor on $X$. Fix $x \in X$. Then $D$ is locally principal at $x$ if there exists an open set $U \subseteq X$ containing $x$ such that $D|_U = \div(f)|_U$ for some $f \in K(X)$.
\end{defi}

\begin{prop}
  If $D$ is locally principal at every point $x$, then $\mathcal{O}_X(D)$ is an invertible sheaf.
\end{prop}
\begin{proof}
  If $U \subseteq X$ is such that $D|_U = \div(f)|_U$, then there is an isomorphism
  \begin{align*}
    \mathcal{O}_X|_U &\to \mathcal{O}_X(D) |_U\\
    g &\mapsto g/f.\qedhere
  \end{align*}
\end{proof}
\begin{defi}[Cartier divisor]\index{Cartier divisor}
  A \emph{Cartier divisor} is a locally principal Weil divisor.
\end{defi}

By checking locally, we see that
\begin{prop}
  If $D_1, D_2$ are Cartier divisors, then
  \begin{enumerate}
    \item $\mathcal{O}_X(D_1 + D_2) = \mathcal{O}_X(D_1) \otimes \mathcal{O}_X(D_2)$.
    \item $\mathcal{O}_X(-D) \cong \mathcal{O}_X(D)^{\vee}$.
    \item If $f \in K(X)$, then $\mathcal{O}_X(\div(f)) \cong \mathcal{O}_X$.\fakeqed
  \end{enumerate}
\end{prop}

\begin{prop}
  Let $X$ be a Noetherian, normal, integral scheme. Assume that $X$ is \term{factorial}, i.e.\ every local ring $\mathcal{O}_{X, x}$ is a UFD. Then any Weil divisor is Cartier.
\end{prop}
Note that if $X$ is smooth, then $X$ is always factorial, and this proposition applies.

\begin{proof}
  It is enough to prove the proposition when $D$ is irreducible and effective. So $D \subseteq X$ is a codimension $1$ irreducible subvariety. For $x \in D$
  \begin{itemize}
    \item If $x \not \in D$, then $1$ is a divisor equivalent to $D$ near $x$.
    \item If $x \in D$, then $I_{D, x} \subseteq \mathcal{O}_{X, x}$ is a height $1$ prime ideal. So $I_{D, x} = (f)$ for $f \in \mathfrak{m}_{X, x}$. Then $f$ is the local equation for $D$.\qedhere
  \end{itemize}
\end{proof}

Recall the Class group $\Cl(X)$ was the group of Weil divisors modulo principal equivalence.
\begin{defi}[Picard group]\index{Picard group}
  We define the \emph{Picard group} of $X$ to be the group of Cartier divisors modulo principal equivalence.
\end{defi}
Then if $X$ is factorial, then $\Cl(X) = \Pic(X)$.

Recall that if $\mathcal{L}$ is an invertible sheaf, and $s$ is a rational section of $\mathcal{L}$, then we can define $\div(s)$.

\begin{prop}
  Let $X$ be normal and $\mathcal{L}$ an invertible sheaf, $s$ a rational section of $\mathcal{L}$. Then $\mathcal{O}_X(\div(s))$ is invertible, and
  \[
    \mathcal{O}_X(\div(s)) \to \mathcal{L}
  \]
  is an isomorphism. This gives a map
  \[
    \Pic(X) \to \Cl(X).
  \]
\end{prop}

\begin{proof}
  Given $f \in H^0(U, \mathcal{O}_X(\div(s)))$, map it to $f \cdot s \in H^0(U, \mathcal{L})$. This gives the desired isomorphism.

  If we have to sections $s' \not= s$, then $f= s'/s \in K(X)$. So $\div(s) = \div (s') + \div(f)$, and $\div(f)$ is principal. So this gives a well-defined map $\Pic(X) \to \Cl(X)$.
\end{proof}
So we can think of $\Pic(X)$ as the group of invertible sheaves modulo isomorphism, namely $H^1(X, \mathcal{O}_X^*)$.

If $X$ is factorial (and Noetherian and integral), then we have a map $\Cl(X) \to \Pic(X)$, and this is an isomorphism.

\subsubsection*{Computations}
\begin{prop}
  Let $X$ be an integral scheme, regular in codimension $1$. If $Z \subseteq X$ is an integral closed subscheme of codimension $1$, then we have an exact sequence
  \[
    \Z \to \Cl(X) \to \Cl(X \setminus Z) \to 0,
  \]
  where $n \in \Z$ is mapped to $[nZ]$.
\end{prop}

\begin{proof}
  The map $\Cl(X) \to \Cl(X \setminus Z)$ is given by restriction. If $S$ is a Weil divisor on $X \setminus Z$, then $\bar{S} \subseteq X$ maps to $S$ under the restriction map. So this map is surjective.

  Also, that $[nZ]|_{X \setminus Z}$ is trivial. So the composition of the first two maps vanishes. To check exactness, suppose $D$ is a Weil divisor on $X$, principal on $X \setminus Z$. Then $D|_{X \setminus Z} = \dim(f)|_{X \setminus Z}$ for some $f \in K(X)$. Then $D - \div(f)$ is just supported along $Z$. So it must be of the form $nZ$.
\end{proof}

If we remove something of codimension at least two, then something even simpler happens.
\begin{prop}
  If $Z \subseteq X$ has codimension $@$, then $\Cl(X) \to \Cl(X \setminus Z)$ is an isomorphism.
\end{prop}
The proof is the same as above, except no divisor can be supported on $Z$.

\begin{eg}
  $\Cl(\A^2 \setminus \{0\}) = \Cl(\A^2)$
\end{eg}
To compute $\Cl(\A^2)$, we need the following proposition:
\begin{prop}
  If $A$ is a Noetherian ring, regular in codimension $1$, then $A$ is a UFD iff $A$ is normal and $\Cl(\Spec A) = 0$
\end{prop}

\begin{proof}
  If $A$ is a UFD, then it is normal, and every prime ideal of height $1$ is principally generated. So if $D \in \Spec A$ is Weil and irreducible, then $D = V(f)$ for some $f$, and hence $(f) = I_D$.

  Conversely, if $A$ is normal and $\Cl(\Spec A) = 0$, then every Weil divisor is principal. So if $I$ is a height $1$ prime ideal, then $V(I) = D$ for some Weil divisor $D$. Then $D$ is principal. So $I = (f)$ for some $f$. So $A$ is a Krull algebra with principally generated height $1$ prime ideals. So it is a UFD.
\end{proof}

\begin{eg}
  $\Cl(\A^2) = 0$.
\end{eg}

\begin{eg}
  Consider $\P^n$. We have an exact sequence
  \[
    \Z \to \Cl(\P^n) = \Cl(\P^n \setminus \P^{n - 1}) = \Cl(\A^n) \to 0.
  \]
  So $\Z \to \Cl(\P^n)$ is surjective. So $\Cl(\P^n)$ is generated by a hyperplane. Moreover, since any principal divisor has degree $0$, it follows that $nH \not= 0$ for all $n > 0$. This $H$ corresponds to $\mathcal{O}(1)$.
\end{eg}

\begin{eg}
  Let $X = V(xy - z^2) \subseteq \A^3$. Let $Z = V(x, z)$. We claim that $\Cl(X) \cong \Z/2\Z$, and is generated by $[Z]$.

  We compute
  \[
    K[X \setminus Z] = \frac{K[x, x^{-1}, y, z]}{(xy - z)} \cong \frac{K[x, x^{-1}, t, z]}{(t - z)} = K[x, x^{-1}, z],
  \]
  where $t = xy$, and this is a UFD. So $\Cl(X \setminus Z) = 0$.

  We now want to compute the kernel of the map $\Z \to \Cl(X)$. We have
  \[
    \mathcal{O}_{X, Z} = \left(\frac{K[x, y, z]}{xy - z^2}\right)_{(x, z)} = \left(\frac{k[x, y, y^{-1}, z]}{x - z^2}\right)_{(x, y)} = k[y, y^{-1}, z]_{(z)}.
  \]
  Unsurprisingly, this is a DVR, and crucially, the uniformizer is $z$. So we know that $\div(x) = 2Z$. So we know that $2\Z \subseteq \ker(\Z \to \Cl(X))$. There is only one thing to check, which is that $(x, y)$ is not principal. To see this, consider
  \[
    T_{(0)}X = \A^3,\quad T_{(0)} (Z \subseteq X) = \A^1.
  \]
  But if $Z$ were principal, then $I_{Z, 0} = (f)$ for some $f \in \mathcal{O}_{X, 0}$. But then $T_0(Z) \subseteq T_0 X$ will be $V([df])$. But then $V([df])$ should have dimension at least $2$, which is a contradiction.
\end{eg}

\begin{prop}
  Let $X$ be Noetherian and regular in codimension one. Then
  \[
    \Cl(X) = \Cl(X \times \A^1).
  \]
\end{prop}
\begin{proof}
  We have a projection map
  \begin{align*}
    \pr_1^*: \Cl(X) &\to \Cl(X \times \A^1)\\
    [D_i] &\mapsto [D_i \times \A^1]
  \end{align*}
  It is an exercise to show that is injective. `

  To show surjectivity, suppose $D \subseteq X \times \A^1$ is a prime divisor, and $\pr_1(D) = X$. We may assume that $X$ is affine, using the naturality of the previous exact sequence and the $4$-lemma. Let $\mathcal{I}_D$ be the ideal of $D$ in $K[X \times \A^1] = K[X][t] \subseteq K(X) [t]$, and $\mathcal{I}_D^0$ the ideal generated by $\mathcal{I}_D$ in $K(X)[t]$. Since $\pr_1(D) = X$, we know $\mathcal{I}_D^0 \not= 1$. But since $K(X)[t]$ is a polynomial ring, we know $\mathcal{I}_D^0 = (f)$. Since $f \in K(X)[t] = K[X]_{(x_1, \ldots, x_n)} [t]$. % complete
\end{proof}

\begin{ex}
  We have $\Cl(X \times \P^n) = \Z \oplus \Cl(X)$.
\end{ex}

\begin{prop}
  Let $X$ be a smooth projective variety over an algebraically closed field. Let $D_0$ be a divisor on $X$.
  \begin{enumerate}
    \item For all $s \in H^0(X, \mathcal{O}_X(D))$, $\div(S)$ is an effective divisor linearly equivalent to $D$.
    \item If $D \sim D_0$ and $D \geq 0$, then there is $s \in H^0(\mathcal{O}_X(D_0))$ such that $\div(s) = D$
    \item If $s, s' \in H^0(\mathcal{O}_X(D_0))$ and $\div(s) = \div(s')$, then $s' = \lambda s$ for some $\lambda \in K^*$.
  \end{enumerate}
\end{prop}
\begin{proof}\leavevmode
  \begin{enumerate}
    \item Done last time.
    \item If $D \sim D_0$, then $D - D_0 = \div(f)$ for some $f \in K(X)$. Then $(f) + D_0 \geq 0$. So $f$ induces a section $s \in H^0(\mathcal{O}_X(D_0))$. Then $\div(s) = D$.
    \item We have $\frac{s'}{s} \in K(X)^*$. So $\div\left(\frac{s'}{s}\right)$. So $\frac{s'}{s} \in H^0(\mathcal{O}^*) = K^*$.\qedhere
  \end{enumerate}
\end{proof}

\begin{defi}[Complete linear system]\index{complete linear system}
  A \emph{complete linear system} is the set of all effective divisors linearly equivalent to a given divisor $D_0$, written $|D_0|$\index{$\lvert D\rvert$}.
\end{defi}
Then $|D_0|$ is the projectivization of the vector space $H^*(X, \mathcal{O}(D_0))$.


Sometimes we don't want absolutely everything.
\begin{defi}[Linear system]\index{linear system}
  A linear system $\delta \subseteq |D_0|$ is just a linear subspace of the projective space structure on $|D_0|$.
\end{defi}

If $\mathcal{L}$ is an invertible sheaf and $|V|$ A linear system of $\mathcal{L}$ on $X$, then the $\mathcal{O}_X$-action of $\mathcal{L}$ induces a map
\[
  V \otimes \mathcal{O}_X \to \mathcal{L}.
\]
Tensoring with $\mathcal{L}^{-1}$, this gives a map
\[
  V \otimes \mathcal{L}^{-1} \to \mathcal{O}_X.
\]
The image is an $\mathcal{O}_X$-subbmodule, hence an ideal sheaf. This ideal $b_{|V|}$ is called the \term{base ideal} of $|V|$ on $X$. We say $|V|$ is free if $b_{|v|} = \mathcal{O}_X$. This is the case iff $V$ gives a well-defined morphism to $\P^n$. In general, we get a rational morphism $X \dashrightarrow \P(V)$.

\begin{defi}[(Very) ample divisor]\index{very ample}\index{ample}
  We say a Cartier divisor $D$ is \emph{(very) ample} when $\mathcal{O}_X(D)$ is.
\end{defi}
By Serre's theorem, if $\mathcal{A}$ is ample and $X$ is projective, and $\mathcal{L}$ is any line bundle, then
\[
  h^0(X, \mathcal{L} \otimes \mathcal{A}^n) = \sum (-1)^i h^i(X, \mathcal{L} \otimes \mathcal{A}^n) = \chi(X, \mathcal{L} \otimes \mathcal{A}^n)
\]
for $n$ sufficiently large. At least in the case of curves, we have a nice way to understand this:

\begin{thm}[Riemann--Roch theorem]\index{Riemann--Roch theorem}
  If $C$ is a smooth projective curve, then
  \[
    \chi(\mathcal{L}) = \deg(\mathcal{L}) + 1 - g(C).
  \]
\end{thm}

Now let $D$ and $H$ be Cartier divisors, with $H$ very ample. Then by (another) Serre's theorem, we know $D + nH$ is globally generated when $n$ is sufficiently large, hence (by adding one more copy of $H$) it is very ample for $n$ sufficiently large.

\begin{prop}
  Let $D$ be a Cartier divisor on a projective normal scheme .Then $D \sim H_1 - H_2$ for some very ample divisors $H_i$. We can in fact take $H_i$ to be effective, and if $X$ is smooth, then we can take $H_i$ to be smooth and intersecting transversely.
\end{prop}

This is a consequence of Bertini's theorem.
\begin{thm}[Bertini]\index{Bertini's theorem}
  Let $X$ be a smooth projective variety over an algebraically closed field $K$, and $D$ a very ample divisor. Then there exists a Zariski open set $U \subseteq |D|$ such that for all $H \in U$, $H$ is smooth on $X$ and if $H_1 \not= H_2$, then $H_1$ and $H_2$ intersect transversely.
\end{thm}

\section{Surfaces}
Let $X$ be a smooth projective surface over an algebraically closed curve, and $C, D \subseteq X$ smooth curves intersecting transversely. We then have a short exact sequence
\[
  0 \to \mathcal{O}_X(-C + D) \to \mathcal{O}_X(D) \to \mathcal{O}_X (D)|_{C} = \mathcal{O}_C(D \cap C) \to 0.
\]
So we have a long exact sequence
\[
  0 \to H^0(\mathcal{O}_X(-C + D)) \to H^0(\mathcal{O}_X(D)) \to H^0(C, \mathcal{O}_C(D \cap D)) \to \cdots.
\]
Moreover, the section $1_{D} \in H^0(\mathcal{O}_X(D))$ restricts to the canonical section $1_{C \cap D} \in H^0(\mathcal{O}_C(D \cap C))$. Now observe that
\[
  |C \cap D| = \deg_C(\mathcal{O}_C(D)) = h^0(\mathcal{O}_{C \cap D}) = \chi(\mathcal{O}_{C \cap D}).
\]
since $D|_C \geq 0$, and $\mathcal{O}_{C \cap D}$ is a skyscraper sheaf supported at $C \cap D = \{p_1, \ldots, p_k\}$, counting with multiplicity (which is always $1$ by transversality).

Now consider the sequences
\[
  \begin{tikzcd}[row sep=tiny]
    0 \ar[r] & \mathcal{O}_X(-C) \ar[r] & \mathcal{O}_X \ar[r] & \mathcal{O}_C \ar[r] & 0\\
    0 \ar[r] & \mathcal{O}_X(-C - D) \ar[r] & \mathcal{O}_X(-D) \ar[r] & \mathcal{O}_C(-D|_C) \ar[r] & 0\\
    0 \ar[r] & \mathcal{O}_C(-D|_C) \ar[r] & \mathcal{O}_C \ar[r] & \mathcal{O}_{C \cap D} \ar[r] & 0
  \end{tikzcd}
\]
This allows us to write
\begin{align*}
  \chi(\mathcal{O}_{C \cap D}) &= -\chi(C, \mathcal{O}_C(-D|_C)) + \chi(C, \mathcal{O}_C)\\
  &= + \chi(\mathcal{O}_X(-C - D)) - \chi(\mathcal{O}_X(-D)) + \chi(C, \mathcal{O}_C)\\
  &= + \chi(\mathcal{O}_X(-C - D)) - \chi(\mathcal{O}_X(-D)) - \chi(\mathcal{O}_X(-C)) + \chi(\mathcal{O}_X).
\end{align*}

Now take divisors $D_1, D_2$ on $X$. Then we can consider\index{$D_1 \cdot D_2$}
\[
  D_1 \cdot D_2 = \chi(\mathcal{O}_X) - \chi(\mathcal{O}_X(-D_1 - D_2)) - \chi(\mathcal{O}_X(-D_1)) - \chi(\mathcal{O}_X(-D_2)).
\]
This gives us a function $\Div(X) \times \Div(X) \to \Z$. This is called the \term{intersection product}. We observe that
\begin{itemize}
  \item Since this is defined in terms of the Euler characteristic, which depends only on the sheaves, the product $D_1 \cdot D_2$ depends only on the classes of $D_1, D_2$ in $\Pic(X)$.
  \item $D_1 \cdot D_2 = D_2 \cdot D_1$.
  \item $D_1 \cdot D_2 = |D_1 \cap D_2|$ if $D_1$ and $D_2$ intersected tranasversely.
  \item %Observing that
%    \[
%      (D_1 + D_2, C) = \deg_C (\mathcal{O}_C(D_1 + D_2))
%    \]
%    for a curvre $C$, we observe that
    The intersection product is bilinear. % prove % this is unique
\end{itemize}

Let $\mathcal{B}_X \subseteq \Pic(X)$ be the cone of very ample line bundles on $X$ modulo isomorphism. By Bertini's theorem, given any two $D_1, D_2 \in \Pic(X)$, we can pick two curves $C_i \in |D_i|$ that intersect transversely. Then we have
\[
  (D_1 \cdot D_2) = |C_1 \cap C_2|.
\]
Note that every divisor is the difference of two very ample divisors So the span of $\mathcal{B}_x$ is $\Pic(X)$. So given any two divisors $E_i, E_j$, we can write
\begin{align*}
  E_i &= D_{i, 1} - D_{i, 2}\\
  E_j &= D_{j, 1} - D_{j, 2}
\end{align*}
with $D_{j, k}$ very ample. We can then compute
\[
  (E_i \cdot E_j) = (D_{i, 1} \cdot D_{j, 2}) + (D_{i, 2} \cdot D_{j, 2}) - (D_{i, 1} \cdot D_{j, 2}) + (D_{i, 2}\cdot D_{j, 1}).
\]
\begin{eg}
  Take $X = \P^2$. We saw that $\Pic(\P^2) \cong \Z$, generated by a hyperplane $\ell$. So all we need to understand is what $\ell^2$ is. But two transverse lines intersect at a point. So $\ell^2 = 1$. Thus, the intersection product on $\Pic(\P^2)$ is just ordinary multiplication. In particular, if $D_1, D_2$ are curves that intersect transversely, we find that
  \[
    D_1 \cdot D_2 = \deg(D_1) \deg(D_2).
  \]
  This is Bezout's theorem!
\end{eg}
\begin{ex}
  Let $C_1, C_2 \subseteq X$ be curves without common components. Then
  \[
    C_1 \cdot C_2 = \sum_{p \in C_1 \cap C_2} \ell(\mathcal{O}_{C_1 \cap C_2}),
  \]
  where for $p \in C_1 \cap C_2$, if $C_1 = V(x)$ and $C_2 = V(y)$, then
  \[
    \ell(\mathcal{O}_{C_1 \cap C_2}) = \dim_k(\mathcal{O}_{X, x}/(x, y))
  \]
  counts multiplicity.
\end{ex}

\begin{eg}
  Take $X = \P^1 \times \P^1$. Then
  \[
    \Pic(X) = \Z^2 = \Z[p_1^* \mathcal{O}(1)] \oplus \Z[p_2^ \mathcal{O}(1)].
  \]
  Let $A = p_1^* \mathcal{O}(1), B = p_2^* \mathcal{O}(1)$. Then we see that
  \[
    A^2 = B^2 = A \cdot B = 1
  \]
  by high school geometry.
\end{eg}

\begin{defi}[$\Num_0$]\index{$\Num_0$}
  Let
  \[
    \Num_0 = \{D \in \Div(X) : D \cdot E = 0\text{ for all }E \in \Div(X)\} \subseteq \Div(X).
  \]
\end{defi}
\begin{defi}[N\'eron--Severi group]\index{N\'eron--Severi group}
  We define the \term{N\'eron--Severi group}
  \[
    \NS(X) = \Div(X)/\Num_0(X).
  \]
\end{defi}

We can now state Riemann--Roch for surfaces.
\begin{thm}[Riemann--Roch for surfaces]\index{Riemann--Roch for surfaces}
  Let $D \in \Div(X)$. Then
  \[
    \chi(X, \mathcal{O}_X(D)) = \frac{D \cdot (D - K_X)}{2} + \chi(\mathcal{O}_X),
  \]
  where \term{$K_X$} is the \term{canonical divisor}.
\end{thm}

\begin{proof}
  We can assume $D = H_1 - H_2$ for very ample line bundles $H_1, H_2$, which are smoothly irreducible curves that intersect transversely. We have
  \[
    \begin{tikzcd}
      0 \ar[r] & \mathcal{O}_X(H_1 - H_2) \ar[r] & \mathcal{O}_X(H_1) \ar[r] & \mathcal{O}_{H_2}(H_1|_{H_2}) \ar[r] & 0\\
      0 \ar[r] & \mathcal{O}_X \ar[r] & \mathcal{O}_X(H_1) \ar[r] & \mathcal{O}_{H_1}(H_1) \ar[r] & 0
    \end{tikzcd}
  \]
  where $\mathcal{O}_{H_1}(H_1)$ means the restriction of the \emph{line bundle} $\mathcal{O}_X(H_1)$ to $H_1$. We then find that
  \begin{align*}
    \chi(H_1 - H_2) &= \chi(\mathcal{O}_X(H_1)) - \chi(H_2, \mathcal{O}_{H_2}(H_1|_{H_2}))\\
    &= \chi(\mathcal{O}_X) + \chi(H_1, \mathcal{O}_{H_1}(H_1)) - \chi(H_2, \mathcal{O}_{H_2}(H_1|_{H_2}))
  \end{align*}
  The first term appears in our Riemann--Roch theorem, and we can use Riemann--Roch for curves to understand the remaining. We have
  \[
    \chi(H_i, \mathcal{O}_{H_i}(H_1)) = \deg(\mathcal{O}_{H_i}(H_1)) + 1 - g(H_i) = (H_i \cdot H_1) + 1 - g(H_i).
  \]
  So we would be good if we can write $g(H_i)$ in terms of intersection numbers. But we have
  \[
    2g(H_i) - 2 = \deg K_{H_i}.
  \]
  To compute $\deg K_{H_i}$, we use the adjunction formula:
  \begin{thm}[Adjunction formula]\index{adjunction formula}
    Let $X$ is a smooth surface, and $C \subseteq X$ a smooth curve, then
    \[
      \mathcal{O}_X(K_X) \otimes \mathcal{O}_X(C)|_C \cong \mathcal{O}_C(K_C).
    \]
  \end{thm}
  We will prove this later. This allows us to conclude
  \[
    \deg(K_{H_i}) = H_i \cdot (K_X + H_i).
  \]
  So we have
  \[
    \chi(\mathcal{O}_X(D)) = \chi(\mathcal{O}_X) + H_1^2 - \frac{(K_X + H_1) \cdot H_1}{2} - H_1 \cdot H_2 + \frac{K_X + H_2 \cdot H_2}{2}.\qedhere
  \]
\end{proof}

\begin{proof}[Proof of adjunction formula]
  We claim that we have a short exact sequence on $C$
  \[
    \begin{tikzcd}
      0 \ar[r] & \mathcal{O}_X(-C)/\mathcal{O}_X(-2C) \ar[r] & \mathcal{O}_X^1|_C \to \Omega_C^1 \to 0.
    \end{tikzcd}
  \]
  Once we have this, we note that we have the short exact sequence
  \[
    \begin{tikzcd}
      0 \ar[r] & \mathcal{O}_X(-2C) \ar[r] & \mathcal{O}_X(-C) \ar[r] & \mathcal{O}_X(-C)/\mathcal{O}_X(-2C) \ar[r] & 0.
    \end{tikzcd}
  \]
  But then $\mathcal{O}_X(-C) = \mathcal{I}_C$. So we know that $\mathcal{O}_X(-C)/\mathcal{O}_X(-2C) \cong \mathcal{O}_C(-C)$. So
  \[
    \mathcal{O}_X(K_X) = \det(\Omega_X^1)
  \]
  So restricting to $C$, we have
  \[
    \mathcal{O}_X(K_X)|_C = \det(\Omega^1_X|_C) = \det(\mathcal{O}_C(-C)) \otimes \det(\Omega^1_C).
  \]
  To prove the claim, let $f$ be a local equation for $C$ on $U$ affine open. Then
  \[
    \mathcal{O}_U(-C)|_C = \mathcal{O}_U \cdot f.
  \]
  So we have the map
  \[
    g \cdot f \mapsto \d (g \cdot f) \in \Omega^1_X|_C,
  \]
  and
  \[
    \d (gf) = (\d g)f + g\;\d f = g\;\d f,
  \]
  since $f$ vanishes on $C$. Since $C$ is smooth, $\d f$ generates $\Omega^1_X|_p$ for all $p \in C$. We then check that this doesn't depend on $f$.
\end{proof}

\begin{fact}
  $\NS(X)$ is finitely-generated.
\end{fact}
Note that $\Pic(X)$ is not be finitely-generated in general. For example, for a curve, we have
\[
  \Pic(C) \cong \bigoplus_{\tau \in \Z} \Pic^\tau(C).
\]
Tensoring with $\R$, we get a bilinear map $(\ph, \ph): \NS_\R(X) = \NS(X)\otimes \R \to \R$. A natural question to ask is, what is the signature of this form? The answer is that it is $(1, \rho(X) - 1)$, where
\begin{defi}[$\rho(X)$]\index{$\rho(X)$}
  $\rho(X) = \dim \NS_\R(X) = \rk \NS(X)$.
\end{defi}

\begin{thm}[Hodge index theorem]\index{Hodge index theorem}
  Let $X$ be a projective surface, and $H$ be a (very) ample divisor on $X$. Assume there exists $D$ on $X$ such that $D \not\in \Num_0(X)$ such that $D \cdot H = 0$. Then $D^2 < 0$.
\end{thm}
We have previously seen that the square of any very ample divisor has positive suqare. So there must be a positive component. This theorem says everything else is negative.

\begin{proof}
  Assume for contradiction that $D^2 \geq 0$.
  \begin{itemize}
    \item If $D^2 > 0$, then consider $H_n' = D + nH$. Then by Serre's theorem, we know $H_n'$ is very ample for large $n$. By assumption, $D \cdot H = 0$. By Riemann--Roch, we have
      \[
        \chi(X, \mathcal{O}_X(mD)) = \frac{m^2 D^2 - m K_X \cdot D}{2} + \chi(\mathcal{O}_X).
      \]
      Moreover, by Serre duality, we have
      \[
        H^2(\mathcal{O}_X(mD)) = H^0(K_X - mD).
      \]
      Observe that
      \[
        H_n'\cdot (K_X - mD) < 0
      \]
      for $m \gg 0$. This condition implies $K_X - mD$ cannot be effective, since if it were effective, it would be represented by a curve transverse to $H_n'$, and then there is a non-negative number of intersections. Thus, we conclude that $H^0(K_X - D) = 0$.

      So we find that for $m$ sufficiently big,
      \[
        h^0(mD) - h^1(mD) > 0.
      \]
      In paritcular, $mD$ is (strictly) effective for $m \gg 0$. But then $H \cdot mD > 0$ since $H$ is very ample and $mD$ is effective. This is a contradiction.
    \item If $D^2 = 0$. Since $D$ is not numerically trivial, there exists a divisor $E$ on $X$ such that $D \cdot E \not= 0$. We define
      \[
        E' = (H^2) E - (E \cdot H) H.
      \]
      It is then immediate that $E' \cdot H = 0$. So $D_n' = nD + E'$ satisfies $D_n' \cdot H = 0$. Then
      \[
        (D_n')^2 = (E')^2 + 2n DE' > 0
      \]
      for some $n \in \Z$. This contradicts the previous part.\qedhere
  \end{itemize}
\end{proof}

Recall that we have an exponential exact sequence
\[
  \begin{tikzcd}
    0 \ar[r] & \Z \ar[r] & \mathcal{O} \ar[r, "\exp"] & \mathcal{O}^* \ar[r] & 0
  \end{tikzcd}
\]
in the analytic topology. So we have a long exact sequence
\[
  0 \to H^0(\Z) \to H^0(\mathcal{O}_X) \to H^0(\mathcal{O}_X^*) \to H^1(\Z) \to H^1(\mathcal{O}_X) \to H^1(\mathcal{O}_X^*) \to H^2(\Z) \to \cdots.
\]
We have $H^1(\mathcal{O}^*) = \Pic(X)$, where we take the \emph{analytic} Picard group. However, it is a classical theorem that this is the same as the algebraic Picard group. We can also identify $H^2(\Z) = H^2(X, \Z)$, and the map $\Pic(X) \to H^2(X, \Z)$ is the first Chern class.

\subsection{Blowups}
Let $S$ be a smooth surface, and $p \in S$. We want to construct a surface $\bar{S} = \Bl_p S$ together with a map $\varepsilon: \bar{S} \to \Bl_p S$ such that $\varepsilon^{-1}(p) = \P^1 \subseteq \bar{S}$ (where $\P^1$ is smoothly embedded), and $\varepsilon$ is an isomorphism outside of this $\P^1$. We call this $\P^1$ the \term{exceptional curve}, and write it as $E$.

Let $p \in S$, and $x, y$ local coordinates at $p$ in some neighbourhood $U$, such that $V(x, y) = p$. We work on $U \times \P^1$, where we use coordinates $[X: Y]$ on $\P^1$. We set
\[
  \bar{U} = V(xY - yX).
\]
We then check that above the point $(0, 0)$, any choice of $X, Y$ satisfies the equation. Everywhere else, we must have $[X:Y] = [x:y]$. So we are done. It is also easy to see that this is smooth.

\begin{defi}[Blow-up]\index{blow-up}
  The \emph{blow up} of $S$ at $p$ is the variety $\bar{S} = \Bl_p S$ that we just defined.
\end{defi}

The first question we can ask is, what is the structure of the Picard group of $\bar{S}$ in relation to $S$? By using the localization sequence, we have
\[
  \Z \to \Pic(\bar{S}) \to \Pic(\bar{S} \setminus \P^1) = \Pic(S \setminus \{p\}) \cong \Pic(S) \to 0.
\]
We also have the map $\Pic(S) \to \Pic(\bar{S})$ given by the pullback along $\varepsilon$. The push-pull formula tells us
\[
  \pi_* (\pi^* \mathcal{L}) = \mathcal{L} \otimes \pi_*(\mathcal{O}_{\bar{S}}),
\]
and Hartog's lemma tells us $\pi_* \mathcal{O}_{\bar{S}} = \mathcal{O}_S$. So $\varepsilon^*$ is a splitting. So either $\Pic(\bar{S}) = \Pic(S)$ or $\Pic(\bar{S}) = \Pic(S) \oplus \Z$.

Suppose $p \in C \subseteq S$. This then lifts to a curve $\tilde{C} \subseteq \bar{S} = \Bl_p S$, which we call the \term{strict transform} of $C$. This is given by
\[
  \tilde{C} = \varepsilon^{-1}(C \setminus \{p\}).
\]
There is also another operation, we can do, which is the pullback of divisors $\pi^* C$. This must be of the form
\[
  \pi^* C = \tilde{C} + mE.
\]
We claim that $m$ is the multiplicity of $C$ at $p$.

To see this, choose local coordinates $x, y$ at $p$ and suppose the curve $y = 0$ is not tangent to any branch of $C$ at $p$. Then in the local ring $\hat{\mathcal{O}}_{S, p}$, the equation of $C$ is given as
\[
  f = f_m(x, y) + \text{higher order terms},
\]
where $f_m$ is a non-zero degree $m$ polynomial. Then by definition, the multiplicity is $m$. Then on $\bar{U} \subseteq (U \times \P^1)$, we have the chart $U \times \A^1$ where $X \not= 0$, with coordinates
\[
  (x, y, Y/X = t).
\]
Taking $(x, t)$ as local coordinates, the map to $U$ is given by $(x, t \mapsto x, xt)$. Then
\[
  \varepsilon^* f = f(x, tx) = x^m f_m(1, t) + \text{higher order terms} = x^m \cdot h(x, t),
\]
with $h(0, 0) \not= 0$. But then on $\bar{U}_{x \not= 0}$, the curve $x = 0$ is just $E$. So this equation has multiplicity $m$ along $E$.

\begin{prop}
  Let $X$ be a smooth projective surface, and $x \in X$. Let $\bar{X} = \Bl_x X \overset{\pi}{\to} X$. Then
  \begin{enumerate}
    \item $\pi^* \Pic(X) \oplus \Z[E] = \Pic(\bar{X})$
    \item $\pi^*D \cdot \pi^* F = D \cdot F, \pi^* D \cdot E = 0, E^2 = -1$.
    \item $K_{\bar{X}} = \pi^* (K_X) + E$.
    \item $\pi^*$ is defined on $\NS(X)$. Thus,
      \[
        \NS(\bar{X}) = \NS(X) \oplus \Z E.
      \]
  \end{enumerate}
\end{prop}

\begin{proof}\leavevmode
  \begin{enumerate}
    \item Recall we had the localization sequence
      \[
        \Z \to \Pic(\bar{X}) \to \Pic(X) \to 1
      \]
      and there is a right splitting. To show the result, we need to show the left-hand map is injective, or equivalently, $m E \not\sim 0$. This will follow from the fact that $E^2 = -1$.
    \item For the first part, it suffices to show that $\pi^* D \cdot \pi^* F = D \cdot F$ for $D, F$ very ample, and so we may assume $D, F$ are curves not passing through $x$. Then their pullbacks is just the pullback of the curve, and so the result is clear. The second part is also clear.

      Finally, pick a smooth curve $C$ passing through $E$ with multiplicity $1$. Then
      \[
        \pi^*C = \tilde{C} + E.
      \]
      Then we have
      \[
        0 = \pi^* C \cdot E = \tilde{C} \cdot E + E^2,
      \]
      But $\tilde{C}$ and $E$ intersect at exactly one point. So $\tilde{C} \cdot E = 1$.
    \item By the adjunction formula, we have
      \[
        (K_{\bar{X}} + E) \cdot E = \deg(K_{\P^1}) = -2.
      \]
      So we know that $K_{\bar{X}} \cdot E = -1$. Also, outside of $E$, $K_{\bar{X}}$ and $K_X$ agree. So we have
      \[
        K_{\bar{X}} = \pi^* (K_X) + mE
      \]
      for some $m \in \Z$. Then computing
      \[
        -1 = K_{\bar{X}} \cdot E = \pi^*(K_X) \cdot E + mE^2
      \]
      gives $m = 1$.
    \item We need to show that if $D \in \Num_0(X)$, then $\pi^*(D) \in \Num_0(\bar{X})$. But this is clear for both things that are pulled back and things that are $E$. So we are done.\qedhere
  \end{enumerate}
\end{proof}

Consider a rational map $q: X \dashrightarrow \P^n$. If $\varphi$ is non-degenerate, then $\varphi$ is induced by a linear system $|V| \subseteq H^0(X, \mathcal{L})$. Now suppose every element of $|V|$ is of the form $E + D'$. This is the case if the base locus of $|V|$ has codimension $1$. Let $|V'|$ be the set of all such $D'$. Then $|V|$ and $|V'|$ give the same rational map. Indeed, if $V$ has basis $f_0, \ldots, f_n$, and $g$ is the function defining $E$, then the two maps are, respectively,
\[
  [f_0: \cdots : f_n],\quad [f_0/g : \cdots : f_n/g],
\]
which define the same rational maps. By repeating this process, replacing $V$ with $V'$, we may assume the base locus has codimension $>1$.

\begin{thm}[Elimination of indeterminacy]
  Let $X$ be a sooth projective surface, $\varphi: X \to Y$ a rational map, and $Y$ a projective variety. Then there exists a smooth projective surface $X'$ and $q$ and a commutative diagram
  \[
    \begin{tikzcd}[column sep=tiny]
      & X' \ar[ld, "p"] \ar[rd, "q"]\\
      X \ar[rr,dashed, "\varphi"] && Y
    \end{tikzcd}
  \]
  where $p: X' \to X$ is a composition of blowups, and in particular is birational.
\end{thm}

\begin{proof}
  We may assume we are in the case $Y = \P^n$, and $X \dashrightarrow \P^n$ is a non-degenerate map. This corresponds to a $|D|$ with a base locus $B(|D|)$ of codimension $\geq 2$. Pick $x \in X$ in the base locus of $|D|$. Blow it up to get $X_1 = \Bl_x X \to X$. Then
  \[
    \pi^* |D| = |D_1| + mE,
  \]
  where $m > 0$, and $|D_1|$ is a linear system which induces the map $\varphi \circ \pi_1$. If $|D_1|$ has no basepoints, then we are done. If not, we iterate this procedure. The claim is that the procedure stops. Observe that $0 \leq D_1^2 = (\pi_1^* D^2 + m^2 E^2) < D^2$. So we are done by the well-foundedness of the natural numbers.
\end{proof}

\begin{prop}
  We have the following universal property of blowups: If $Z \to X$ is a birational map of surfaces, and suppose $f^{-1}$ is not defined at a point $x \in X$. Then $f$ factors uniquely through the blowup $\Bl_x(X)$.\fakeqed
\end{prop}

\begin{thm}
  Let $g: Z \to X$ be a birational morphism of surfaces. Then there exists a sequence of blowups $f_i: X_i \to X_{i - 1}$ for $i = 1, \ldots, n$ and $X_0 = X$, and there exists an isomorphism $h: Z \to X_m$ such that $g = h \circ f_n \circ \cdots \circ f_1$.
\end{thm}

\begin{proof}
  If $f: Z \to X$ is not an isomorphism, then there must be a point in $X$ where $f^{-1}$ is not well-defined. So by the universal property, we can factor $f$ as $Z \overset{g_1}{\to} X_1 \overset{f_1}{\to} X$, where $f_1$ is a blowup. We want to know this terminates.

  So if $f$ is not invertible, then there exists $C_1, \ldots, C_k$ on $Z$ such that $g(C_i)$ is a point. Then the curves contracted to a point by $g_i$ is less than the curves contracted to a point by $g_{i - 1}$. When there are none left, we have an isomorphism.
\end{proof}

\begin{cor}
  Wehhn we eliminate indeterminacies, $X'$ is a blowup of both $X$ and $Y$.
\end{cor}

Birational isomorphism is an equivalence relation. So we can partition the set of smooth projective surfaces into birational isomorphism classes. But now if $X, X'$ are in the same birational isomorphism class, we can say $X \leq X'$ if $X'$ is a blowup of $X$. We have seen that any two elements have an upper bound, but there is no global maximum element, since we can keep blowing up. However, we can look for minima elements.
\begin{defi}[Relatively minimal]\index{relatively minimal}
  We say $X$ is \emph{relatively minimal} if there does not exist a smooth $X'$ and a birational morphism $X \to X'$ that is not an isomorphism. We say $X$ is \term{minimal} if it is the unique relative minimal surface in the birational equivalence class.
\end{defi}

If $X$ is not relatively minimal, then it is the blowup of another smooth projective surface, and in this case the exceptional curve $C$ satisfies $C^2 = -1$. It turns out this criterion itself is enough to determine minimality.
\begin{thm}[Castelnuovo's contractibility criterion]\index{Castelnuovo's contractibility criterion}
  Let $X$ be a smooth projective surface over $K = \bar{K}$. If $C \subseteq X$, $C \cong \P^1$ and $C^2 = -1$, then there exists $f: X \to Y$ that exhibits $X$ as a blowup of $Y$ at a point with exceptional curve $C$.
\end{thm}

\begin{ex}
  Let $X$ be a smooth projective surface. Then any two of the following three conditions imply the third:
  \begin{enumerate}
    \item $C \cong \P^1$
    \item $C^2 = -1$
    \item $K_X \cdot C = -1$
  \end{enumerate}
  When these are satisfied, we say $C$ is a \term{$(-1)$ curve}.
\end{ex}
For example, the last follows from the first two by the adjunction formula.

\begin{cor}
  A smooth projective surface is relatively minimal if and only if it does not contain a $(-1)$ curve.
\end{cor}

\begin{eg}
  Consider $X = \P^2$, and $x, y, z$ three non-colinear points in $\P^2$ given by $[1:0:0], [0:1:0], [0:0:1]$. Let $|C_{x, y, z}|$ be the linear system consisting of the conics through $x, y, z$. In fact, we can check that this is given by the span of $x_0 x_1, x_1 x_2, x_0 x_2$. Call these three lines $\ell_1, \ell_2, \ell_3$. These three conics give us a birational map
  \begin{align*}
    \P^2 &\dashrightarrow \P^2\\
    [x_0:x_1:x_2] & \mapsto [x_1 x_2: x_0 x_2: x_0 x_1] = [x_0^{-1}:x_1^{-1}:x_2^{-1}].
  \end{align*}
  The base locus of $|C_{x, y, z}|$ is then $\{x, y, z\}$.

  Consider the triple blowup $\Bl_{x, y, z} \P^2 \to \P^2$. This then resolves our indeterminacies. Then in the blowup, we have $\pi^* \ell_i = \tilde{\ell}_i + E_j + E_k$. Squaring shows that $\tilde{\ell_i}^2 = -1$. So Castelnuovo tells us we can blow them down, and this is the map $\Bl_{x, y, z} \P^2 \to \P^2$ on the right % insert picture
  \[
    \begin{tikzcd}[column sep=tiny]
      & \Bl_{x, y, z} \P^2 \ar[dr] \ar[dl]\\
      \P^2 \ar[rr, dashed, "C"] && \P^2
    \end{tikzcd}
  \]
\end{eg}

\begin{proof}[Proof of Castelnuovo's contractibility criterion]
  Let $X$ be the smooth projective surface, and $H$ a very ample divisor. By Serre's theorem, we may assume $H^1(X, \mathcal{O}_X(H)) = 0$. Let
  \[
    H \cdot C = K > 0.
  \]
  We want to show there exists $f: X \to Y$ smooth and $f$ is an isomorphism outside of $C$ with $f(C) = *$. This $f$ should be given by a linear system $|L|$, and we want $f(C) = *$. So $\mathcal{O}_X(L)|_C = \mathcal{O}_C$.

  Now consider $\mathcal{O}_X(H + iC)$. This has
  \[
    (H + iC) \cdot C = K - i.
  \]
  Thus, we find that $\mathcal{O}_X(H + kC)|_C \simeq \mathcal{O}_C$.

  Now consider the sequence
  \[
    0 \to \mathcal{O}_X (H + (i - 1) C) \to \mathcal{O}_X(H + iC) \to \mathcal{O}_C(H + iC) \to 0.
  \]
  The associated long exact sequence gives
  \begin{multline*}
    0 \to H^0(H + (i - 1)C) \to H^0(H + iC) \to H^0(C, (H + iC)|_C)\\
    \to H^1(H + (i - 1)C) \to H^1(H + iC) \to H^1(C, (H + iC)|_C) \to \cdots
  \end{multline*}
  But we know $\mathcal{O}_X(H + iC)|_C = \mathcal{O}_{\P^1}(K - i)$. So in the range $i = 0, \ldots, K$, we have $H^1(C, (H + iC)|_C) = 0$. Thus, by induction, we find that $H^1(H + iC) = 0$.

  Thus, we find that $H^0(H + iC) \to H^0(C, (H + iC)|_C)$ is surjective. Recall the map $H^0(H + (i - 1)C) \to H^0(H + iC)$ is given by tensoring with $f$, where $f = 1_C \in H^0(\mathcal{O}_X(C))$. Picking $i = K$, we have a surjection
  \[
    H^0(\mathcal{O}_X(H + KC)) \to H^0(\mathcal{O}_{\P^1}).
  \]
  Let $1 \in H^0(\mathcal{O}_{\P^1})$, and lift to a section $x_r \in H^0(\mathcal{O}_X(H + KC))$. This is a section that does not vanish anywhere on $C$.

  Inductively, we pick a basis of $H^0(\mathcal{O}_X(H + KC))$ of the form
  \[
    x_r, f y_{r - 1, 1}, f y_{r - 2, 1}, f^2 y_{r - 3, 2}, f^2 y_{r - 4, 2}, f^2 y_{r - 4, 2}, \ldots, f^j y_{\ell, j}, \ldots, f^k \sigma,
  \]
  where $y_{\ell, j} \in H^0(\mathcal{O}_X(H + (K - j)C))$ are such that $\{y_{\ell, j}\}_\ell$ lift a basis of $\mathcal{O}_{\P^1}(j)$. This basis gives us a map $f: X \to \P(H^0(H + KC))$. Indeed, our linear system separate points and tangent vectors outside of $C$, and $x_r$ is non-zero along $C$. Moreover, the image of $C$ is a point, since $f(C) = [0:0:\cdots :1]$. Moreover, $f|_{(X \setminus C)}$ is an isomorphism since the sections separate points and tangent vectors.

  It remains to prove that $Y = \im (f)$ is smooth. This can fail to be smooth only at the point $p = f(C)$. But at $p$, we have coordinates $\frac{x_{r - 1}}{r}, \ldots, \frac{x_0}{x_r}$. But the pullback $f^* \frac{x_i}{x_r}$ vanishes along $C$, and the order of vanishing is exactly determined by how many times $f$ appears in the basis element. Morever, $y_{\ell, j}|_C \in H^0(\mathcal{O}_{\P^1(j)})$ and $\sigma|_C \in H^0(\mathcal{O}_{\P^1}(K))$. Observing that
  \[
    H^0(\mathcal{O}_{\P^1}(j)) = \Sym^j H^0(\mathcal{O}_{\P^1}(1)) = \Sym^j \bra y_{r - 1, 1}|_{\P^1}, y_{r - 2, 1}|_{\P^1} \ket,
  \]
  So we know that $\frac{x_i}{x_r} \in \mathfrak{m}_p$, and we can write
  \[
    \frac{x_i - \sum^\infty_{\ell = k} Q_\ell(y_{r - 1, 1}, y_{r - 2, 1})}{x_r} \in \hat{\mathcal{O}}_{Y, p}, % fix this
  \]
  for some polynomials $Q_{\ell}$, whose pullback to $\hat{\mathcal{O}}_{X, C}$ vanishes. So we have
  \[
    0 = \frac{x_i}{x_r} = \frac{\sum Q_\ell(y_{r - 1, 1}, y_{r - 2, 1})}{x_r}.
  \]
  for all $i \leq r - 3$. So $\frac{x_i}{x_r} \in \mathfrak{m}_p^2$ for all $i \leq r - 3$. So $\dim \hat{\mathfrak{m}}_p/\hat{\mathfrak{m}}_p^2 \leq 2$. So we are done.
\end{proof}

\section{Not surfaces}
Let $X$ be a proper variety over an algebraically closed $K$. On surfaces, we had the intersection product that allowed us to study divisors. In particular, using this, we were able to obtain the Riemann--Roch formula. We now want to generalize this to things that are not surfaces.

Let $n = \dim X$. We want a multilinear symmetric function $\prod^n \CaDiv(X) \to \Z$, denoted
\[
  (D_1, \ldots, D_n) \mapsto (D_1 \cdot \cdots \cdot D_n).
\]
This should satisfy the following properties:
\begin{enumerate}
  \item The intersection depends only on the linear equivalence class, i.e.\ it factors through $\prod^n \Pic(X)$.
  \item If $D_1, \ldots, D_n$ are smooth hypersurfaces that all intersect transversely, then
    \[
      D_1 \cdot \cdots \cdot D_n = |D_1 \cap \cdots \cap D_n|.
    \]
  \item If $V \subseteq X$ is an integral subvariety, and $D_1, \ldots, D_{\dim V}$ Cartier divisors, then
    \[
      D_1 \cdot \cdots \cdot D_{\dim V} \cdot [V] = (D_1|_V \cdot \cdots D_{\dim V}|_V).
    \]
\end{enumerate}
We can define the intersection product formally in two ways:
\begin{enumerate}
  \item For each $D_i$, write it as $D_i \sim H_{i, 1} - H_{i, 2}$ with $H_{i, j}$ very ample. Then multilinearity tells us how we should compute the intersection product, namely as
    \[
      \sum_{I \subseteq \{1, \ldots, n\}} (-1)^{|I|} \prod_{i \in I} H_{i, 2} \cdot \prod_{j \not \in I} H_{j, 1}.
    \]
    By Bertini, we can assume the $H_{i, j}$ intersect transversely, and then we just compute these by counting the number of points of intersection. We then have to show that this is well-defined. However, the last formula is not completely clear.
  \item We can write down the definition of the intersection product in a more cohomological way. Recall that for $n = 2$, we had
    \[
      D \cdot C = \chi(\mathcal{O}_X) + \chi(\mathcal{O}_X(-C - D)) - \chi(\mathcal{O}_X (-C)) - \chi(\mathcal{O}_X(-D)).
    \]
    For general $n$, let $H_1, \ldots, H_n$ be very ample divisors. Then the last property implies we have
    \[
      H_1 \cdot \cdots \cdot H_n = (H_2|_{H_1} \cdot \cdots \cdot H_n|_{H_1}).
    \]
    So inductively, we have
    \[
      H_1 \cdot \cdots \cdot H_n = \sum_{I \subseteq \{2, \ldots, n\}} (-1)^{|I|} \chi\left(H_1, \mathcal{O}_{H_1}\left(- \sum_{i \in I} H_i\right)\right)
    \]
    But we also have the sequence
    \[
      0 \to \mathcal{O}_X(-H_1) \to \mathcal{O}_X \to \mathcal{O}_{H_1} \to 0.
    \]
    Twisting this sequence shows that
    \begin{align*}
      H_1 \cdot \cdots \cdot H_n &= \sum_{I \subseteq \{2, \ldots, n\}} (-1)^{|I|}\left(\chi\left(\mathcal{O}_X\left(- \sum_{i \in I} H_i\right)\right) - \chi\left(\mathcal{O}_X\left(- H_1 - \sum_{i \in I} H_i\right)\right)\right)\\
      &= \sum_{J \subseteq \{1, \ldots, n\}} (-1)^{|J|} \chi\left(\mathcal{O}_X\left(- \sum_{i \in J} H_i\right)\right)
    \end{align*}
    We can then adopt this as the definition of the intersection product
    \[
      D_1 \cdot \cdots \cdot D_n = \sum_{J \subseteq \{1, \ldots, n\}} (-1)^{|J|} \chi\left(\mathcal{O}_X\left(- \sum_{i \in J} D_i\right)\right).
    \]
    Reversing the above procedure shows that property (iii) is satisfied.
\end{enumerate}

\begin{defi}[Numerically equiavelent to $0$]\index{numerically equivalent to $0$}
  Let $X$ be as above, and $D \in \CaDiv(X)$. We say $D$ is \emph{numerically equivalent to $0$} if $D \cdot [C] = \deg_C (i^* \mathcal{O}_X(D)) = 0$ for all integral curve $C \subseteq X$.
\end{defi}

In the case of surfaces, we showed that being numerically equivalent to zero is the same as being in the kernel of the intersection product.

\begin{lemma}
  Assume $D \equiv 0$. Then for all $D_2, \ldots, D_{\dim X}$s, we have
  \[
    D \cdot D_2 \cdot \cdots \cdot D_{\dim X} = 0.
  \]
\end{lemma}

\begin{proof}
  As usual, we can assume that the $D_i$ are very ample. Then
  \[
    D \cdot D_2 \cdot \cdots D_{\dim X} = D|_{D_2} \cdot D_3|_{D_2} \cdot \cdots \cdot D_{\dim X}|_{D_2}.
  \]
  now if $D \equiv 0$ on $X$, then $D|_{D_2} \equiv 0$ on $D_2$. So by induction, we are done.
\end{proof}

\begin{defi}[Neron--Severi group]\index{Neron--Severi group}
  The \emph{Neron--Severi group} of $X$, written $\NS(X) = N^1(X)$, is
  \[
    N^1(X) = \frac{\CaDiv(X)}{\Num_0(X)} = \frac{\CaDiv(X)}{\{D \mid D \equiv 0\}}.
  \]
\end{defi}

\begin{thm}[Severi]
  Let $X$ be a projective variety over an algebraically closed field. Then $N^1(X)$ is a finitely-generated torsion free abelian group, hence of the form $\Z^n$.
\end{thm}
\begin{defi}[Picard number]\index{Picard number}
  The \emph{Picard number} of $X$ is the rank of $N^1(X)$.
\end{defi}

How can we possibly prove Severi's theorem? Over $\C$, we have the exponential sequence
\[
  0 \to \Z \to \mathcal{O}_X^{an} \to \mathcal{O}_X^{*, an} \to 0.
\]
This gives a long exact sequence
\[
  H^1(X, \Z) \to H^1(\mathcal{O}_X^{an}) \to H^1(\mathcal{O}_X^{*, an}) \to H^2(X, \Z).
\]
It is not hard to see that $H^i(X, \Z)$ is in fact the same as singular cohomology, and $H^1(\mathcal{O}_X^{*, an})$ is the complex analytic Picard group. But by Serre's GAGA theorem, this is the same as the algebraic $\Pic(X)$. The map $\Pic(X) \to H^2(X, \Z)$ is just the first Chern class.

Now it is not hard to see that the intersection product $[C]\cdot D$ is the same as the topological intersection product $[C] \cdot c_1(D)$. So at least modulo torsion, we have an embedding of the Neron--Severi group into $H^2(X, \Z)$. Also, $H^1(\mathcal{O}_X^{ab})/H^1(X, \Z) \cong \mathrm{Alb}(X) \cong \Pic^0(X)$. Thus, $\Pic(X)$ is the extension of an abelian variety by some discrete finite rank abelian Lie group.

\begin{thm}[Asymptotic Riemann--Roch]\index{Asymptotic Riemann--Roch}
  Let $X$ be a projective normal variety over $K = \bar{K}$. Let $D$ be a Cartier divisor, and $E$ a Weil divisor on $X$. Then $\chi(X, \mathcal{O}_X(mD + E))$ is a numerical polynomial in $m$ (i.e.\ a polynomial with rational coefficients that only takes rational values) of degree at most $n = \dim X$, and
  \[
    \chi(X, \mathcal{O}_X(mD + E)) = \frac{D^n}{n!} m^n + \text{lower order terms}.
  \]
\end{thm}

\begin{proof}
  By induction on $\dim X$, we can assume the theorem holds for normal projective varieties of dimension $< n$. We fix $H$ on $X$ very ample such that $H + D$ is very ample. Fix $H' \in |H|$ and $G \in |H + D|$ Let $H' \in |H|$ and $G \in |H + D|$ be sufficiently general. We then have short exact sequences
  \[
    0 \to \mathcal{O}_X(mD + E) \to \mathcal{O}_X(mD + E + H) \to \mathcal{O}_{H'}((mD + E + H)|_{H'}) \to 0
  \]
  \[
    0 \to \mathcal{O}_X((m - 1)D + E) \to \mathcal{O}_X(mD + E + H) \to \mathcal{O}_G((mD + E + H)|_G) \to 0.
  \]
  Note that the middle term appears in both equations. So
  \[
    \chi_X(X, \mathcal{O}_X(mD + E)) + \chi (H', \mathcal{O}_{H'}((mD + E + H)|_H)) = \chi_X(X, \mathcal{O}_X((m - 1)D + E)) + \chi (H', \mathcal{O}_{G}((mD + E + H)|_G))
  \]
  So we have
  \[
    \chi(\mathcal{O}_X(mD - E)) - \chi(\mathcal{O}_X((m - 1)D - E)) = \chi(G, \mathcal{O}_G(mD + E + H)) - \chi(H', \mathcal{O}_{H'} (mD + E + H)).
  \]
  By induction (see proposition below) the right-hand side is a numerical polynomial of degree at most $n - 1$ with leading term
  \[
    \frac{D^{n - 1} \cdot G - D^{n - 1} \cdot H}{(n - 1)!} m^{n - 1} + \text{lower order terms},
  \]
  since $D^{n - 1}\cdot G$ is just the $(n-1)$ self-intersection of $D$ along $G$. But $G - H = D$. So the LHS is
  \[
    \frac{D^n}{(n - 1)!} m^{n - 1} + \text{lower order terms},
  \]
  so we are done.
\end{proof}

\begin{prop}
  Let $X$ be a normal projective variety, and $|H|$ a very ample linear system. Then for a general element $G \in |H|$, $G$ is a normal projective variety.\fakeqed
\end{prop}

We now look at some applications of asymptotic Riemann--Roch:
\begin{prop}
  Let $X$ be a normal projective variety.
  \begin{enumerate}
    \item If $H$ is a very ample Cartier divisor, then
      \[
        h^0(X, mH) = \frac{H^n}{n!} m^n + \text{lower order terms}\text{ for }m \gg 0.
      \]
    \item If $D$ is any Cartier divisor, then there is some $C \in \R_{>0}$ such that
    \[
      h^0(mD) \leq C \cdot m^n\text{ for }m \gg 0.
    \]
  \end{enumerate}
\end{prop}

\begin{proof}\leavevmode
  \begin{enumerate}
    \item By Serre's theorem, $H^i(\mathcal{O}_x(mH)) = 0$ for $i > 0$ and $m \gg 0$. So we apply asymptotic Riemann Roch.
    \item There exista very ample Cartier divisor $H'$ on $X$ such that $H' + D$ is also very ample. Then
      \[
        h^0(mD) \leq h^0(m (H' + D)).\qedhere
      \]%\qedhere
  \end{enumerate}
\end{proof}

We now want to prove the following theorem:
\begin{thm}[Nakai's criterion]\index{Nakai's criterion}
  Let $X$ be a projective scheme. Let $D$ be a Cartier divisor on $X$. Then $D$ is ample iff for all $V \subseteq X$ integral proper subvariety (proper means proper scheme, not proper subset), we have
  \[
    (D|_V)^{\dim V} = D^{\dim V} [V] > 0.
  \]
\end{thm}

Before we prove this, we observe some immediate corollaries:
\begin{cor}
  Let $X$ be a projective scheme. Then ampleness is a numerical condition, i.e.\ for any Cartier divisors $D_1, D_2$, if $D_1 \equiv D_2$, then $D_1$ is ample iff $D_2$ is ample.
\end{cor}

\begin{cor}
  Let $X, Y$ be projective schemes. If $f: X \to Y$ is a surjective finite morphism of schemes, and $D$ is a Cartier divisor on $Y$. Then $D$ is ample iff $f^*D$ is ample.
\end{cor}

\begin{proof}\leavevmode
  \begin{itemize}
    \item[$(\Leftarrow)$] If $f$ is finite and surjective, then for all $V \subseteq Y$, there exists $V' \subseteq f^{-1}(V) \subseteq X$ such that $f|_{V'}: V' \to V$ is a finite surjective morphism. Then we have
      \[
        (f^* D)^{\dim V'} [V'] = \deg f|_{V'} D^{\dim V} [V],
      \]
      which is clear since we only have to prove this for very ample $D$.
    \item[$(\Rightarrow)$] If $D$ is ample on $Y$ and $\mathcal{F}$ is a coherent sheaf on $X$, since $f$ is finite, we have $R^i f_* \mathcal{F} = 0$ for all $i > 0$. Then
      \[
        H^i(\mathcal{F} \otimes \mathcal{O}_X(f^*(mD))) = H^i(f_* \mathcal{F} \otimes \mathcal{O}_Y(mD)) = 0
      \]
      for all $i > 0$ and $m \gg 0$. So by Serre's theorem, we know $f^* D$ is ample.\qedhere
  \end{itemize}
\end{proof}
Note that the second part does not require surjectivity.

\begin{cor}
  If $X$ is a proper scheme, $D$ a Cartier divisor and $\mathcal{O}_X(D)$ globally generated, and
  \[
    \Phi: X \to \P(H^0(X, \mathcal{O}_X(D))^*)
  \]
  the induced map. Then $D$ is ample iff $\Phi$ is finite.
\end{cor}

\begin{proof}\leavevmode
  \begin{enumerate}
    \item[$(\Leftarrow)$] If $X \to \Phi(X)$ is finite, then $D = \Phi^* \mathcal{O}(1)$. So this follows from the previous corollary.
    \item[$(\Rightarrow)$] If $\Phi$ is not finite, then there exists $C \subseteq X$ such that $\Phi(C)$ is a point. Then $D \cdot C = \Phi^* \mathcal{O}(1) \cdot C = 0$, by the push pull formula. But this is just $\deg_C (\Phi^* \mathcal{O}(1))$. So by Nakai's criterion, $D$ is not ample.\qedhere
  \end{enumerate}
\end{proof}

\begin{proof}[Proof of Nakai's criterion]\leavevmode
  \begin{itemize}
    \item[$(\Rightarrow)$] If $D$ is ample, then $mD$ is very ample for some $m$. Then by multilinearity, we may assume $D$ is very ample. So we have a closed embedding
      \[
        \Phi: X \to \P(H^0(D)^*).
      \]
      If $V \subseteq X$ is a closed integral subvariety, then $D^{\dim V} \cdot [V] = (D|_V)^{\dim V}$. But this is just $\deg_{\mathcal{O}(1)} \Phi(V) > 0$.
    \item[$(\Leftarrow)$] We assume first that $X$ is integral. We proceed by induction on $\dim X$, noting that $\dim X = 1$ is trivial.

      As usual, write $D \sim H_1 - H_2$ with $H_i$ very ample effective divisors. We have exact sequences
      \[
        0 \to \mathcal{O}_X(mD - H_1) \to \mathcal{O}_X(mD) \to \mathcal{O}_{H_1}(mD) \to 0
      \]
      \[
        0 \to \mathcal{O}_X(mD - H_1) \to \mathcal{O}_X((m - 1)D) \to \mathcal{O}_{H_2}((m - 1)D) \to 0.
      \]
      We know $D|_{H_i}$ is ample by induction. So for all $m \gg 0$ and $j \geq 2$, we have
      \[
        H^j(mD) \cong H^j((mD - H_1)) = H^j((m - 1)D).
      \]
      So we know that
      \[
        \chi(mD) = h^0 - h^1 + \text{constant}
      \]
      for all $m \gg 0$. On the other hand, since $X$ is an integral subvariety of itself, $D^n > 0$, and so asymptotic Riemann--Roch tells us $h^0(mD) > 0$ for all $m \gg 0$. Since $D$ is ample iff $mD$ is ample, we can assume $D$ is effective.

      We then have another short exact sequence
      \[
        0 \to \mathcal{O}_X(mD) \to \mathcal{O}_X((m + 1)D) \to \mathcal{O}_D((m + 1)D|_D) \to 0.
      \]
      We would like to say $D|_D$ is ample, but we may have problems if $D$ has multiplicities and many components.
      \begin{claim}
        If $X$ is a scheme and $D$ is Cartier on $X$, then
        \begin{enumerate}
          \item $D$ is ample iff $D|_{\red X}$ is ample.
          \item $D$ is ample iff $D|_{X_i}$ is ample for all irreducible components $X_i \subseteq X$.
        \end{enumerate}
      \end{claim}
      If we assume the claim, then we know by induction that $\mathcal{O}_D(D)$ is ample. We want to show that $mD$ is globally generated for large $m$. We then have a short exact sequence
      \[
        0 \to \mathcal{O}_X((m - 1)D) \to \mathcal{O}_X(mD) \to \mathcal{O}_D(mD) \to 0.
      \]
      By ampleness, we know $H^i(\mathcal{O}_D(mD)) = 0$ for all $i > 0$ and $m \gg 0$. Thus, the long exact sequence
      \[
        H^0(\mathcal{O}_X(mD)) \to H^0(\mathcal{O}_D(mD) \to H^1(\mathcal{O}_X(m - 1)D \to H^1(\mathcal{O}_X(mD)) \to 0.
      \]
      implies $H^1((m - 1)D) \twoheadrightarrow H^1(mD)$. But these are finite-dimensional vector spaces. So for sufficiently large $m$, the map is an isomorphism. So for large $m$, we have a surjective
      \[
        H^0(\mathcal{O}_X(mD)) \to H^0(\mathcal{O}_D(mD)).
      \]
      But for large $m$, then RHS is globally generated. Hence $\mathcal{O}_X(mD)$ is globally generated in a neighbourhood of $D$. Outside of $D$, this sheaf is automatically globally generated, since we can take the tautological section that vanishes at $D$ with multiplicity $m$. So $\mathcal{O}_X(mD)$ is globally generated.

      Then we have a map $X \to \P(|mD|)$, which cannot contract any curve $C$, and so $mD \cdot C = 0$. So this map is finite, and we know that pulling an ample divisor along a finite map is ample.\qedhere
  \end{itemize}
\end{proof}

\begin{prop}
  Let $X$ be a proper scheme, and $\mathcal{L}$ an invertible sheaf. Then $\mathcal{L}$ is very ample iff $\mathcal{L}|_{X_{\red}}$ is ample.
\end{prop}

\begin{proof}
  $\Rightarrow$ If $\mathcal{L}$ induces a closed embedding of $X$, then map given by $\mathcal{L}|_{X_{\red}}$ is given by the composition with the closed embedding $X_{\red} \hookrightarrow X$.

  $\Leftarrow$ Let $\mathcal{J} \subseteq \mathcal{O}_X$ be the nilradical. By Noetherianness, there exists $n$ such that $\mathcal{J}^n = 0$.

  Fix $\mathcal{F}$ a coherent sheaf. We can filter $\mathcal{F}$ using
  \[
    \mathcal{F} \supseteq \mathcal{J}\mathcal{F} \supseteq \mathcal{J}^2 \mathcal{F} \supseteq \cdots \supseteq \mathcal{J}^{n - 1} \mathcal{F} \supseteq \mathcal{J}^n \mathcal{F} = 0.
  \]
  For each $i$, we have a short exact sequence
  \[
    0 \to \mathcal{J}^{i + 1} \mathcal{F} \to \mathcal{J}^i \mathcal{F} \to \mathcal{G}_i \to 0.
  \]
  This $\mathcal{G}_i$ is really a sheaf on the reduced structure, since $\mathcal{J}$ acts trivially.

  Moreover, we can twist this with $\mathcal{L}^m$ to get
  \[
    0 \to \mathcal{J}^{i + 1} \mathcal{F} \to \mathcal{J}^i \mathcal{F} \to \mathcal{G}_i \to 0.
  \]
  We want to prove that for $m \gg 0$, $i > 0$ and $j \geq 0$, we have
  \[
    H^i(\mathcal{J}^j \mathcal{F} \otimes \mathcal{L}^m) = 0,
  \]
  which is clear by induction up the filtration.
\end{proof}

Now suppose we take Nakai's criterion $D^{\dim V}[V] > 0$ for all $V$, and relax the condition to get $D^{\dim V}[V] \geq 0$? These are \term{Nef divisors}. These are the same as the divisors such that $D \cdot C \geq 0$ for all integral curves $C \subseteq X$. This is Kleinmann's criterion, which we will talk about later.

We now consider $\Pic_K(X)$ or $\CaDiv_K(X)$, where $K = \Q$ or $\R$, where we now allow formal $K$-linear combinations of divisors. We can extend the intersection product linearly, and all the properties of the intersection product are preserved. We write
\[
  N^1_K(X) = \CaDiv_K(X) / \Num_{0, K} = \NS(X) \otimes K
\]
where, unsurprisingly,
\[
  \Num_{0, K} = \{D \in \CaDiv_K: D \cdot C = 0\text{ for all }C \subseteq X\} = \Num_0 \otimes K.
\]

We now want to define ampleness for such divisors.

\begin{prop}
  Let $D \in \CaDiv_\Q(X)$ Then the following are equivalent:
  \begin{enumerate}
    \item $C \cdot D$ is an ample integral divisor for some $c \in \N_{>0}$.
    \item $D = \sum c_i D_i$, where $c_i \in \Q_{>0}$ and $D_i$ are ample Cartier divisors.
    \item $D$ satisfies Nakai's criterion. That is, $D^{\dim V} [V] > 0$ for all integral subvarieties $V \subseteq X$.
  \end{enumerate}
\end{prop}

\begin{proof}
  It is easy to see that (i) and (ii) are equivalent. It is also easy to see that (i) and (iii) are equivalent.
\end{proof}

We write $\Amp \subseteq N_\Q^1$ for the cone given by ample divisors.

\begin{prop}
  Ampleness is an open condition. That is, if $D$ is ample and $E_1, \ldots E_r$ are Cartier divisors, then for all $|\varepsilon_i| \ll 1$, the divisor $D + \varepsilon_i E_i$ is still ample.
\end{prop}

\begin{proof}
  First clear denominators. Then take $m \in \N$ such that $mD \pm E_i$ is still ample. This is the same as saying $D \pm \frac{1}{m} E_i$ is still ample.

  We then take $|\varepsilon_1| < \frac{1}{m}$. Then we can write
  \[
    (1 - q) D + q \left(D + \frac{1}{m} E_1\right)
  \]
  for some $q < 1$. So we are done by induction.
\end{proof}

Now if $d \in \CaDiv_\R(X)$, then we say $D$ is ample iff
\[
  D = \sum a_i D_i,
\]
where $D_i$ are ample divisors and $a_i > 0$.

\begin{prop}
  Being ample is a numerical property over $\R$, i.e.\ if $D_1, D_2 \in \CaDiv_\R(X)$ are such that $D_1 \equiv D_2$, then $D_1$ is ample iff $D_2$ is ample.
\end{prop}

\begin{proof}
  We already know that this is true over $\Q$ by Nakai's criterion. Then for real coefficients, we want to show that if $D$ is ample, $E$ is numerically trivial and $t \in \R$, then $D + tE$ is ample. To do so, pick $t_1 < t < t_2$ with $t_i \in \Q$, and then find $\lambda, \mu > 0$ such that
  \[
    \lambda (D_1 + t_1 E) + \mu (D_1 + t_2 E) = D_1 + t E.
  \]
  So we are done.
\end{proof}

\begin{ex}
  Let $H$ be an ample $\R$-divisor. Then for all $\R$-divisors $E_1, \ldots, E_r$, for all $\|\varepsilon_i\| \leq 1$, the divisor $H + \sum \varepsilon_i E_i$ is still ample.
\end{ex}

Now consider the real Neron--Severi group $N^1_\R(x)$, which contains the ample cone of ample $\R$-divisors. By definition, this is a cone and does not contain lines. Moreover, the above exercise shows that the cone is open.

\begin{defi}[Numerically effective divisor]\index{numerically effective divisor}\index{nef divisor}
  Let $X$ be a proper scheme, and $D$ a Cartier divisor. Then $D$ is \emph{numerically effective (nef)} if $D \cdot C \geq 0$ for all integral curves $C \subseteq X$.
\end{defi}

\begin{prop}\leavevmode
  \begin{enumerate}
    \item $D$ is nef iff $D|_{X_{\red}}$ is nef.
    \item $D$ is nef iff $D|_{X_i}$ is nef for all irreducible components $X_i$.
    \item If $V \subseteq X$ is a proper subscheme, and $D$ is nef, then $D|_V$ is nef.
    \item If $f: X \to Y$ is a finite morphism of proper schemes, and $D$ is nef on $Y$, then $f^* D$ is nef on $X$. The converse is true if $f$ is surjective.
  \end{enumerate}
\end{prop}

% prove Nakai for R things by finite-dimensionality of N^1(X), and then use openness of N^1(X)

\begin{thm}[Kleinmann's criterion]\index{Kleinmann's criterion}
  Let $X$ be a proper scheme, and $D$ an $\R$-Cartier divisor. THen $D$ is nef iff $D^{\dim V}[V] \geq 0$ for all proper irreducible subvarieties.
\end{thm}
This theorem lets us understand the boundary of the ample cone. We will show that this is given by the nef divisors, and the interior of the closure is exactly the ample ones.
\begin{cor}
  Let $X$ be a projective scheme, and $D$ be a nef $\R$-divisor on $X$, and $H$ be a Cartier divisor on $X$.
  \begin{enumerate}
    \item If $H$ is ample, then $D + \varepsilon H$ is also ample for all $\varepsilon > 0$.
    \item If $D + \varepsilon H$ is ample for all $0 < \varepsilon \ll 1$, then $D$ is nef.
  \end{enumerate}
\end{cor}

\begin{proof}\leavevmode
  \begin{enumerate}
    \item We may assume $H$ is very ample. By Nakai's criterion this is equivalent to requiring
      \[
        (D + \varepsilon H)^{\dim V}\cdot [V] = \left(\sum \binom{p}{\dim V} \varepsilon^p D^{\dim V - p} H^p\right)[V].
      \]
      Since any restriction of a nef divisor to any integral subscheme is also nef, and multiplying with $H$ is the same as restricting to a hyperplane cuts, we know the terms that involve $D$ are non-negative. The $H^p$ term is positive. So we are done.

%      Assume $D + \varepsilon H \equiv D'$ for some rational divisor $D'$. But $D$ is ample iff $(D')^{\dim V} \cdot [V] > 0$ for all $V$, by Nakai's criterion.
    \item We know $(D + \varepsilon H) > 0$ for all positive $\varepsilon$ sufficiently small. Taking $\varepsilon \to 0$, we know $D \cdot C \geq 0$.\qedhere
  \end{enumerate}
\end{proof}

\begin{proof}[Proof of Kleinmann's criterion]
  We may assume that $X$ is an integral projective scheme. The $\Leftarrow$ direction is immediate. To prove the other direction, since the criterion is a closed condition, we may assume $D \in \Div_\Q(X)$. Moreover, by induction, we may assume that $D^{\dim V}[V] \geq 0$ for all $V$ strictly contained in $X$, and we have to show that $D^{\dim X} \geq 0$. Suppose not, and $D^{\dim X} < 0$.

  Fix an ample Cartier divisor $H$, and consider the polynomial
  \[
    P(t) = (D + tH)^{\dim X} = D^{\dim X} + \sum_{i = 1}^{\dim X - 1} t^i \binom{\dim X}{i} H^i D^{\dim X - i} + t^{\dim X} H^{\dim X}.
  \]
  The first term is negative; the last term is positive; and the other terms are non-negative since we can assume $H$ is very ample, and we can apply induction.

  Then on $\R_{>0}$, this polynomial is increasing. So there exists a unique $t$ such that $P(t) = 0$. Let $\bar{t}$ be the root. Then $P(\bar{t}) = 0$. We can also write
  \[
    P(t) = (D + tH) \cdot (D + tH)^{\dim X - 1} = R(t) + t Q(t),
  \]
  where
  \[
    R(t) = D \cdot (D + tH)^{\dim X - 1},\quad Q(t) = H \cdot (D + tH)^{\dim X - 1}.
  \]
  We shall prove that $R(\bar{t}) \geq 0$ and $Q(\bar{t}) > 0$, which is a contradiction.

  We first look at $Q(t)$, which is
  \[
    Q(t) = \sum_{i = 0}^{\dim X - 1} t^i \binom{\dim X - 1}{i} H^{i + 1} D^{\dim X - i},
  \]
  which, as we argued, is a sum of non-negative terms and a positive term.

  To understand $R(t)$, we look at
  \[
    R(t) = D \cdot (D + tH)^{\dim X - 1}.
  \]
  Note that so far, we haven't used the assumption that $D$ is nef. If $t > \bar{t}$, then $(D + tH)^{\dim X} > 0$, and $(D + tH)^{\dim V}[V] > 0$ for a proper integral subvariety, by induction (and binomial expansion). Then by Nakai's criterion, $D + tH$ is ample. So by multiplying by a huge number, the intersection $(D + tH)^{\dim X - 1}$ is essentially a curve. So we are done by definition of nef. Then take the limit $t \to \bar{t}$.
\end{proof}

It should be very clear that curves play a very important role in the theory of positivity of divisors.

\begin{defi}[1-cycles]\index{1-cycle}\index{$Z_1(X)_R$}
  We define the space of $1$-cycles to be
  \[
    Z_1(X)_\R = \left\{\sum a_i C_i : a_i \in \R, C_i \subseteq X\text{ integral proper curves}\right\}.
  \]
\end{defi}
Of course, we can make the same definitions with $\Z$ or $\Q$. We then have a pairing
\begin{align*}
  N^1_K(X) \times Z_1(X) &\to K\\
  (D, E) &\mapsto D \cdot E.
\end{align*}
We know that $N^1_K(X)$ is finite-dimensional, but $Z_1(X)_K$ is certainly uncountable. So there is no hope that this intersection pairing is perfect
\begin{defi}[Numerical equivalence]\index{numerical equivalence}\index{$\equiv$}
  Let $X$ be a proper scheme, and $C_1, C_2 \in Z_1(X)_K$. Then $C_1 \equiv C_2$ iff
  \[
    D \cdot C_1 = D \cdot C_2
  \]
  for all $D \in N^1_K(X)$.
\end{defi}

\begin{defi}[$N_1(X)_K$]\index{$N_1(X)_K$}
  Let $X$ be a proper scheme. The $K$-module of $K$ $1$-cycles modulo numerical equivalence is $N_1(X)_K$.
\end{defi}
Thus we get a perfect pairing $N^1(X)_K \times N_1(X)_K \to K$.

We know that the ample divisors live inside both $\Nef(X)$ and $N^1i_\R(X)$. We also know that the nef cone is closed. Also, if $D \in \Nef(X)$ and $H \in \Amp(X)$, then $D + tH \in \Amp(X)$. $\Amp(X)$ and $\Nef(X)$ are both cones that do not contain lines. % X is projective

Inside $N_1(X)_\R$, we also have have
\[
  NE(X) = \{\gamma \in N_1(X)_\R : \gamma \equiv \sum [a_i C_i]: a_i > 0, C_i \subseteq X\text{ integral curves}\}.
\]
This is the cone of effective curves. This cone detects nef divisors, since by definition, an $\R$-divisor $D$ is nef iff $D \cdot \gamma \geq 0$ for all $\gamma \in NE(X)$.

\begin{defi}[Dual cone]\index{dual cone}
  Let $V$ be a finite-dimensional vector space over $\R$ and $V^*$ the dual of $V$. If $C \subseteq V$ is a cone, then we define the \emph{dual cone} $C^\vee \subseteq V^*$  by
  \[
    C^\vee = \{f \in V^* : f(c) \geq 0\text{ for all }c \in C\}.
  \]
\end{defi}
We then see that $\Nef(X) = NE(X)^\vee$ by definition.

It is easy to see that $C^{\vee \vee} = \bar{C}$.

\begin{prop}
  $\Nef(X) = \overline{\Amp(X)}$ and $\mathrm{int}(\Nef(X)) = \Amp(X)$.
\end{prop}

\begin{proof}
  We know $\Amp(X) \subseteq \Nef(X)$ and $\Amp(X)$ is open. So this implies $\Amp(X) \subseteq \mathrm{int}(\Nef(X))$, and thus $\overline{\Amp(X)} \subseteq \Nef(X)$.

  Recall that $D + tH$ is ample if $D$ is nef, $H$ is ample and $t > 0$, we know that $\overline{\Amp(X)} = \Nef(X)$.

  Conversely, if $D \in \int(\Nef(X))$, we fix $H$ ample. Then $D - tH \in \Nef(X)$ for small $t$, by definition of interior. Then $D = (D - tH) + tH$ is ample.
\end{proof}
We then see that $\overline{NE(X)} = \Nef(X)^\vee$.
\begin{thm}[Kleinmann's criterion]
  If $X$ is a projective scheme and $D \subseteq \CaDiv_\R(X)$. Then the following are equivalent:
  \begin{enumerate}
    \item $D$ is ample
    \item $D|_{\overline{NE(X)}} > 0$, i.e.\ $D \cdot \gamma > 0$ for all $\gamma \in \overline{NE(X)}$.
    \item $\mathbb{S}_1 \cap \overline{NE(X)} \subseteq \mathbb{S}_1 \cap D_{>0}$, where $S_1 \subseteq N_1((X)_\R$ is the unit sphere under some choice of norm.
  \end{enumerate}
\end{thm}

\begin{proof}\leavevmode
  \begin{itemize}
    \item (1) $\Rightarrow$ (2): Trivial
    \item (2) $\Rightarrow$ (1): If $D|_{\overline{NE(X)}} > 0$, then $D \in \int (\Nef(X))$.
    \item (2) $\Leftrightarrow$ (3): Similar.
  \end{itemize}
\end{proof}

\begin{thm}
  Let $X$ be a projective scheme, and $D, H \in N^1_\R(X)$. Assume that $H$ is ample. Then $D$ is ample iff there exists $\varepsilon > 0$ such that
  \[
    \frac{\D \cdot C}{\H \cdot C} \geq \varepsilon.
  \]
\end{thm}

\begin{proof}
  The statement in the lemma is the same as $(D - \varepsilon H) \cdot C \geq 0$.
\end{proof}

\begin{eg}
  Let $X$ be a smooth projective surface. Then
  \[
    N^11(X)_\R = N_1(X)_\R,
  \]
  since $\dim X = 2$ and $X$ is smooth (so that we can identify Weil and Cartier divisors). We certainly have
  \[
    \Nef(X) \subseteq \overline{NE(X)}.
  \]
  This can be proper. For example, if $C \subseteq X$ is such that $C$ is irreducible with $C^2 < 0$, then $C$ is not nef.

  Suppose $\gamma = \sum a_i C_i \in NE(X)$  and $\gamma \cdot C < 0$. Then $C$ must be one of the $C_i$. So we can write
  \[
    \gamma = a_C C + \sum_{i = 2}^k a_i C_i,
  \]
  where $a_C, a_i > 0$ and $C_i \not= C$ for all $i \geq 2$.

  So for any element in $\gamma \in NE(X)$, we can write
  \[
    \gamma = \lambda C + \gamma',
  \]
  where $\lambda > 0$ and $\gamma' = \overline{NE(X)}_{C \geq 0}$, i.e.\ $\gamma' \cdot C \geq 0$. So we can write
  \[
    \overline{NE(C)} = \R^+[C] + \overline{NE(X)}_{C \geq 0}.
  \]
  Thus, $[C] \in N_1(X)_\R$ is an extremal ray of $\overline{NE(X)}$. In other words, if
  \[
    \lambda [C] = \mu_1 \gamma_1 + \mu_2 \gamma_2
  \]
  where $\mu_i > 0$ and $\gamma_i \in \overline{NE(X)}$, then $\gamma_i$ is a multiple of $[C]$.
\end{eg}

\begin{eg}
  Let $C$ be a smooth projective curve off genus $g$. Let $U$ be a vector bundle on $C$ with rank $2$. let $X = \P(U) \overset{\pi}{\to} C$. Assume that $\deg U = 2k$. Then up to twisting $U$ with a line bundle of degree $-k$, we can assume $\deg U = 0$.

  One can show using the localization sequence that % twist and then pick a section, removing gives an A^1-bundle. 
  \[
    N^1(X)_\R = \R[F] + \R[\mathcal{O}_{\P(U)}(1)],
  \]
  where $F$ is a fiber of $\pi$. We write $\psi$ for $\mathcal{O}_{\P(U)}(1)$. We certainly have $F^2 = 0$, and $F \cdot \psi = 1$ since $\mathcal{O}_{\P(U)}(1)$ restricted to $F$ is just $\mathcal{O}(1)$. We also have $\psi^2 = \deg (U) = 0$. So
  \[
    (aF + b\psi)^2 = 2 ab.
  \]
  So we find that $\Nef(X)$ is contained in the first first quartile $\R^+ F + \R^+ \psi$.
\end{eg}
\printindex
\end{document}
