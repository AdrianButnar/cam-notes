\documentclass[a4paper]{article}

\def\npart {II}
\def\nterm {Lent}
\def\nyear {2016}
\def\nlecturer {I. Grojnowski}
\def\ncourse {Number fields}
\def\nlectures {TT.12}
\def\nnotready {}

\input{header}

\begin{document}
\maketitle
{\small
\noindent Definition of algebraic number fields, their integers and units. Norms, bases and discriminants.\hspace*{\fill} [3]

\vspace{5pt}
\noindent Ideals, principal and prime ideals, unique factorisation. Norms of ideals.\hspace*{\fill} [3]

\vspace{5pt}
\noindent Minkowski's theorem on convex bodies. Statement of Dirichlet's unit theorem. Determination of units in quadratic fields.\hspace*{\fill} [2]

\vspace{5pt}
\noindent Ideal classes, finiteness of the class group. Calculation of class numbers using statement of the Minkowski bound.\hspace*{\fill} [3]

\vspace{5pt}
\noindent Dedekind's theorem on the factorisation of primes. Application to quadratic fields.\hspace*{\fill} [2]

\vspace{5pt}
\noindent Discussion of the cyclotomic field and the Fermat equation or some other topic chosen by the lecturer.\hspace*{\fill} [3]}

\tableofcontents
\setcounter{section}{-1}
\section{Introduction}
Technically, IID Galois Theory is not a prerequisite of this course. However, many results we have are analogous to what we did in Galois Theory, and we will not refrain from pointing out the correspondence. If you have not learnt Galois Theory, then you can ignore them.

\section{Integrality}
We start with some definitions.

\begin{defi}[Field extension]
  A \emph{field extension} is an inclusion of fields $K \subseteq L$. We sometimes write this as $L/K$.
\end{defi}

\begin{defi}[Degree of field extension]
  Let $K \subseteq L$ be fields. Then $L$ is a field over $K$, and the \emph{degree} of the field extension is
  \[
    [L:K] = \dim_K (L).
  \]
\end{defi}

\begin{defi}[Finite extension]
  A \emph{finite field extension} is a field extension with finite degree.
\end{defi}

\begin{defi}[Number field]
  A \emph{number field} is a finite field extension over $\Q$.
\end{defi}

What is special about number fields is that there is a canonical copy of $\Z \subseteq \Q$ lying inside it. Using this $\Z \subseteq \Q$, we define
\begin{defi}[Algebraic integer]
  Let $L$ be a number field. An \emph{algebraic integer} is an $\alpha \in L$ such that there is some monic $f \in \Z[x]$ with $f(\alpha) = 0$. We write $\mathcal{O}_L$ for the set of algebraic integers in $L$. This is a generalization of $\Z \subseteq \Q$.
\end{defi}

These are what we are going to study here. Since we say this is a generalization of $\Z \subseteq \Q$, the following better be true:

\begin{lemma}
  $\mathcal{O}_\Q = \Z$, ie. $\alpha \in \Q$ is an algebraic integer if and only if $\alpha \in \Z$.
\end{lemma}

\begin{proof}
  If $\alpha \in \Z$, then $x - \alpha \in \Z[x]$ is a monic polynomial. So $\alpha \in \mathcal{O}_\Q$.

  On the other hand, let $\alpha \in \Q$. Then there is some coprime $r, s \in \Z$ such that $\alpha = \frac{r}{s}$. If it is an algebraic integer, then there is some
  \[
    f(x) = x^n + a_{n - 1} x^{n - 1} + \cdots + a_0
  \]
  with $a_i \in \Z$ such that $f(\alpha) = 0$. Substituting in and multiplying by $s^n$, we get
  \[
    r^n + \underbrace{a_{n - 1} r^{n - 1}s + \cdots + a_0 s^n}_{\text{divisible by }s} = 0,
  \]
  So $s\mid r^n$. But if $s\not= 1$, there is a prime $p$ such that $p \mid s$, and hence $p \mid r^n$. Thus $p \mid r$. So $p$ is a common factor of $s$ and $r$. This is a contradiction. So $s = 1$, and $\alpha$ is an integer.
\end{proof}

How else is this a generalization of $\Z$? We know $\Z$ is a ring. So perhaps $\mathcal{O}_L$ also is.

\begin{thm}
  $\mathcal{O}_L$ is a ring, ie. if $\alpha, \beta \in \mathcal{O}_L$, then so is $\alpha \pm \beta$ and $\alpha\beta$.
\end{thm}
Note that usually $\frac{1}{\alpha} \not \in \mathcal{O}_L$.

Before proving this, we note that this is a refinement of something we've proved in IID Galois Theory. Recall that if $L/K$ is a field extension with $\alpha, \beta \in L$ algebraic over $K$, then so is $\alpha\beta$ and $\alpha \pm \beta$, as well as $\frac{1}{\alpha}$ if $\alpha \not= 0$.

The proof is as follows: consider $K[\alpha, \beta] \subseteq L$. Then $K[\alpha, \beta]$ is a finite-dimensional vector space over $K$, spanned by $\alpha^i \beta^j$ with $1 \leq i \leq n$, $1 \leq j \leq m$, where $n$ and $m$ are the degrees of $\alpha$. So if $x \in K[\alpha, \beta]$, then $1, x, x^2, \cdots, x^N$ is linearly dependent for sufficiently large $N$. So $x$ satisfies an algebraic equation. We apply this to $\alpha \pm \beta, \alpha\beta$ etc. The crux of this proof is that finiteness implies algebraicity.

We would like to prove this theorem in an analogous way. However, in this case, we are looking at polynomials over $\Z$, which is a ring, not a field. Hence we need to extend the notion of being algebraic and finite to rings.

\begin{defi}[Integrality]
  Let $R \subseteq S$ be rings. We say $\alpha \in S$ is \emph{integral over $R$} if there is some monic polynomial $f \in R[x]$ such that $f(\alpha) = 0$.

  We say $S$ is \emph{integral over $R$} if all $\alpha \in S$ are integral over $R$.

  We say $S$ is \emph{finitely-generated} over $R$ if there exists elements $\alpha_1, \cdots, \alpha_n \in S$ such that the function $R^n \to S$ defined by $(r_1, \cdots, r_n) \mapsto \sum r_i \alpha_i$ is surjective, ie. every element of $S$ can be written as a $R$-linear combination of elements $\alpha_1, \cdots, \alpha_n$. In other words, $S$ is finitely-generated as an $R$-module.
\end{defi}
This is a refinement of the idea of being algebraic. We allow the use of rings and restrict to monic polynomials. In Galois theory, we showed that finiteness and algebraicity ``are the same thing''. We will generalize this to integrality of rings.

\begin{eg}
  In a number field $\Z \subseteq \Q \subseteq L$, $\alpha \in L$ is an algebraic integer if and only if $\alpha$ is integral over $\Z$ by definition, and $\mathcal{O}_L$ is integral over $\Z$.
\end{eg}

\begin{notation}
  If $\alpha_1, \cdots, \alpha_r \in S$, we write $R[\alpha_1, \cdots, \alpha_r]$ for the subring of $S$ generated by $R, \alpha_1, \cdots, \alpha_r$. In other words, it is the image of the homomorphism from the polynomial ring $R[x_1, \cdots, x_n] \to S$ given by $x_i \mapsto \alpha_i$.
\end{notation}

\begin{prop}\leavevmode
  \begin{enumerate}
    \item Let $R \subseteq S$ be rings. If $S = R[s]$ and $s$ is integral over $R$, then $S$ is finitely-generated over $R$.
    \item If $S = R[s_1, \cdots, s_n]$ with $s_i$ integral over $R$, then $S$ is finitely-generated over $R$.
  \end{enumerate}
\end{prop}
This is the easy direction in identifying integrality with finitely-generated.

\begin{proof}\leavevmode
  \begin{enumerate}
    \item We know $S$ is spanned by $1, s, s^2, \cdots$ over $R$. However, since $s$ is integral, there exists $a_0, \cdots, a_n \in R$ such that
      \[
        s^n = a_0 + a_1 s + \cdots + a_{n - 1}s^{n - 1}.
      \]
      So the $R$-submodule generated by $1, s, \cdots, s^{n - 1}$ is stable under multiplication by $s$. So it contains $s^n, s^{n + 1}, s^{n + 2}, \cdots$. So it is $S$.
    \item Let $S_i = R[s_1, \cdots, s_i]$. So $S_i = S_{i - 1}[s_i]$. Since $s_i$ is integral over $R$, it is integral over $s_{i - 1}$. By the previous part, $S_i$ is finitely-generated over $S_{i - 1}$. To finish, it suffices to show that being finitely-generated is transitive. More precisely, if $A \subseteq B \subseteq C$ are rings, $B$ is finitely generated over $A$ and $C$ is finitely generated over $B$, then $C$ is finitely generated over $A$. This is left as an exercise for the reader. % exercise
  \end{enumerate}
\end{proof}
The converse to this is harder.

\begin{thm}
  If $S$ is finitely-generated over $R$, then $S$ is integral over $R$.
\end{thm}
The idea of the proof is as follows: if $s \in S$, we need to find a monic polynomial which it satisfies. In Galois theory, we have fields and vector spaces, and the proof is easy. We can just consider $1, s, s^2, \cdots$, and linear dependence kicks in and gives us a relation. But even if this worked in our case, there is no way we can make this polynomial monic.

Instead, consider the multiplication by $s$ map: $m_s: S \to S$ by $\gamma \mapsto s\gamma$. If $S$ were a finite-dimensional vector space over $R$, then Cayley-Hamilton tells us $m_s$, and thus $s$, satisfies its characteristic polynomial, which is monic. Even though $S$ is not a finite-dimensional vector space, the proof of Cayley-Hamilton will work.

\begin{proof}
  Let $\alpha_1, \cdots, \alpha_n$ generate $S$ as an $R$-module. wlog take $\alpha_1 = 1 \in S$. For any $s \in S$, write
  \[
    s \alpha_i = \sum b_{ij}\alpha_j
  \]
  for some $b_{ij} \in R$. We write $B = (b_{ij})$. This is the ``matrix of multiplication by $S$''. By construction, we have
  \[
    (sI - B)
    \begin{pmatrix}
      \alpha_1\\\vdots\\a_n
    \end{pmatrix} = 0.\tag{$*$}
  \]
  Now recall for any matrix $X$, we have $\adj(X)X = (\det X) I$, where the $i, j$th entry of $\adj(X)$ is given by the determinant of the matrix obtained by removing the $i$th row and $j$th column of $X$.

  We now multiply $(*)$ by $\adj(s I - B)$. So we get
  \[
    \det(sI - B)
    \begin{pmatrix}
      \alpha_1\\\vdots\\\alpha_n
    \end{pmatrix} = 0
  \]
  In particular, $\det(sI - B) \alpha_1 = 0$. Since we picked $\alpha_1 = 1$, we get $\det(sI - B) = 0$. Hence if $f(x) = \det(xI - B)$, then $f(x) \in R[x]$, and $f(s) = 0$.
\end{proof}

Hence we obtain the following:
\begin{cor}
  let $L \supseteq \Q$ be a number field. Then $\mathcal{O}_L$ is a ring.
\end{cor}

\begin{proof}
  if $\alpha, \beta \in \mathcal{O}_L$, then $\Z[\alpha, \beta]$ is finitely-generated by the proposition. But then $\Z[\alpha, \beta]$ is integral over $\Z$, by the previous theorem. So $\alpha \pm \beta, \alpha\beta \in \Z[\alpha, \beta]$.
\end{proof}

\begin{cor}
  If $A \subseteq B \subseteq C$ be ring extensions such that $B$ over $A$ and $C$ over $B$ are integral extensions. Then $C$ is integral over $A$.
\end{cor}

\begin{proof}
  If $c \in C$, let $f(x) = \sum_{0}^N b_i x^i \in B[x]$ be a monic polynomial such that $f(c) = 0$. Let $B_0 = A[b_0, \cdots, b_N]$ and let $C_0 = B_0[c]$. Then $B_0/A$ is finitely generated as $b_0, \cdots, b_N$ are integral over $A$. Also, $C_0$ is finitely-generated over $B_0$, since $c$ is integral over $B_0$. Hence $C_0$ is finitely-generated over $A$. So $c$ is integral over $A$.
\end{proof}

Note that $C$ could have been infinitely generated over $A$, such as $C = \{\alpha \in \C: \alpha\text{ is an algebraic integer}\}$, $A = \Z$ and $B = \Z[i]$. This is why we have to create our $C_0$. The point is that for any $c \in C$, only finitely many elements are involved in the $n$-degree polynomial relation on it.

Exercise: show that $\mathcal{O}_{\Q[i]} = \Z[i]$.

Recall that if $K \subseteq L$ is a field extensions with $\alpha \in L$, then the minimal polynomial is the \emph{monic polynomial} $p_\alpha(x) \in K[x]$ of minimal degree such that $p_\alpha(\alpha) = 0$.

Recall that we had the following lemma about minimal polynomials:
\begin{lemma}
  If $f \in K[x]$ with $f(\alpha) = 0$, then $p_\alpha \mid f$.
\end{lemma}

\begin{proof}
  Write $f = p_\alpha h + r$, with $r \in K[x]$ and $\deg(r) < \deg (p_\alpha)$. Then we have
  \[
    0 = f(\alpha) = p(\alpha) h(\alpha) + r(\alpha) = r(\alpha).
  \]
  So if $r \not= 0$, this contradicts the minimality of $\deg p_\alpha$.
\end{proof}

This lemma implies $p_\alpha$ is unique. For number fields, we have the following:
\begin{prop}
  Let $L$ be a number field. Then $\alpha \in \mathcal{O}_L$ if and only if the minimal polynomial $p_\alpha(x) \in \Q[x]$ for the field extension $\Q \subseteq L$ is in fact in $\Z[x]$.
\end{prop}
This is a nice proposition. This gives us an necessary and sufficient condition for whether something is algebraic.
\begin{proof}
  $(\Leftarrow)$ is trivial, since this is just the definition of an algebraic integer.

  $(\Rightarrow)$ Let $\alpha \in \mathcal{O}_L$ and $p_\alpha \in \Q[x]$ be the minimal polynomial of $\alpha$, and $h(x) \in \Z[x]$ be a monic polynomial which $\alpha$ satisfies. Now there exists a bigger field $M \supseteq L$ such that
  \[
    p_\alpha(x) = (x - \alpha_1) \cdots (x - \alpha_r)
  \]
  factors in $M[x]$. But by our lemma, $p_\alpha \mid h$. So $h(\alpha_i) = 0$ for all $\alpha_i$. So $\alpha_L \in \mathcal{O}_M$ is an algebraic integer. By $\mathcal{O}_M$ is a ring, ie. sums and products of the $\alpha_i$'s are still algebraic integers. So the coefficients of $p_\alpha$ are algebraic integers (in $\mathcal{O}_M$). But they are also in $\Q$. By the first result we proved, the $\alpha_i$ must be integers.
\end{proof}
Alternatively, we can deduce this proposition from the previous lemma plus Gauss' lemma.

Another relation between $\Z$ and $\Q$ is that $\Q$ is the fraction field of $\Z$. This is true for general number fields
\begin{lemma}
  We have
  \[
    \mathrm{Frac} \mathcal{O}_L = \left\{\frac{\alpha}{\beta}: \alpha, \beta \in \mathcal{O}_L, \beta \not= 0\right\} = L.
  \]
  In fact, for any $\alpha \in L$, there is some $n \in \Z$ such that $n\alpha \in \mathcal{O}_L$.
\end{lemma}

\begin{proof}
  if $\alpha \in L$, let $g(x) \in \Q[x]$ be its monic minimal polynomial. Then there exists $n \in \Z$ non-zero such that $ng(x) \in \Z[x]$ (pick $n$ to be the least common multiple of the denominators of the coefficients of $g(x)$). Now the magic is to put
  \[
    h(x) = n^{\deg(g)}g\left(\frac{x}{n}\right).
  \]
  Then this is a monic polynomial with integral coefficients --- in effect, we have just multiplied the coefficient of $x^i$ by $n^{\deg(g) - i}$! Then $h(n\alpha) = 0$. So $n\alpha$ is integral.
\end{proof}

\subsection{Norms and traces}
Recall from IID Galois Theory that if $K \subseteq L$ are fields, $\alpha \in L$ and $m_\alpha: L \to L$ is the function $\ell \mapsto \alpha \ell$, we define
\begin{defi}[Norm and trace]
  The \emph{norm} of $\alpha$ is
  \[
    N_{L/K}(\alpha) = \det m_\alpha.
  \]
  The \emph{trace} is
  \[
    \tr_{L/K} = \tr m_\alpha.
  \]
\end{defi}

We have also proved the proposition
\begin{prop}
  Let $p_\alpha \in K[x]$ be the minimal polynomial of $\alpha$. Then the characteristic polynomial of $m_\alpha$ is
  \[
    \det(xI - m_\alpha) = p_\alpha^{[L:K(\alpha)]}
  \]
  Hence if $p_\alpha(x)$ splits in some field $L'\supseteq K(\alpha)$, say
  \[
    p_\alpha(x) = (x - \alpha_1) \cdots (x - \alpha_r),
  \]
  then
  \[
    N_{K(\alpha)/K}(\alpha) = \prod \alpha_i,\quad \tr_{K(\alpha)/K}(\alpha) = \sum \alpha_i,
  \]
  and hence
  \[
    N_{L/K}(\alpha) = \left(\prod \alpha_i\right)^{[L:K(\alpha)]},\quad \tr_{L/K} = [L:K(\alpha)] \left(\sum \alpha_i\right).
  \]
\end{prop}
This was proved in the IID Galois Theory course, and we will just use it without proving.

\begin{prop}
  Let $L \supseteq \Q$ be a number field. Then $\alpha \in \mathcal{O}_L$ if and only if the minimal polynomial $p_\alpha \in \Z[x]$ if and only if the characteristic polynomial of $m_\alpha \in \Z[x]$. This in particular implies $N_{L/\Q}(\alpha) \in \Z$ and $\tr_{L/\Q}(\alpha) \in \Z$.
\end{prop}

\begin{proof}
  The first equivalence was proven. For the second equivalence, if $m_\alpha \in \Z[x]$, then $\alpha \in \mathcal{O}_L$ since it vanishes on a monic polynomial in $\Z[x]$. On the other hand, if $p_\alpha \in \Z[x]$, then so is the characteristic polynomial, since it is just $p_\alpha^N$.

  The final implication comes from the fact that the norm and trace are just coefficients of the characteristic polynomial.
\end{proof}

It would be nice if the last implication is an if and only if. This occurs, obviously, when the characteristic polynomial is quadratic, since the norm and trace would be the only coefficients.
\begin{eg}
  Let $L = K(\sqrt{d}) = K[z]/(z^2 - d)$, where $d$ is not a square in $K$. As a vector space over $K$, we can take $1, \sqrt{d}$ as our basis. So every $\alpha$ can be written as
  \[
    \alpha = x + y\sqrt{d}.
  \]
  Hence the matrix of multiplication by $\alpha$ is
  \[
    m_\alpha =
    \begin{pmatrix}
      x & dy\\
      y & x
    \end{pmatrix}.
  \]
  So the trace and norm are given by
  \begin{align*}
    \tr_{L/K} (x + y\sqrt{d}) &= 2x = (x + y\sqrt{d}) + (x - y\sqrt{d})\\
    N_{L/K} (x + y \sqrt{d}) &= x^2 - dy^2 = (x + y\sqrt{d})(x- y\sqrt{d})
  \end{align*}
\end{eg}

Now that we have computed the general trace and norm, we can use the proposition to find out what the algebraic integers are.
\begin{lemma}
  Let $L = \Q(\sqrt{d})$, where $d \in \Z$ is not $0, 1$ and is square-free. Then
  \[
    \mathcal{O}_L =
    \begin{cases}
      \Z[\sqrt{d}] & d \equiv 2 \text{ or }3\pmod 4\\
      \Z\left[\frac{1}{2}(1 + \sqrt{d})\right] & d \equiv 1 \pmod 4
    \end{cases}
  \]
\end{lemma}
This result is weird --- intuitively it makes sense if it is always $\Z[\sqrt{d}]$. However, it turns out sticking with our definition of algebraic integers, we get much nicer properties.

\begin{proof}
  We know $x + y \sqrt{\lambda} \in \mathcal{O}_L$ if and only if $2x, x^2 - dy^2 \in \Z$ by the previous example. These imply $4dy^2 \in \Z$. So if $y = \frac{r}{s}$ with $r, s$ coprime, $r, s \in \Z$, then we must have $s^2 \mid 4d$. But $d$ is square-free. So $s = 1$ or $2$. So
  \[
    x = \frac{u}{2},\quad y = \frac{v}{2}
  \]
  for some $u, v \in \Z$. Then we know $u^2 - dv^2 \in 4\Z$, ie. $u^2 \equiv dv^2 \mod 4$. But we know the squares mod $4$ are always $0$ and $1$. So if $d \not\equiv 1 \pmod 4$, then $u^2 \equiv dv^2\pmod 4$ imply that $u^2 = v^2 = 0\pmod 4$, and hence $u, v$ are even. So $x, y \in \Z$, giving $\mathcal{O}_L = \Z[\sqrt{d}]$.

  On the other hand, if $d \equiv 1\pmod 4$, then $u, v$ have the same parity mod 2, ie. we can write $x + y\sqrt{d}$ as a $\Z$-combination of $1$ and $\frac{1}{2}(1 + \sqrt{d})$.

  As a sanity check, we find that the minimal polynomial of $\frac{1}{2}(1 + \sqrt{d})$ is $x^2 - x + \frac{1}{4}(1 - d)$ which is in $\Z$ if and only if $d \equiv 1 \pmod 4$.
\end{proof}

We will need the following fact from Galois theory.
\begin{thm}[Primitive element theorem]
  Let $K \subseteq L$ be separable field extensions, $\beta \in L$ and $K(\beta) \subseteq L$. Then there exists an $\alpha \in L$ such that $K(\alpha) = K$.
\end{thm}

For example, $\Q(\sqrt{2}, \sqrt{3}) = \Q(\sqrt{2} + \sqrt{3})$.

Hence in particular, if $L \supseteq \Q$, a number field, there is some $\alpha$ such that $L = \Q(\alpha)$. So if $p_\alpha \in \Q[x]$ is its minimal polynomial, then
\[
  \frac{\Q[x]}{(p_\alpha)} \cong \Q(\alpha) = L.
\]
Also, we have
\[
  [L:\Q] = n = \deg p_\alpha.
\]
Then $L$ has basis $1, \alpha, \alpha^2, \cdots, \alpha^{n - 1}$. Moreover, we have
\begin{lemma}
  $n$ is the number of field embeddings $L \hookrightarrow \C$.
\end{lemma}

\begin{proof}
  Let $p_\alpha(x) \in \Q[x]$ be irreducible. So $p_\alpha$ and $p_\alpha' = \frac{\d}{\d x}p_\alpha$ have no common factors, ie.
  \[
    p_\alpha(x) = (x - \alpha_1) \cdots (x - \alpha_n)
  \]
  has $n$ distinct roots in $\C$, namely $\alpha_1, \cdots, \alpha_n \in \C$.

  A field map $\Q[x]/(p_\alpha) \to \C$ is automatically $\Q$-linear. So we must send $x$ to a root of $p_\alpha(x)$ in $\C$, ie. one of $\alpha_1, \cdots, \alpha_n$, and is determined uniquely by this. Conversely, sending $x \mapsto \alpha_i$ determines one such map.
\end{proof}

This allows us to define an invariant that refines $n = [L:\Q]$.

\begin{defi}[$r$ and $s$]
  Let $r$ be the number of real roots of $p_\alpha$ and $s$ be the number of pairs of complex conjugate roots. So
  \[
    n = r + 2s,\quad s = \frac{n - r}{2}.
  \]
  This is independent of the choice of $\alpha$, as $r$ is the number of field embeddings $L \hookrightarrow \R$.
\end{defi}
This will be really important for the second half of the course.

\begin{cor}
  Let $L \supseteq \Q$ be a number field. If $\sigma_1, \cdots, \sigma_n:L \to \C$ are the different field embeddings and $\beta \in L$, then
  \[
    \tr_{L/\Q}(\beta) = \sum \sigma_i(\beta),\quad N_{L/\Q}(\beta) = \prod_i \sigma_i(\beta).
  \]
  We call $\sigma_1(\beta), \cdots, \sigma_n (\beta)$ the \emph{conjugates} of $\beta$ in $\C$.
\end{cor}
Proof is in the Galois theory course.

\begin{prop}
  Let $L\supseteq K$ be a separable extension. Then a $K$-bilinear form $L \times L \to K$ defined by $(x, y) \mapsto \tr_{L/K}(xy)$ is non-degenerate. Equivalent, if $\alpha_1,\cdots, \alpha_n$ are a $K$-basis for $L$, the Gram matrix $(\tr(\alpha_i\alpha_j))_{i, j = 1, \cdots, n}$ has non-zero determinant.
\end{prop}
Recall from Galois theory that if $K \subseteq L$ is \emph{not} separable, then $\tr_{L/K} = 0$, and it is very \emph{very} degenerate.

We will use the following important notation:
\begin{notation}
  \[
    \Delta(\alpha_1, \cdots, \alpha_n) = \det(\tr_{L/K}(\alpha_i \alpha_j)).
  \]
\end{notation}

\begin{proof}
  Let $\sigma_1, \cdots, \sigma_n: L \to \bar{K}$ be distinct the $n$ distinct $K$-linear field embeddings $L \hookrightarrow \bar{K}$. They are distinct as $L \supseteq K$ is separable. Put
  \[
    S = (\sigma_i(\alpha_j))_{i, j = 1, \cdots, n} =
    \begin{pmatrix}
      \sigma_1(\alpha_1) & \cdots & \sigma_1(\alpha_n)\\
      \vdots & \ddots & \vdots\\
      \sigma_n(\alpha_1) & \cdots & \sigma_n(\alpha_n).
    \end{pmatrix}
  \]
  Then
  \[
    S^T S = \left(\sum_{k = 1}^n \sigma_k(\alpha_i)\sigma_k(\alpha_j)\right)_{i,j = 1, \cdots n}.
  \]
  We know $\sigma_k$ is a field homomorphism. So
  \[
    \sum_{k = 1}^n \sigma_k (\alpha_i)\sigma_k(\alpha_j) = \sum_{k = 1}^n \sigma_k(\alpha_i \alpha_j) = \tr_{L/K}(\alpha_i \alpha_j).
  \]
  So
  \[
    S^T S = (\tr(\alpha_i\alpha_j))_{i, j = 1, \cdots, n}.
  \]
  So we have
  \[
    \Delta(\alpha_1, \cdots, \alpha_n) = \det(S^T S) = \det(S)^2.
  \]
  Now we use the theorem of primitive elements to write $L = K(\theta)$ such that $1, \theta, \cdots, \theta^{n - 1}$ is a basis for $L$ over $K$, with $[L:K] = n$. Now $S$ is just
  \[
    S =
    \begin{pmatrix}
      1 & \sigma_1(\theta) & \cdots & \sigma_1(\theta)^{n - 1}\\
      \vdots & \vdots & \ddots & \vdots\\
      1 & \sigma_n(\theta) & \cdots & \sigma_n(\theta)^{n - 1}
    \end{pmatrix}.
  \]
  This is a Vandermonde matrix, and so
  \[
    \Delta(1, \theta, \cdots, \theta^{n - 1}) = (\det S)^2 = \prod_{i < j} (\sigma_i(\theta) - \sigma_j(\theta))^2.
  \]
  Since the field extension is separable, and hence $\sigma_i \not= \sigma_j$ for all $i, j$. This implies $\sigma_i (\theta) \not= \sigma_j(\theta)$, since $\theta$ generates the field. so the product above is non-zero.
\end{proof}
So we have this nice canonical bilinear map. However, this determinant is not canonical. Recall that if $\alpha_1, \cdots, \alpha_n$ is a basis for $L/K$, and $\alpha_1', \cdots, \alpha_n'$ is another basis, then
\[
  \alpha_i' = \sum a_{ij}\alpha_j
\]
for some $A = (a_{ij}) \in \GL_n(K)$. So
\[
  \Delta(\alpha_1', \cdots, \alpha_n') = (\det A)^2 \Delta(\alpha_1, \cdots, \alpha_n).
\]
However, for number fields, we will later see that we can pick a ``canonical'' basis, and get a canonical value for $\Delta$. We will call this the discriminant.

We have seen the word discriminant before, and let's make sure these concepts are more-or-less consistent.

 Recall also that the discriminant of a polynomial $f(x) = \prod (x - \alpha_i)$, then the discriminant is defined as
\[
  \disc(f) = \prod_{i \not= j}(\alpha_i - \alpha_j).
\]
If $p_\theta(x) \in K[x]$ is the minimal polynomial of $\theta$ (where $L = K[\theta]$), then
\[
  p_\theta(x) = \prod_{1}^n (x - \sigma_i(\theta))
\]
by the Galois theory result. Hence we get
\[
  \disc(p_\theta) = \prod_{i \not= j}(\sigma_i \theta - \sigma_j \theta).
\]
In other words,
\[
  \disc(p_\theta) = \Delta(1, \theta, \cdots, \theta^{n - 1}).
\]
Now back to number fields.
\begin{defi}[Integral basis]
  Let $L \supseteq \Q$ be a number field. Then a basis $\alpha_1, \cdots, \alpha_n$ of $L$ ais an \emph{integral basis} if
  \[
    \mathcal{O}_L = \left\{\sum_{i = 1}^n m_i \alpha_i: m_i \in \Z\right\} = \bigoplus_1^n \Z\alpha_i.
  \]
  In other words, it is simultaneously a basis for $L$ over $K$ and $\mathcal{O}_L$ over $\Z$.
\end{defi}
Note that integral bases are not unique, just as with usual bases. Given one basis, you can get any other by acting by $\GL_n(\Z)$.

\begin{eg}
  Consider $\Q[\sqrt{d}]$ with $d$ square-free, $d \not= 0, 1$. If $d \cong 1\pmod 4$, we've seen that $1, \frac{1}{2}(1 + \sqrt{\lambda})$ is an integral basis. Otherwise, if $d \cong 2, 3 \pmod 4$, then $1, \sqrt{d}$ is an integral basis.
\end{eg}

The important theorem is that an integral basis always exists.

\begin{thm}
  Let $\Q \subseteq L$ be a number field. Then there exists an integral basis for $\mathcal{O}_L$. In particular, $\mathcal{O}_L \cong \Z^n$ with $n = [L:\Q]$.
\end{thm}

\begin{proof}
  Let $\alpha_1, \cdots, \alpha_n$ be any basis of $L$ over $\Q$. We have proved that there is some $n_i \in \Z$ such that $n_i \alpha_i \in \mathcal{O}_L$. So wlog $\alpha_1, \cdots, \alpha_n \in \mathcal{O}_L$, and are an basis of $L$ over $\Q$. Since $\alpha_i$ are integral, so are $\alpha_i \alpha_j$, and so all these have integer trace, as we have previously shown. Hence $\Delta(\alpha_1, \cdots, \alpha_n)$, being the determinant of a matrix with integer entries, is an integer.

  Now choose a $\Q$-basis $\alpha_1, \cdots, \alpha_n \in \mathcal{O}_L$ such that $\Delta(\alpha_1, \cdots, \alpha_n) \in \Z\setminus \{0\}$ has minimal absolute value. Now let $x \in \mathcal{O}_L$. So
  \[
    x = \sum \lambda_i \alpha_i
  \]
  for some $\lambda_i \in \Q$. These $\lambda_i$ are necessarily unique since $\alpha_1, \cdots, \alpha_n$ is a basis.

  Suppose some $\lambda_i \not\in \Z$. wlog say $\lambda_1 \not \in \Z$. We write
  \[
    \lambda_1 = n_1 + \varepsilon_1,
  \]
  for $n_1 \in \Z$ and $0 < \varepsilon_1 < 1$. We put
  \[
    \alpha_1' = x - n_1 \alpha_1 = \varepsilon_1 \alpha_1 + \lambda_2 \alpha_2 + \cdots + \lambda_n \alpha_n \in \mathcal{O}_L.
  \]
  So $\alpha_1', \alpha_2, \cdots, \alpha_n$ is still a basis for $L/\Q$, and are still in $\mathcal{O}_L$. But then
  \[
    \Delta(\alpha_1', \cdots, \alpha_n) = \varepsilon_1^2 \cdot \Delta(\alpha_1, \cdots, \alpha_n) < \Delta(\alpha_1, \cdots, \alpha_n).
  \]
  This contradicts minimality. So we must have $\lambda_i \in \Z$ for all $\Z$. So this is a basis for $\mathcal{O}_L$.
\end{proof}

Now if $\alpha_1', \cdots, \alpha_n'$ is another integral basis of $L$ over $\Q$, then there is some $g \in \GL_n(\Z)$ such that $g\alpha_i = \alpha_i'$. Since $\det (g)$ is invertible in $\Z$, it must be $1$ or $-1$, and hence
\[
  \det \Delta(\alpha_1', \cdots, \alpha_n') = \det(g)^2 \Delta (\alpha_1, \cdots, \alpha_n) = \Delta(\alpha_1, \cdots, \alpha_n)
\]
and is independent of the choice of integral basis.
\begin{defi}[Discriminant]
  The \emph{discriminant} $D_L$ of a number field $L$ is defined as
  \[
    D_L = \det \Delta(\alpha_1, \cdots, \alpha_n)
  \]
  for any integral basis $\alpha_1, \cdots, \alpha_n$.
\end{defi}

\begin{eg}
  Let $L = \Q[\sqrt{d}]$, where $d \not= 0, 1$ and $d$ is square-free. If $d \cong 2, 3 \pmod 4$, then it has an integral basis $1, \sqrt{d}$. So
  \[
    D_L = \det
    \begin{pmatrix}
      1 & \sqrt{d}\\
      1 & -\sqrt{d}
    \end{pmatrix}^2 = 4d.
  \]
  Otherwise, if $d \cong 1 \pmod 4$, then
  \[
    D_L = \det
    \begin{pmatrix}
      1 & \frac{1}{2}(1 + \sqrt{d})\\
      1 & \frac{1}{2}(1 - \sqrt{d})
    \end{pmatrix}^2 = d.
  \]
\end{eg}

\section{Ideals}
Again, let $L \supseteq \Q$ be a number field.

\begin{lemma}
  Let $x \in \mathcal{O}_L$. Then $x$ is a unit if and only if $N_{L/\Q}(x) = \pm 1$.
\end{lemma}

\begin{notation}
  Write $\mathcal{O}_L^\times = \{x \in \mathcal{O}_L: x^{-1} \in \mathcal{O}_L\}$, the units in $\mathcal{O}_L$.
\end{notation}

\begin{proof}
  $(\Rightarrow)$ We know $N(a b) = N(a)N(b)$. So if $x \in \mathcal{O}_L^\times$, then there is some $y \in \mathcal{O}_L$ such that $xy = 1$. So $N(x) N(y) = 1$. So $N(x)$ is a unit in $\Z$, ie. $\pm 1$.

  $(\Leftarrow)$ Let $\sigma_1, \cdots, \sigma_n: L \to \C$ be the $n$ embeddings of $L$ in $\C$. wlog, assume $\sigma_1$ is the inclusion map. Then for each $x \in \mathcal{O}_L$, we have
  \[
    N(x) = x \sigma_2(x) \cdots \sigma_n(x).
  \]
  Now if $N(x) = \pm 1$, then $x^{-1} = \pm \sigma_2(x) \cdots \sigma_n(x)$. Then we have $x^{-1} \in \mathcal{O}_L$, since this is a product of algebraic integers. So $x$ is a unit in $\mathcal{O}_L$.
\end{proof}

Recall that an element $x \in R$ in a ring is \emph{irreducible} if it does not factor as $x = ab$ with $a, b$ not units. We say $x, y$ are \emph{associated} if $x = yu$ for a unit $u$. It follows from the previous lemma that a necessary condition for two elements to be associated is their norms have to be equal up to a sign.

\begin{eg}
  Let $L = \Q[\sqrt{5}]$. Then $\mathcal{O}_L = \Z[\sqrt{-5}]$. Then we find
  \[
    3 \cdot 7 = (1 + 2\sqrt{-5})(1 - 2\sqrt{-5}).
  \]
  These have norms $9, 49, 21, 21$. So none of $3, 7, 1 + 2\sqrt{5}$ are associates.

  Moreover, $3, 7, 1 \pm 2\sqrt{-5}$ are all irreducibles. The proofs are left as an exercise. For example, to show that $3$ is irreducible, if $3 = \alpha \beta$ for $\alpha = x + y \sqrt{-5}$, then $9 = N(3) = N(\alpha) N(\beta)$. Since none of the terms on the right are $\pm 1$, we must have $N(\alpha) = \pm 3$. But there are no solutions to
  \[
    x^2 + 5y^2 = \pm 3
  \]
  where $x, y$ are integers. So unique factorization fails.
\end{eg}

Note that it is still possible to factor any element into irreducibles, just not uniquely:

We induct on $|N(\alpha)|$. If $|N(\alpha)| = 1$, then $\alpha$ is a unit. Otherwise, $\alpha$ is either irreducible, or $\alpha = \beta \gamma$. Since $N(\beta)N(\gamma) = N(\alpha)$, we must have $|N(\beta)|, |N(\gamma)| < |N(\alpha)|$. So done by induction.

To fix this, we instead look at ideals in $\mathcal{O}_L$.

Recall that a subset $\mathfrak{a} \subseteq R$ is an ideal if it is closed under addition and $x \in R, y \in \mathfrak{a}$ implies $xy \in \mathfrak{a}$.

Now if $x_1, \cdots, x_n \in \mathcal{O}_L$, then
\[
  \bra x_1, \cdots, x_n\ket = \sum x_i \mathcal{O}_L = \left\{\sum_{i = 1}^n \alpha_i x_i : \alpha_i \in \mathcal{O}_L\right\}
\]
is the \emph{ideal generated by $x_1, \cdots, x_n$}. In particular, $\bra x\ket = x \mathcal{O}_L = \{x\alpha: \alpha \in \mathcal{O}_L\}$ is a \emph{principal ideal}. Observe that for all $a \in \mathcal{O}_L^\times$, we have $\bra x a\ket = \bra x\ket$.

The idea here is to consider multiplication of ideals, not elements. We define
\[
  \mathfrak{a} \mathfrak{b} = \left\{\sum_{i, j} \alpha_i \beta_j: \alpha_i \in \mathfrak{a}, \beta_j \in \mathfrak{b}\right\}.
\]
It is an exercise to check that this is indeed an ideal.
\begin{eg}
  We have
  \[
    \bra x_1, \cdots, x_n\ket \bra y_1, \cdots, y_m\ket = \bra x_i y_j: 1 \leq i \leq n, 1 \leq j \leq m\ket.
  \]
  In particular,
  \[
    \bra x\ket \bra y\ket = \bra xy\ket.
  \]
\end{eg}
It is also an exercise to check $(\mathfrak{a}\mathfrak{b})\mathfrak{c} = \mathfrak{a}(\mathfrak{b}\mathfrak{c})$.

\begin{eg}
  In $\Z[-5]$, we can consider the ideals
  \[
    \bra 3, 1 + \sqrt{-5}\ket \bra 3, 1 - \sqrt{-5}\ket = \bra 9, 3(1 + 2\sqrt{-5}), 3(1 - 2\sqrt{-5}), 21\ket.
  \]
  But we know $\gcd(9, 21) = 3$. So $\bra 9, 21\ket = \bra 3\ket$ by Euclid's algorithm. So this is in fact equal to $\bra 3\ket$.

  So if $\mathfrak{p}_1 = \bra 3, 1 + 2\sqrt{-5}\ket$ and $\mathfrak{p}_2 = \bra 3, 1 - 2\sqrt{-5}\ket$, then
  \[
    \mathfrak{p}_1 \mathfrak{p}_2 = \bra 3\ket.
  \]
\end{eg}
It turns out that given any ideal $\mathfrak{a}$, we can find a $\mathfrak{b}$ such that $\mathfrak{a}\mathfrak{b}$ is a principal ideal. This will in turn allow us to factorize everything into a unique product of prime ideas. For example, $\mathfrak{p}_1, \mathfrak{p}_2$ are prime ideals, as we will later see. Then this tells us in terms of ideas, $3$ can be further factorized.

\begin{defi}[Divisibility]
  We say $\mathfrak{b}$ \emph{divides} $\mathfrak{a}$ if there is some $\mathfrak{c}$ such that $\mathfrak{a} = \mathfrak{b}\mathfrak{c}$. We write $\mathfrak{b} \mid \mathfrak{a}$.
\end{defi}

\begin{eg}
  In $\Z$, we have $3\Z \mid 6\Z$ since $6\Z = 3\Z \cdot 2\Z$.
\end{eg}

Observe that we easily have $\mathfrak{b} \mathfrak{c} \subseteq \mathfrak{b}$, since $\mathfrak{b}$ is an ideal. So $\mathfrak{b} \mid \mathfrak{a}$ implies $\mathfrak{a} \subseteq \mathfrak{b}$.

There is no reason why the converse should be true. We will show that for integral rings of number fields, the converse is in fact true. Using this, we will prove that every ideal can be factorized uniquely into a product of prime ideals.

Recall that an ideal $\mathfrak{p} \subseteq R$ is \emph{prime} if $R/\mathfrak{p}$ is an integral domain, ie. for all $x, y \in R$, $xy \in \mathfrak{p}$ implies $x \in \mathfrak{p}$ or $y \in \mathfrak{p}$.

In this course, we take the convention that a prime ideal is \emph{non-zero}. This is not standard but saves us from say non-zero all the time.

\begin{prop}
  Let $L \supseteq \Q$ be a number field, and $\mathcal{O}_L$ be its ring of integers. Then
  \begin{enumerate}
    \item $\mathcal{O}_L$ is an integral domain
    \item $\mathcal{O}_L$ is a Noetherian ring
    \item $\mathcal{O}_L$ is integrally closed in $\mathrm{Frac}(\mathcal{O}_L) = L$, ie. if $x \in L$ is integral over $\mathcal{O}_L$, then $x \in \mathcal{O}_L$.
    \item Every non-zero prime ideal is maximal.
  \end{enumerate}
\end{prop}
The first three parts are just bookkeeping and not too interesting. The last one is what we really want. This says that $\mathcal{O}_L$ is ``one dimensional'', if you know enough algebraic geometry.

A ring with all these properties is called a \emph{Dedekind domain}.

\begin{proof}\leavevmode
  \begin{enumerate}
    \item Obvious, since $\mathcal{O}_L \subseteq L$.
    \item We showed that as an abelian group $\mathcal{O}_L = \Z^n$. So if $\mathfrak{a} \leq \mathcal{O}_L$ is an ideal, then $\mathfrak{a} \leq \Z^n$ as a subgroup. So it is finitely generated as an abelian group, and hence finitely generated as an ideal.
    \item If $x \in L$ is integral over $\mathcal{O}_L$, as $\mathcal{O}_L$ is integral over $\Z$, $x$ is also integral over $\Z$. So $x \in \mathcal{O}_L$, by definition of $\mathcal{O}_L$.
    \item This is what really needs a proof. We first need a lemma.
  \end{enumerate}
\end{proof}

\begin{lemma}
  Let $\mathfrak{a}\lhd \mathcal{O}_L$ be a non-zero ideal. Then $\mathfrak{a} \cap \Z \not= \{0\}$ and $\mathcal{O}_L/\mathfrak{a}$ is finite.
\end{lemma}

\begin{proof}
  Let $\alpha \in \mathfrak{a}$ and $\alpha \not= 0$. Let
  \[
    p_a = x^m + a_{m - 1}x^{m - 1} + \cdots + a_0
  \]
  be its minimal polynomial. Then $p_\alpha \in \Z[x]$. We know $a_0 \not= 0$ as $p_\alpha$ is irreducible.

  Since $p(\alpha) = 0$, we know
  \[
    a_0 = -\alpha(\alpha^{m - 1} + a_{m - 1} \alpha^{m - 2} + \cdots + a_2 \alpha + a_1).
  \]
  We know $\alpha \in \mathfrak{a}$ by assumption, and the mess in the brackets is in $\mathcal{O}_L$. So the whole thing is in $\mathfrak{a}$. But $a_0 \in \Z$. So $a_0 \in \Z \cap \mathfrak{a}$.

  We know $a_0 \mathcal{O}_L \subseteq \mathfrak{a}$. Hence there is a surjection
  \[
    \frac{\mathcal{O}_L}{\bra a_0\ket} \rightarrow \frac{\mathcal{O}_L}{\mathfrak{a}}.
  \]
  Hence it suffices to show that $\mathcal{O}_L/\bra a_0\ket$ is finite. But for every $d \in \Z$, we know
  \[
    \frac{\mathcal{O}_L}{\bra d\ket} = \frac{\Z^n}{d\Z^n} = \left(\frac{\Z}{d\Z}\right)^n,
  \]
  which is finite.
\end{proof}

Finally, recall that a finite integral domain must be a field --- let $x \in R$ with $x \not= 0$. Then $m_x: y \mapsto xy$ is injective, as $R$ is an integral domain. So it is a bijection, as $R$ is finite. So there is some $y \in R$ such that $xy = 1$.

This allows us to prove the last part
\begin{proof}(of (iv))
  Let $\mathfrak{p}$ be a prime ideal. Then $\mathcal{O}_L/\mathfrak{p}$ is an integral domain. Since the lemma says $\mathcal{O}_L/\mathfrak{p}$ is finite, we know $\mathcal{O}_L/\mathfrak{p}$ is a field. So $\mathfrak{p}$ is maximal.
\end{proof}

We also define the following;
\begin{defi}[Addition of ideals]
  Let $\mathfrak{a}, \mathfrak{b}$ be ideas of $R$. Then
  \[
    \mathfrak{a} + \mathfrak{b} = \{a + b: a \in \mathfrak{a}, b \in \mathfrak{b}\}
  \]
  is an ideal.
\end{defi}

\begin{lemma}
  Let $\mathfrak{p}$ be a prime ideal in a ring $R$. Then for $\mathfrak{a}, \mathfrak{b}\lhd R$ ideals, then $\mathfrak{a}\mathfrak{b} \subseteq \mathfrak{p}$ implies $\mathfrak{a} \subseteq \mathfrak{p}$ or $\mathfrak{b}\subseteq \mathfrak{p}$.
\end{lemma}
Once we've shown that inclusion of ideals is equivalent to divisibility, this in effect says ``prime ideals are primes''.

\begin{proof}
  If not, then there is some $a \in \mathfrak{a}\setminus \mathfrak{p}$ and $b \in \mathfrak{b}\setminus \mathfrak{p}$. Then $ab \in \mathfrak{a}\mathfrak{b} \subseteq \mathfrak{p}$. But then $a \in \mathfrak{p}$ or $b \in \mathfrak{p}$. Contradiction.
\end{proof}

\begin{lemma}
  Let $0 \not= \mathfrak{a} \lhd \mathcal{O}_L$ a non-zero ideal. Then there is a subset of $\mathfrak{a}$ that is a product of prime ideals.
\end{lemma}

\begin{proof}
  Suppose not. Then as $\mathcal{O}_L$ is Noetherian (ie. every ascending chain of ideals is eventually stationary), there exists a maximal ideal $\mathfrak{a}$ not containing a product of prime ideals (by which I mean any ideal greater than $\mathfrak{a}$ contains a product of prime ideals, \emph{not} that $\mathfrak{a}$ is itself a maximal ideal). In particular, $\mathfrak{a}$ is not prime. So there are some $x,y \in \mathcal{O}_L$ such that $x, y \not\in \mathfrak{a}$ but $xy \in \mathfrak{a}$.

  Consider $\mathfrak{a} + \bra x\ket$. This is an ideal, strictly bigger than $\mathfrak{a}$. So there exists prime ideasl $\mathfrak{p}_1, \cdots, \mathfrak{p}_r$ such that $\mathfrak{p}_1\cdots \mathfrak{p}_r \subseteq \mathfrak{a} + \bra x\ket$, by definition.

  Similarly, there exists $\mathfrak{q}_1, \cdots\mathfrak{q}_s$ such that $\mathfrak{q}_1 \cdots \mathfrak{q}_s \subseteq \mathfrak{a} + \bra y\ket$.

  But then
  \[
    \mathfrak{p}_1\cdots\mathfrak{p}_r \mathfrak{q}_1\cdots\mathfrak{q}_s \subseteq (\mathfrak{a} + \bra x\ket)(\mathfrak{a} + \bra y\ket) \subseteq \mathfrak{a} + \bra xy\ket = \mathfrak{a}
  \]
  So $\mathfrak{a}$ contains a product of prime ideals. Contradiction.
\end{proof}
For integers, it was obvious that everything can be factored as a product of prime. It is not entirely obvious that every ideal can be factored as a product of prime ideals. But through this nonsense proof, we have at least shown that every ideal contains something that can be factored as a product of primes.

Recall that for integers, we can multiply, but not divide. To make life easier, we would like to formally add inverses to the elements. If we do so, we obtain things like $\frac{1}{3}$, and obtain the rationals.

Now we have ideals. What can we do? We can \emph{formally} add some inverse and impose some nonsense rules to make sure it is consistent, but it is helpful to actually construct something explicitly that acts as an inverse. We can then understand what significance these inverses have in terms of the rings.

\begin{prop}\leavevmode
  \begin{enumerate}
    \item Let $0 \not= \mathfrak{a} \lhd \mathcal{O}_L$ be an ideal. If $x \in L$ has $x\mathfrak{a} \subseteq \mathfrak{a}$, then $x \in \mathcal{O}_L$.
    \item Let $0 \not= \mathfrak{a} \lhd \mathcal{O}_L$ be a \emph{proper} ideal. Then
      \[
        \{y \in L: y \mathfrak{a} \subseteq \mathcal{O}_L\}
      \]
      contains elements elements that are not in $\mathcal{O}_L$. In other words,
      \[
        \frac{\{y \in K: y \mathfrak{a} \leq \mathcal{O}_L\}}{\mathcal{O}_L} \not = 0.
      \]
  \end{enumerate}
\end{prop}
We will see that the object $\{y \in K: y \mathfrak{a} \leq \mathcal{O}_L\}$ is in some sense an inverse to $\mathfrak{a}$.

Before we prove this, it is helpful to see what this means in a concrete setting.
\begin{eg}
  Consider $\mathcal{O}_L = \Z$ and $\mathfrak{a} = 3\Z$. Then the first part says if $\frac{a}{b} \cdot 3\Z \subseteq 3\Z$, then $\frac{a}{b} \in \Z$. The second says
  \[
    \left\{\frac{a}{b}: \frac{a}{b}\cdot 3 \in \Z\right\}
  \]
  contains something not in $\Z$, say $\frac{1}{3}$.
\end{eg}

\begin{proof}\leavevmode
  \begin{enumerate}
    \item Let $\mathfrak{a} \subseteq \mathcal{O}_L = \Z^n$, as an abelian group. So $\mathfrak{a}$ is a finitely generated abelian group. Let $\alpha_1, \cdots, \alpha_m$ be a basis of $\mathfrak{a}$ over $\Z$. We consider the multiplication-by-$x$ map $m_x: \mathfrak{a} \to \mathfrak{a}$, ie. write
      \[
        x\alpha_i = \sum a_{ij} \alpha_j,
      \]
      and let $A = (a_{ij})$. So we know
      \[
        (xI - A)
        \begin{pmatrix}
          \alpha_1\\\vdots\\ \alpha_n
        \end{pmatrix}
        = 0.
      \]
      So $xI - A$ is not invertible. So $\det(xI - A) = 0$. So $x$ satisfies a polynomial with coefficients in $\Z$, ie. $x \in \mathcal{O}_L$.
    \item If the result is true for $\mathfrak{a}$, then it is true for all $\mathfrak{a}' \subseteq \mathfrak{a}$, which is obvious from definition. So it is enough to prove this for $\mathfrak{a} = \mathfrak{p}$, a maximal, and in particular prime, ideal.

      Let $\alpha \in \mathfrak{p}$ be non-zero. By the previous lemma, there exists prime ideals $\mathfrak{p}_1, \cdots, \mathfrak{p}_r$ such that $\mathfrak{p}_1 \cdots \mathfrak{p}_r \subseteq \bra \alpha\ket$. We also have that $\bra \alpha\ket \subseteq \mathfrak{p}$ by definition. Assume $r$ is minimal with this property. Since $\mathfrak{p}$ is prime, there is some $i$ such that $\mathfrak{p}_i \subseteq \mathfrak{p}$. wlog, we may as well assume $i = 1$, ie. $\mathfrak{p}_i \subseteq \mathfrak{p}$. But $\mathfrak{p}_1$ is a prime ideal, and hence maximal. So $\mathfrak{p}_1 = \mathfrak{p}$. But now $r$ is minimal. So $\mathfrak{p}_2 \cdots \mathfrak{p}_r \not\subseteq \bra a\ket$.

      Pick $\beta \in \mathfrak{p}_2 \cdots \mathfrak{p}_r \setminus \bra a\ket$. Then
      \[
        \beta \mathfrak{p}_1 \subseteq \mathfrak{p}_1 \mathfrak{p}_2 \cdots \mathfrak{p}_r \subseteq \bra \alpha\ket.
      \]
      Dividing by $\alpha$, we get $\frac{\beta}{\alpha}\mathfrak{p} \subseteq \mathcal{O}_L$. But $\beta \not\in \bra \alpha\ket$. So we know $\frac{\beta}{\alpha} \not\in \mathcal{O}_L$. So done.
  \end{enumerate}
\end{proof}
What is this
\[
  \frac{\{x \in K: x \mathfrak{a} \leq \mathcal{O}_L\}}{\mathcal{O}_L}?
\]
This is not an ideal, but it almost is. The only way in which it fails to be an ideal is that it is not contained inside $\mathcal{O}_L$. By this we mean it is closed under addition and multiplication by elements in $\mathcal{O}_L$. So it is an $\mathcal{O}_L$ module, which is finitely generated (we will see this in a second), and a subset of $L$. We call this a ``fractional ideal''.

\begin{defi}[Fractional ideal]
  A \emph{fractional ideal} of $\mathcal{O}_L$ is a subset of $L$ that is also an $\mathcal{O}_L$ module and is finitely generated.
\end{defi}

\begin{lemma}
  An $\mathcal{O}_L$ module $\mathfrak{q} \subseteq L$ is a fractional ideal if and only if there is some $c \in L$ such that $c\mathfrak{q}$ is an ideal in $\mathcal{O}_L$.
\end{lemma}

\begin{proof}
  $(\Leftarrow)$ We have to prove that $\mathfrak{q}$ is finitely generated. If $\mathfrak{q} \subseteq L$, $c \in L$ non-zero, then $c\mathfrak{q} \cong \mathfrak{q}$ as an $\mathcal{O}_L$ module. So if $c\mathfrak{q} \lhd \mathcal{O}_L$ is an ideal, and $\mathcal{O}_L \cong \Z^n$ as an abelian group, we know $\mathfrak{q} \cong c\mathfrak{q} \cong \Z^m$ for some $m$ and is hence finitely-generated.

  $(\Rightarrow)$ Suppose $x_1, \cdots, x_n$ generate $\mathfrak{q}$ as an $\mathcal{O}_L$-module. Write $x_i = \frac{y_i}{n_i}$, with $y_i \in \mathcal{O}_L$ and $n_i \in \Z$, $n_i \not= 0$, which we have previously shown is possible.

  We let $c = \lcm(n_1, \cdots, n_k)$. Then $c\mathfrak{q} \subseteq \mathcal{O}_L$, and is an $\mathcal{O}_L$-submodule of $\mathcal{O}_L$, ie. an ideal.
\end{proof}

\begin{cor}
  Let $\mathfrak{q}$ be a fractional ideal. Then as an abelian group, $\mathfrak{q} \cong \Z^n$, where $n = [L:\Q]$.
\end{cor}

\begin{proof}
  There is some $c \in L^\times$ such that $c\mathfrak{q} \lhd \mathcal{O}_L$ as an ideal. Recall that when we proved that for any ideal $\mathfrak{a} \lhd \mathcal{O}_L$, $\mathcal{O}_L/\mathfrak{a}$ is finite, we must have $\mathfrak{a} \cong \Z^n$ as an abelian group. So the result follows since $c\mathfrak{q}\cong \mathfrak{q}$ as abelian groups.
\end{proof}

\begin{defi}[Integral/honest ideal]
  If we want to emphasize that $\mathfrak{a} \lhd \mathcal{O}_L$ is an ideal, we say it is an \emph{integral or honest ideal}. But we never use ``ideal'' to mean fractional ideal.
\end{defi}

Finally, we can state the proposition we want to prove, after all that nonsense work.

\begin{defi}[Invertible fractional ideal]
  A fractional ideal $\mathfrak{q}$ is \emph{invertible} if there exists a fractional ideal $\mathfrak{r}$ such that $\mathfrak{q}\mathfrak{r} = \mathcal{O}_L = \bra 1\ket$.
\end{defi}
Notice we can multiply fractional ideals using the same definition as for integral ideals.

\begin{prop}
  Every non-zero fractional ideal is invertible. The inverse of $\mathfrak{q}$ is
  \[
    \{x \in L: x\mathfrak{q} \subseteq \mathcal{O}_L\}.
  \]
\end{prop}
This is good.

Remark that if $\mathfrak{q} = \frac{1}{n} \mathfrak{a}$ and $\mathfrak{r} = \frac{1}{m} \mathfrak{b}$, and $\mathfrak{a}, \mathfrak{b} \lhd \mathcal{O}_L$ are integral ideals, then
\[
  \mathfrak{q} \mathfrak{r} = \frac{1}{mn} \mathfrak{a}\mathfrak{b} \lhd \mathcal{O}_L
\]
if and only if $\mathfrak{a}\mathfrak{b} = \bra mn\ket$. So the proposition is equivalent to the statement that for every $\mathfrak{a} \lhd \mathcal{O}_L$, there exists an ideal $\mathfrak{b} \lhd \mathcal{O}_L$ such that $\mathfrak{a}\mathfrak{b}$ is principal.

As a consequence of this, we can immediately prove that $\mathfrak{b} \mid \mathfrak{a}$ if \emph{and only if} $\mathfrak{a} \subseteq \mathfrak{b}$.

\begin{proof}
  We know $\mathfrak{q}$ is invertible if and only if $n\mathfrak{q}$ is invertible for some $n \in \Z$, $n \not= 0$. So if the proposition is false, there is an integral ideal $\mathfrak{a} \lhd \mathcal{O}_L$ which is not invertible. Moreover, as $\mathcal{O}_L$ is Noetherian, we can assume $\mathfrak{a}$ is maximal with this property, ie. if $\mathfrak{a} < \mathfrak{a}' < \mathcal{O}_L$, then $\mathfrak{a}'$ is invertible.

  Let $\mathfrak{b} = \{x \in L: x \mathfrak{a} \subseteq \mathcal{O}_L\}$, a fractional ideal.

  Then $\mathcal{O}_L \subseteq \mathfrak{b}$, and so $\mathfrak{a} \subseteq \mathfrak{a} \mathfrak{b}$.

  If $\mathfrak{a} = \mathfrak{a}\mathfrak{b}$, then by (i) of our previous proposition, $\mathfrak{b} \subseteq \mathcal{O}_L$. But then by (ii) of the same proposition, we also know there is some $x \in \mathfrak{b} \setminus \mathcal{O}_L$, contradicting $\mathfrak{b} \subseteq \mathcal{O}_L$.

  So $\mathfrak{a} < \mathfrak{a} \mathfrak{b}$. Since $\mathfrak{a}$ is not invertible, we must have strict inequalities $\mathfrak{a} < \mathfrak{a}\mathfrak{b} < \mathcal{O}_L$. But then by definition of $\mathfrak{a}$, $\mathfrak{a}\mathfrak{b}$ is invertible, which implies $\mathfrak{a}$ is invertible (if $\mathfrak{c}$ is an inverse of $\mathfrak{a}\mathfrak{b}$, then $\mathfrak{b}\mathfrak{c}$ is an inverse of $\mathfrak{a}$). This is a contradiction. So all
  fractional ideals must be invertible.

  Finally, we have to show that the formula for the inverse holds. By definition, $\mathfrak{q}^{-1} \subseteq \{x \in L: x\mathfrak{q} \subseteq \mathcal{O}_L \} = \mathfrak{c}$, say. So
  \[
    \mathcal{O}_L = \mathfrak{q}\mathfrak{q}^{-1}\subseteq \mathfrak{q} \mathfrak{c} \subseteq \mathcal{O}_L.
  \]
  Hence we must have $\mathfrak{q}\mathfrak{c} = \mathcal{O}_L$, ie. $\mathfrak{c} = \mathfrak{q}^{-1}$.
\end{proof}
Note that while we have technically proved everything in the course, it is just technical. Behind each of these propositions, there are a lot of ideas lurking around, which we do not have time to fully explore. As such, it is difficult to understand what is going on, or where these concepts came from. To obtain a thorough understanding, we will need to learn more things from other courses, such as IID Algebraic Geometry and III Commutative Algebra. Without those, these look just like algebraic nonsense.

\begin{cor}
  Let $\mathfrak{a}, \mathfrak{b}, \mathfrak{c}\lhd \mathcal{O}_L$ be ideals, $\mathfrak{c} \not= 0$. Then
  \begin{enumerate}
    \item $\mathfrak{b} \subseteq \mathfrak{a}$ if and only if $\mathfrak{b}\mathfrak{c} \subseteq \mathfrak{a}\mathfrak{c}$
    \item $\mathfrak{a} \mid \mathfrak{b}$ if and only if $\mathfrak{a} \mathfrak{c} \mid \mathfrak{b}\mathfrak{c}$
    \item $\mathfrak{a} \mid \mathfrak{b}$ if and only if $\mathfrak{b} \subseteq \mathfrak{a}$.
  \end{enumerate}
\end{cor}

\begin{proof}\leavevmode
  \begin{enumerate}
    \item $(\Rightarrow)$ is clear, and $(\Leftarrow)$ is obtained by multiplying with $\mathfrak{c}^{-1}$.
    \item $(\Rightarrow)$ is clear, and $(\Leftarrow)$ is obtained by multiplying with $\mathfrak{c}^{-1}$.
    \item $(\Rightarrow)$ is clear. So suppose $\mathfrak{b} \subseteq \mathfrak{a}$. By the proposition, there exists an ideal $\mathfrak{c} \lhd \mathcal{O}_L$ such that $\mathfrak{a}\mathfrak{c} = \bra \alpha\ket$ is principal with $\alpha \in \mathcal{O}_L, \alpha \not= 0$. Then $\mathfrak{b}\subseteq \mathfrak{a}$ if and only if $\mathfrak{b}\mathfrak{c} \subseteq \bra \alpha\ket$ by (i); and $\mathfrak{a} \mid \mathfrak{b}$ if and only if $\bra \alpha\ket \mid \mathfrak{b}\mathfrak{c}$ by (ii).

      But now if $\mathfrak{b}\mathfrak{c} = \bra \beta_1, \cdots, \beta_r\ket$, then $\mathfrak{b}\mathfrak{c} \subseteq \bra \alpha\ket$ means there are some $\beta_a', \cdots, \beta_r' \in \mathcal{O}_L$ such that $\beta_i = \beta_i' \alpha$. But this says
      \[
        \bra \beta_a, \cdots, \beta_r\ket = \bra \beta_1', \cdots, \beta_r' \ket \bra \alpha\ket,
      \]
      thus proving (iii).
  \end{enumerate}
\end{proof}
The idea of the proof is that (iii) is clear if $\mathfrak{a}$ is principal, and then we use the previous proposition to reduce everything to this case.

\begin{thm}
  Let $\mathfrak{a} \lhd \mathcal{O}_L$ be an ideal, $\mathfrak{a} \not= 0$. Then $\mathfrak{a}$ can be written uniquely as a product of prime ideals.
\end{thm}

\begin{proof}
  To show existence, if $\mathfrak{a}$ is prime, then there is nothing to do. Otherwise, if $\mathfrak{a}$ is not prime, then it is not maximal. So there is some $\mathfrak{b} \supsetneq \mathfrak{a}$ with $\mathfrak{b} \lhd \mathcal{O}_L$. Hence $\mathfrak{b} \mid \mathfrak{a}$, ie. there is some $\mathfrak{c} \lhd \mathcal{O}_L$ with $\mathfrak{a} = \mathfrak{b} \mathfrak{c}$, and $\mathfrak{c} \supseteq \mathfrak{a}$. We can continue factoring this wawy, and it must stop eventually, or else we have an infinite chain of strictly ascending ideals.

  To show uniqueness, we have shown $\mathfrak{p} \mid \mathfrak{a}\mathfrak{b}$ implies $\mathfrak{p} \mid \mathfrak{a}$ or $\mathfrak{p} \mid \mathfrak{b}$. So if $\mathfrak{p}_1 \cdots \mathfrak{p}_r = \mathfrak{q}_1 \cdots \mathfrak{q}_s$, with $\mathfrak{p}_i, \mathfrak{q}_j$ prime, then we know $\mathfrak{p}_1 \mid \mathfrak{q}_1 \cdots \mathfrak{q}_s$, which implies $\mathfrak{p}_1 \mid \mathfrak{q}_i$ for some $i$, and wlog $i = 1$. So $\mathfrak{q}_1 \subseteq \mathfrak{p}_1$. But $\mathfrak{q}_1$ is prime and hence maximal. So $\mathfrak{p}_1 = \mathfrak{q}_1$.

  Multiply the equation $\mathfrak{p}_1 \cdots \mathfrak{p}_r = \mathfrak{q}_1 \cdots \mathfrak{q}_s$ by $\mathfrak{p}_1^{-1}$, and we get $\mathfrak{p}_2 \cdots \mathfrak{p}_r = \mathfrak{q}_2 \cdots \mathfrak{q}_s$. Repeat, and we get $r = s$ and $\mathfrak{p}_i = \mathfrak{q}_i$ for all $i$ (after renumbering).
\end{proof}

\begin{cor}
  The non-zero fractional ideals form a group under the multiplcation map. We denote this $I_L$. This is a free abelian group generated by the prime ideals, ie. any fractional ideal $\mathfrak{q}$ can be written uniquely as $\mathfrak{p}_1^{a_1} \cdots \mathfrak{p}_r^{q_r}$, with $\mathfrak{p}_i$ distinct prime ideals and $a_i \in \Z$.

  Moreover, if $\mathfrak{q}$ is an integral ideal, ie. $\mathfrak{q} \lhd \mathcal{O}_L$, then $a_i, \cdots, a_r \geq 0$.
\end{cor}

\begin{proof}
  We already have unique factorization of honest ideals. Now take any fractional ideal, and write it as $\mathfrak{q} = \mathfrak{a} \mathfrak{b}^{-1}$, with $\mathfrak{a}, \mathfrak{b} \in \mathcal{O}_L$, and the result follows.
\end{proof}
Notice that if $\mathfrak{a}, \mathfrak{b} \in \mathcal{O}_L$ are ideals, then $\mathfrak{a} + \mathfrak{b} = \{a + b: a \in \mathfrak{a}, b \in \mathfrak{b}\}$ is an ideal containing $\mathfrak{a}$ and $\mathfrak{b}$, and the smallest such. So $\mathfrak{a} + \mathfrak{b}$ is the ``greatest common divisor'' of $\mathfrak{a}$ and $\mathfrak{b}$ in $I_L$. This is not particularly important --- it is just for amusement.

\begin{eg}
  Let $[L:\Q] = 2$, ie. $L = \Q(\sqrt{d})$ with $d \not= 0, 1$ and square-free (this is the only example we have so far, really).

  While we proved that every ideal can be factorized into prime ideals, we have completely no idea what prime ideals look like. We just used their very abstract properties like being prime and maximal. So we would like to play with some actual ideals.

  Recall we had the example
  \[
    \bra 3, 1 + 2\sqrt{-5}\ket \bra 3, 1 - 2\sqrt{-5}\ket = \bra 3\ket.
  \]
  This is an example where we multiply two ideals together to get a principal ideal, and the key to this working is that $1 + 2\sqrt{-5}$ is conjugate to $1 - 2\sqrt{-5}$. We will use this idea to prove the previous result for number fields of this form.

  Let $\mathfrak{a} \lhd \mathcal{O}_L$ be an ideal. As $\mathcal{O}_L \cong \Z^2$, we know $\mathfrak{a} \leq \mathcal{O}_L$ as a subgroup. So it is generated by either $1$ or $2$ elements as subgroups of $\Z^2$, ie. $\mathfrak{a} = \bra \alpha\ket$ or $\mathfrak{a} = \bra \alpha, \beta\ket$ for some $\alpha, \beta \in \mathcal{O}_L$.

  We can also insist that $\beta \in \Z$. We can deduce this from the fact that $\mathcal{O}_L \cap \Z \not= \{0\}$ (exercise). Alternatively, we can just do it. We write $\alpha = a + b \sqrt{d}$ and $\beta = a' + b' \sqrt{d}$. Then let $\ell = \gcd(b, b') = mb + m' b'$, with $m, m' \in \Z$ (by Euclid's algorithm). We set
  \[
    \beta' = (m\alpha + m'\beta) \cdot \frac{-b'}{\ell} + \beta = \frac{-b'}{\ell}(m + m')a\in \Z,
  \]
  noting that $-\frac{b'}{\ell} \in \Z$. Then $\bra \alpha, \beta'\ket = \bra \alpha, \beta\ket$.

  We now claim $\bra b, \alpha\ket \bra b, \bar{\alpha}\ket$ is principal (where $\alpha = x +y \sqrt{d}$, $\bar{\alpha} = x - y \sqrt{d}$). In particular, if $\mathfrak{a} \lhd \mathcal{O}_L$, then $\mathfrak{a} \bar{\mathfrak{a}}$ is principal, so the proposition is proved by hand.

  To show this, we can manually check
  \begin{align*}
    \bra b, \alpha\ket \bra b, \bar{\alpha}\ket &= \bra b^2, b\alpha, b\bar{\alpha}, N(\alpha) = \alpha\bar{\alpha}\ket\\
    &= \bra b^2, b\alpha, b\tr(\alpha) = b(\alpha + \bar{\alpha}), N(\alpha)\ket\\
    \intertext{Now note that $b^2, b\tr(\alpha)$ and $N(\alpha)$ are all integers. So let $c = \gcd(b^2, b\tr(\alpha), N(\alpha))$. So this ideal is equal to}
    &= \bra c, b\alpha\ket.
  \end{align*}
  But if we write $b\alpha = cx$, with $x \in L$, then $\tr x = \frac{b}{c} \tr \alpha \in \Z$, and
  \[
    N(x) = N\left(\frac{b\alpha}{c}\right) = \frac{b^2 N(\alpha)}{c^2} = \frac{b^2}{c} \frac{N(\alpha)}{c} \in \Z.
  \]
  So $x \in \mathcal{O}_L$. So $c \mid b\alpha$ in $\mathcal{O}_L$. So $\bra c, b\alpha\ket = \bra c\ket$.
\end{eg}
More definitions, and then maybe we can get to say what the main point of the course is.

Observe there is a map $L^* \to I_L$, which sends $\alpha \mapsto \bra \alpha\ket$. This is a group homomorphism, ie. $\bra \alpha\beta\ket = \bra \alpha\ket \bra \beta\ket$. Moreover, $\alpha$ is in the kernel if and only if $\bra \alpha\ket = \bra 1\ket = \bra \mathcal{O}_L\ket$, ie. $\alpha$ is a unit in $\mathcal{O}_L$. On the other hand, the image is the set of all principal fractional ideals. We denote this subgroup of principal fractional ideals by $P_L$. The definition we want is the following:

\begin{defi}[Class group]
  The \emph{class group} of a number field $L$ is
  \[
    \cl_L = I_L/P_L.
  \]
\end{defi}
So if $\mathfrak{a} \in I_L$, we write $[\mathfrak{a}]$ for its equivalence class in $\cl_L$. So $[\mathfrak{a}] = [\mathfrak{b}]$ if and only if there is some $\gamma\in L^\times$ such that $\gamma \mathfrak{a} = \mathfrak{b}$.

\begin{thm}
  The following are equivalent:
  \begin{enumerate}
    \item $\mathcal{O}_L$ is a principal ideal domain
    \item $\mathcal{O}_L$ is a unique factorization domain
    \item $\cl_L$ is trivial.
  \end{enumerate}
\end{thm}
So this $\cl_L$ measures the failure of unique factorization.
\begin{proof}
  (i) and (iii) are equivalent by definition, while (i) implies (ii) is well-known from IB Groups, Rings and Modules. So the real content is (ii) to (i), which is specific to Dedekind domains.

  If $\mathfrak{p} \lhd \mathcal{O}_L$ is prime, and $x \in \mathfrak{p} \setminus \{0\}$, we factor $x = \alpha_1 \cdots \alpha_k$ such that $\alpha_i$ is irreducible in $\mathcal{O}_L$. As $\mathfrak{p}$ is prime, there is some $\alpha_i \in \mathfrak{p}$. But then $\bra \alpha_i\ket \subseteq \mathfrak{p}$, and $\bra \alpha_i\ket$ is prime as $\mathcal{O}_L$ is a UFD. So we must have $\bra \alpha_i\ket = \mathfrak{p}$ as prime ideals are maximal. So $\mathfrak{p}$ is principal.
\end{proof}

\subsection{Norms of ideals, structure of prime ideals}
Recall we had the notion of the norm of an element. It would be great if we had a norm for ideals as well.
\begin{defi}[Norm of ideal]
  Let $\mathfrak{a} \lhd \mathcal{O}_L$ be an ideal. We define
  \[
    |N(\mathfrak{a})| = |\mathcal{O}_L/\mathfrak{a}| \in \N.
  \]
\end{defi}
Recall that we've already proved that $|\mathcal{O}_L/\mathfrak{a}|$ is finite.

\begin{eg}
  Let $d \in \Z$. Then
  \[
    N(\bra d\ket) = |\Z^n/(d\Z)^n| = |\Z/d\Z|^n = d^n,
  \]
  as $\mathcal{O}_L\cong \Z^n$, so $d\mathcal{O}_L = d\Z^n$.
\end{eg}
Also note that $N(\mathfrak{a}) \in \mathfrak{a} \cap \Z$, since viewing $\mathcal{O}_L/\mathfrak{a}$ as a group, the order of $1$ is a factor of $N(\mathfrak{a})$. So $N(\mathfrak{a}) = N(\mathfrak{a}) \cdot 1 = 0 \in \mathcal{O}_L/\mathfrak{a}$. Hence $N(\mathfrak{a}) \in \mathfrak{a}$.

An important property of the norm is the following:
\begin{prop}
  Let $\mathfrak{a}, \mathfrak{b} \lhd \mathcal{O}_L$ be ideals. Then $N(\mathfrak{a} \mathfrak{b}) = N(\mathfrak{a})N(\mathfrak{b})$.
\end{prop}

Here is a proof that makes no sense:
\begin{proof}
  By the factorization into prime ideals, it suffices to prove this for $\mathfrak{b} = \mathfrak{p}$ prime, ie.
  \[
    N(\mathfrak{a}\mathfrak{p}) = N(\mathfrak{a}) N(\mathfrak{p}).
  \]
  By unique factorization, $\mathfrak{a} \not= \mathfrak{a} \mathfrak{p}$. So there exists some $\alpha \in \mathfrak{a} \setminus \mathfrak{a} \mathfrak{p}$.

  We now claim that the homomorphism of abelian groups
  \begin{align*}
    \frac{\mathcal{O}_L}{\mathfrak{p}} &\to \frac{\mathfrak{a}}{\mathfrak{a}\mathfrak{p}}\\
    x &\mapsto \alpha x
  \end{align*}
  is an isomorphism, and hence $|\mathfrak{a}/\mathfrak{a}\mathfrak{p}| = |\mathcal{O}_L/\mathfrak{p}| = N(\mathfrak{p})$.

  To prove this claim, we have to show injectivity and surjectivity. To show injectivity, since $\bra \alpha\ket \subseteq \mathfrak{a}$, we have $\mathfrak{a} \mid \bra a\ket$, ie. there is an ideal $\mathfrak{c} \subseteq \mathcal{O}_L$ such that $\mathfrak{a}\mathfrak{c} = \bra \alpha\ket$. If $x \in \mathcal{O}_L$ is in the kernel of the map, then $\alpha x \in \mathfrak{a}\mathfrak{p}$. So
  \[
    x \mathfrak{a}\mathfrak{c} \subseteq \mathfrak{a}\mathfrak{p}.
  \]
  So
  \[
    x\mathfrak{c} \subseteq \mathfrak{p}.
  \]
  As $\mathfrak{p}$ is prime, either $\mathfrak{c} \subseteq \mathfrak{p}$ or $x \in \mathfrak{p}$. But $\mathfrak{c} \subseteq \mathfrak{p}$ implies $\bra \alpha\ket \in \mathfrak{a}\mathfrak{p}$, contradicting the choice of $\alpha$. So we must have $x \in \mathfrak{p}$, and the map is injective.

  To show this is surjective, we know $\mathfrak{a}\mathfrak{p} < \mathfrak{a}\mathfrak{p} + \bra \alpha\ket \subseteq \mathfrak{a}$. We now multiply by $\mathfrak{a}^{-1}$ to obtain
  \[
    \mathfrak{p} < (\mathfrak{a} \mathfrak{p} + \bra \alpha\ket) \mathfrak{a}^{-1} \subseteq \mathcal{O}_L.
  \]
  Since $\mathfrak{p}$ is a prime, and hence maximal ideal, and $(\mathfrak{a} \mathfrak{p} + \bra \alpha\ket) \mathfrak{a}^{-1}$ is an ideal (since $\mathfrak{a} \mid \bra \alpha\ket$), the last inclusion must be an equality. So $\mathfrak{a}\mathfrak{p} + \bra\alpha\ket = \mathfrak{a}$. So it is surjective.

  Now note that
  \[
    \frac{\mathcal{O}_L}{\mathfrak{a}} \cong \left(\frac{\mathcal{O}_L}{\mathfrak{a}\mathfrak{p}}\right) \big/ \left(\frac{\mathfrak{a}}{\mathfrak{a}\mathfrak{p}}\right),
  \]
  by the isomorphism theorems. So
  \[
    \left|\frac{\mathcal{O}_L}{\mathfrak{a}}\right| = \frac{|\mathcal{O}_L/\mathfrak{a}\mathfrak{p}|}{|\mathcal{O}_L/\mathfrak{p}|}.
  \]
  Then this gives
  \[
    N(\mathfrak{a}) = N(\mathfrak{a}\mathfrak{p}) / N(\mathfrak{p}).
  \]
\end{proof}
Now we provide a (sketch of a) proof that makes sense. The details are left as an exercise in the second example sheet.
\begin{proof}
  It is enough to show that $N(\mathfrak{p}_1^{a_1} \cdots \mathfrak{p}_r^{a_r}) = N(\mathfrak{p}_1)^{a_1} \cdots N(\mathfrak{p}_r)^{a_r}$ by unique factorization.

  By the Chinese remainder theorem, we have
  \[
    \frac{\mathcal{O}_L}{\mathfrak{p}_1^{a_1} \cdots \mathfrak{p}_r^{a_r}} \cong \frac{\mathcal{O}_L}{\mathfrak{p}_1^{a_1}} \times \cdots \times \frac{\mathcal{O}_L}{\mathfrak{p}_r^{a_r}}
  \]
  where $\mathfrak{p}_1, \cdots, \mathfrak{p}_r$ are distinct prime ideals.

  Next, we show by hand that
  \[
    \left|\frac{\mathcal{O}_L}{\mathfrak{p}^r}\right| = \left|\frac{\mathcal{O}_L}{\mathfrak{p}}\right| \times \left|\frac{\mathfrak{p}}{\mathfrak{p}^2}\right| \times \cdots \times \left|\frac{\mathfrak{p}^{r - 1}}{\mathfrak{p}^r}\right| = \left|\frac{\mathcal{O}_L}{\mathfrak{p}}\right|^r,
  \]
  by showing that $\mathfrak{p}^r/\mathfrak{p}^{r - 1}$ is a $1$-dimensional vector space over the field $\mathcal{O}_L/\mathfrak{p}$. Then the result follows.
\end{proof}
This is the same proof, but written in a much saner form. This is better because we are combining a general statement (the Chinese remainder theorem), with a special property of the integral rings. In the first proof, what we really did was simultaneously proving two parts using algebraic magic.

We've taken an obvious invariant of an ideal, the size, and found it is multiplicative. How does this relate to the other invariants?

Recall that
\[
  \Delta(\alpha_1, \cdots, \alpha_n) = \det(\tr_{L/\Q}(\alpha_i\alpha_j)) = \det(\sigma_i(\alpha_j))^2.
\]
\begin{lemma}
  Let $\mathfrak{a} \lhd \mathcal{O}_L$ be an ideal, $n = [L:\Q]$. Then
  \begin{enumerate}
    \item There exists $\alpha_1, \cdots, \alpha_n \in \mathfrak{a}$ such that
      \[
        \mathfrak{a} = \left\{ \sum r_i \alpha_i : r_i \in \Z\right\} = \bigoplus_{1}^n \alpha_i\Z,
      \]
      and $\alpha_1, \cdots, \alpha_n$ are a basis of $L$ over $\Q$.
    \item For any such $\alpha_1, \cdots, \alpha_n$,
      \[
        \Delta (\alpha_1, \cdots, \alpha_n) = N(\mathfrak{a})^2 D_L.
      \]
  \end{enumerate}
\end{lemma}

\begin{proof}
  Let $d \in \mathfrak{a} \cap \Z$, say $d = N(\alpha)$. Then $d \mathcal{O}_L \subseteq \mathfrak{a} \subseteq \mathcal{O}_L$. As abelian groups, we have
  \[
    d \Z^n \leq \mathfrak{a} \leq \Z^n.
  \]
  Recall the lemma from IB Groups, Rings and Modules that if $M \leq \Z^n$ is a subgroup, then $M \cong \Z^r$ for some $0 \leq r \leq n$. Moreover, If $r = n$, then we can choose a basis $v_1, \cdots, v_n$ of $M$ such that when we write
  \[
    v_j = \sum a_{ij} e_i,
  \]
  where $a_i, \cdots, a_j \in \Z$ and $e_1, \cdots, e_n$ is the standard basis of $\Z^n$, we get that $A = (a_{ij})$ is upper triangular.

  In particular,
  \[
    |\Z^n/M| = |a_{11} a_{12} \cdots a_{nn}| = |\det A|.
  \]
  This certainly implies (i).

  If $\alpha_1', \cdots, \alpha_m'$ is an integral basis of $\mathcal{O}_L$, then $\alpha_1', \cdots, \alpha_n'$ is a basis for $L/\Q$. But $\alpha_1, \cdots, \alpha_n$ is also a basis for $L/\Q$. So there is a matrix $A \in \GL_n(\Q)$ such that $\alpha_i = \sum a_{ji} \alpha_j'$. Then
  \[
    \Delta(\alpha_1, \cdots, \alpha_n) = \det(A)^2 \Delta(\alpha_1', \cdots, \alpha_n').
  \]
  We know $\det(A)^2 = |\mathcal{O}_L/\mathfrak{a}|^2$ by the lemma, and $D_L = \Delta(\alpha_1', \cdots, \alpha_n')$ by definition.
\end{proof}

\begin{cor}
  If $\alpha_1, \cdots, \alpha_n$ as above have $\Delta(\alpha_1, \cdots, \alpha_n)$ square-free, then $\mathfrak{a} = \mathcal{O}_L$ (and $D_L$ is square-free).
\end{cor}
This is a nice trick, since it allows us to determine immediately whether a particular basis is an integral basis is in fact the whole of $\mathcal{O}_L$.

\begin{proof}
  Immediate, since this forces $N(\mathfrak{a})^2 = 1$.
\end{proof}

\begin{eg}
  Let $L = \Q(\alpha)$ and $\alpha \in \mathcal{O}_L$, and
  \[
    \disc(\alpha) = \Delta(1, \alpha, \alpha^2, \cdots, \alpha^{n - 1}) = \text{discriminant of minimal polynomial of }\alpha.
  \]
  Thus if $\disc(\alpha)$ is square-free, then $\Z[\alpha] = \mathcal{O}_L$.
\end{eg}
This is incredibly computationally useful, \emph{ok}?

Even if $\disc(\alpha)$ is not square-free, it still says something: let $d^2 \mid \disc(\alpha)$ be such that $\disc(\alpha)/d^2$ is square-free. Then
\[
  \Z[\alpha] \subseteq \mathcal{O}_L \subseteq \frac{1}{d} \Z[\alpha].
\]
Verification is left as an exercise. % exercise

We shall prove one more lemma, and start factoring things. Recall that we had two definitions for norm. Given $\alpha \in \mathcal{O}_L$, we can take the norm $N(\bra \alpha\ket)$, or $N_{L/\Q}(\alpha)$. It would be great if they are related, like if they are equal. However, that cannot possibly be true, since $N(\bra \alpha\ket)$ is always positive, but $N_{L/\Q}(\alpha)$ can be negative. So we take the absolute value.
\begin{lemma}
  If $\alpha \in \mathcal{O}_L$, then
  \[
    N(\bra \alpha\ket) = |N_{L/\Q}(\alpha)|.
  \]
\end{lemma}

\begin{proof}
  Let $\alpha_1, \cdots, \alpha_n$ be an integral basis of $\mathcal{O}_L$. Then $\alpha\alpha_1, .., \alpha\alpha_n$ is an integral basis of $\bra \alpha\ket$. So by the previous lemma,
  \[
    \Delta(\alpha \alpha_1, \cdots, \alpha\alpha_n) = N(\bra \alpha\ket)^2 D_L.
  \]
  But
  \begin{align*}
    \Delta (\alpha \alpha_1, \cdots, \alpha\alpha_n) &= \det(\sigma_i(\alpha\alpha_j)_{ij})^2 \\
    &= \det(\sigma_i(\alpha)\sigma_i(\alpha_j))^2\\
    &= \left(\prod_{i = 1}^n \sigma_i(\alpha)\right)^2 \Delta(\alpha_1, \cdots, \alpha_n)\\
    &= N_{L/\Q}(\alpha)^2 D_L.
  \end{align*}
  So
  \[
    N_{L/\Q}(\alpha)^2 = N(\bra \alpha\ket)^2.
  \]
  But $N(\bra \alpha\ket)$ is positive. So the result follows.
\end{proof}

\begin{lemma}
  Let $\mathfrak{p} \lhd \mathcal{O}_L$ be a prime ideal. Then there exists a unique $p \in \Z$, $p$ prime, with $\mathfrak{p} \mid \bra p\ket$. Moreover, $N(\mathfrak{p}) = p^f$ for some $1 \leq f \leq n$.
\end{lemma}
What does this say? We have said every ideal factors as a product of prime ideals, but we don't know what prime ideals are. The only obvious way we've had to obtain prime ideals is to take a usual prime, take its princiapl ideal and factor it in $\mathcal{O}_L$, and get the resultant prime ideals. What this lemma says is that's all we've got --- this mechanism gives us all prime ideals.
\end{document}
